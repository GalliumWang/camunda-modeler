{"version":3,"sources":["webpack:///./node_modules/canvg-browser/index.js","webpack:///./node_modules/codemirror/mode/xml/xml.js","webpack:///./node_modules/@bpmn-io/add-exporter/add-exporter.js","webpack:///./node_modules/xmldom/dom.js","webpack:///./node_modules/rgbcolor/index.js","webpack:///./node_modules/stackblur/index.js","webpack:///./node_modules/xmldom/dom-parser.js","webpack:///./node_modules/xmldom/sax.js"],"names":["RGBColor","stackblur","canvg","target","s","opts","document","getElementById","svg","stop","matchesSelector","Element","prototype","matches","node","selector","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","jQuery","Zepto","$","is","Sizzle","getMatchesSelector","CanvasRenderingContext2D","drawSvg","dx","dy","dw","dh","cOpts","ignoreMouse","ignoreAnimation","ignoreDimensions","ignoreClear","offsetX","offsetY","scaleWidth","scaleHeight","prop","hasOwnProperty","this","canvas","FRAMERATE","MAX_VIRTUAL_PIXELS","log","msg","console","init","ctx","uniqueId","UniqueId","Definitions","Styles","StylesSpecificity","Animations","Images","ViewPort","viewPorts","Clear","SetCurrent","width","height","push","RemoveCurrent","pop","Current","length","ComputeSize","d","Math","sqrt","pow","ImagesLoaded","i","loaded","trim","replace","compressSpaces","ajax","url","AJAX","window","XMLHttpRequest","ActiveXObject","open","send","responseText","parseXml","xml","Windows","Data","Xml","xmlDoc","Dom","XmlDocument","settings","XmlLoadSettings","prohibitDtd","loadXml","DOMParser","parseFromString","async","loadXML","Property","name","value","getValue","hasValue","numValue","n","parseFloat","match","valueOrDefault","def","numValueOrDefault","addOpacity","opacityProp","newValue","color","ok","r","g","b","getDefinition","isUrlDefinition","indexOf","getFillStyleDefinition","e","createGradient","createPattern","getHrefAttribute","pt","attribute","getDPI","viewPort","getEM","em","fontSize","Font","Parse","font","toPixels","getUnits","processPercent","toMilliseconds","toRadians","PI","textBaselineMapping","toTextBaseline","Variants","Weights","CreateFont","fontStyle","fontVariant","fontWeight","fontFamily","inherit","f","toString","join","that","split","set","ff","ToNumberArray","a","Point","x","y","angleTo","p","atan2","applyTransform","v","xp","yp","CreatePoint","CreatePath","path","BoundingBox","x1","y1","x2","y2","Number","NaN","addPoint","isNaN","addX","addY","addBoundingBox","bb","addQuadraticCurve","p0x","p0y","p1x","p1y","p2x","p2y","cp1x","cp1y","cp2x","cp2y","addBezierCurve","p3x","p3y","p0","p1","p2","p3","t","c","b2ac","t1","t2","isPointInBox","Transform","Type","translate","apply","unapply","applyToPoint","rotate","angle","cx","cy","cos","sin","scale","matrix","m","transform","det","SkewBase","base","skewX","tan","skewY","transforms","data","type","transformType","AspectRatio","aspectRatio","desiredWidth","desiredHeight","minX","minY","refX","refY","align","meetOrSlice","scaleX","scaleY","scaleMin","min","scaleMax","max","EmptyProperty","ElementBase","attributes","styles","stylesSpecificity","children","createIfNotExists","style","skipAncestors","parent","ps","render","save","mask","filter","setContext","renderChildren","clearContext","restore","addChild","childNode","create","child","CreateElement","addStylesFromStyleDefinition","specificity","existingSpecificity","nodeType","nodeName","childNodes","captureTextNodes","text","textContent","tspan","RenderedElementBase","fs","fillStyle","strokeStyle","newLineWidth","lineWidth","lineCap","lineJoin","miterLimit","gaps","setLineDash","webkitLineDash","mozDash","offset","lineDashOffset","webkitLineDashOffset","mozDashOffset","clip","globalAlpha","PathElementBase","beginPath","Mouse","checkPath","fill","stroke","markers","getMarkers","marker","getBoundingBox","baseClearContext","baseSetContext","getComputedStyle","getPropertyValue","root","moveTo","lineTo","closePath","viewBox","rect","rx","ry","quadraticCurveTo","circle","arc","ellipse","KAPPA","bezierCurveTo","line","getPoints","points","polyline","polygon","basePath","PathParser","tokens","reset","command","previousCommand","start","control","current","angles","isEnd","isCommandOrEnd","isRelativeCommand","getToken","getScalar","nextCommand","getPoint","makeAbsolute","getAsControlPoint","getAsCurrentPoint","getReflectedControlPoint","toLowerCase","addMarker","from","priorTo","addMarkerAngle","getMarkerPoints","getMarkerAngles","j","pp","newP","curr","cntrl","cp","xAxisRotation","largeArcFlag","sweepFlag","currp","l","cpp","centp","u","acos","a1","ad","dir","ah","halfWay","sx","sy","pattern","element","tempSvg","createElement","cctx","getContext","baseRender","point","defs","GradientBase","stops","getGradient","gradientUnits","attributesToInherit","inheritStopContainer","stopsContainer","attributeToInherit","parentOpacityProp","addParentOpacity","addColorStop","rootView","group","tempCtx","linearGradient","createLinearGradient","radialGradient","fx","fy","createRadialGradient","stopColor","AnimateBase","duration","begin","maxDuration","getProperty","attributeType","attributeName","initialValue","initialUnits","removed","calcValue","update","delta","frozen","animationFrozen","animationFrozenValue","updated","to","values","progress","ret","lb","floor","ub","ceil","animate","animateColor","parseInt","animateTransform","horizAdvX","isRTL","isArabic","fontFace","missingGlyph","glyphs","arabicForm","unicode","fontface","ascent","descent","unitsPerEm","missingglyph","glyph","textBaseline","getText","getAnchorDelta","renderChild","startI","textAnchor","measureTextRecursive","textParent","measureText","TextElementBase","getGlyph","customFont","fillText","strokeText","reverse","lw","measure","textToMeasure","tref","hasText","baseRenderChildren","checkBoundingBox","onclick","onmousemove","cursor","image","href","isSvg","img","crossOrigin","self","onload","onerror","src","drawImage","symbol","css","cssDefs","cssDef","cssClasses","cssProps","cssClass","props","k","substr","getSelectorSpecificity","srcs","urlStart","urlEnd","fonts","getElementsByTagName","use","oldParent","cMask","maskCtx","globalCompositeOperation","fillRect","clipPath","oldBeginPath","oldClosePath","call","px","py","efd","extraFilterDistance","feMorphology","feComposite","feColorMatrix","m1","m2","m3","imGet","rgba","imSet","val","mi","srcData","getImageData","clearRect","putImageData","feGaussianBlur","blurRadius","canvasRGBA","id","display","body","appendChild","removeChild","title","desc","MISSING","className","load","loadXmlDoc","dom","mapXY","offsetLeft","offsetTop","offsetParent","scrollX","scrollY","clientX","event","clientY","documentElement","isFirstRender","draw","parentNode","clientWidth","clientHeight","cWidth","cHeight","xRatio","yRatio","waitingForImages","intervalID","setInterval","needUpdate","hasEvents","runEvents","clearInterval","events","run","eventElements","isPointInPath","build","svgTags","querySelectorAll","svgTag","insertBefore","div","innerHTML","typeCount","findMatch","regex","module","exports","CodeMirror","htmlConfig","autoSelfClosers","implicitlyClosed","contextGrabbers","doNotIndent","allowUnquoted","allowMissing","caseFold","xmlConfig","allowMissingTagName","defineMode","editorConf","config_","setStyle","indentUnit","config","defaults","htmlMode","inText","stream","state","chain","parser","tokenize","ch","next","eat","inBlock","eatWhile","doctype","depth","inTag","quote","closure","baseState","tagName","tagStart","test","eol","isInAttribute","stringStartCol","column","terminator","lower","Context","startOfLine","prev","context","indent","indented","noIndent","popContext","maybePopContext","nextTagName","parentTagName","tagNameState","closeTagNameState","attrState","matchClosing","closeState","closeStateErr","_stream","attrEqState","attrValueState","attrContinuedState","isInText","startState","baseIndent","token","sol","indentation","eatSpace","textAfter","fullLine","Pass","multilineTagIndentPastTag","multilineTagIndentFactor","alignCDATA","tagAfter","exec","grabbers","electricInput","blockCommentStart","blockCommentEnd","configuration","helperType","skipAttribute","xmlCurrentTag","close","xmlCurrentContext","defineMIME","mimeModes","mod","AddExporter","eventBus","Error","version","on","definitions","exporter","exporterVersion","$inject","copy","dest","_extends","Class","Super","Object","ppt","__proto__","constructor","error","NodeType","ELEMENT_NODE","ATTRIBUTE_NODE","TEXT_NODE","CDATA_SECTION_NODE","ENTITY_REFERENCE_NODE","ENTITY_NODE","PROCESSING_INSTRUCTION_NODE","COMMENT_NODE","DOCUMENT_NODE","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","NOTATION_NODE","ExceptionCode","ExceptionMessage","HIERARCHY_REQUEST_ERR","INDEX_SIZE_ERR","DOMSTRING_SIZE_ERR","NOT_FOUND_ERR","WRONG_DOCUMENT_ERR","INVALID_CHARACTER_ERR","NO_DATA_ALLOWED_ERR","NO_MODIFICATION_ALLOWED_ERR","INUSE_ATTRIBUTE_ERR","NOT_SUPPORTED_ERR","INVALID_STATE_ERR","SYNTAX_ERR","INVALID_MODIFICATION_ERR","NAMESPACE_ERR","INVALID_ACCESS_ERR","DOMException","code","message","captureStackTrace","NodeList","LiveNodeList","refresh","_node","_refresh","_updateLiveList","list","inc","_inc","ownerDocument","ls","__set__","NamedNodeMap","_findNodeIndex","_addNamedNode","el","newAttr","oldAttr","ownerElement","doc","_onRemoveAttribute","namespaceURI","_nsMap","prefix","localName","_onAddAttribute","_removeNamedNode","attr","lastIndex","DOMImplementation","features","_features","feature","Node","_xmlEncoder","charCodeAt","_visitNode","callback","firstChild","nextSibling","Document","remove","_onUpdateChild","newChild","cs","_removeChild","previous","previousSibling","lastChild","_insertBefore","nextChild","newFirst","newLast","pre","Attr","CharacterData","Text","Comment","CDATASection","DocumentType","Notation","Entity","EntityReference","DocumentFragment","ProcessingInstruction","XMLSerializer","nodeSerializeToString","isHtml","nodeFilter","buf","refNode","uri","lookupPrefix","visibleNamespaces","namespace","serializeToString","needNamespaceDefine","isHTML","ns","attrs","len","item","pubid","publicId","sysid","systemId","sub","internalSubset","object","key","index","getNamedItem","setNamedItem","_ownerElement","setNamedItemNS","getNamedItemNS","removeNamedItem","removeNamedItemNS","hasFeature","versions","createDocument","qualifiedName","implementation","createElementNS","createDocumentType","nodeValue","refChild","replaceChild","oldChild","hasChildNodes","cloneNode","deep","node2","attrs2","setAttributeNode","normalize","appendData","isSupported","hasAttributes","map","lookupNamespaceURI","isDefaultNamespace","importNode","importedNode","rtv","getAttribute","createDocumentFragment","createTextNode","createComment","createCDATASection","createProcessingInstruction","createAttribute","specified","createEntityReference","pl","createAttributeNS","hasAttribute","getAttributeNode","setAttribute","removeAttribute","removeAttributeNode","_appendSingleChild","setAttributeNodeNS","removeAttributeNS","old","getAttributeNodeNS","hasAttributeNS","getAttributeNS","setAttributeNS","getElementsByTagNameNS","substringData","count","substring","insertData","replaceData","deleteData","splitText","newText","newNode","defineProperty","get","$$length","getTextContent","String","color_string","alpha","charAt","simple_colors","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","feldspar","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslateblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","violetred","wheat","white","whitesmoke","yellow","yellowgreen","color_defs","re","example","process","bits","processor","channels","toRGB","toRGBA","toHex","getHelpXML","examples","Array","sc","list_item","list_color","example_div","cssText","list_item_value","mul_table","shg_table","BlurStack","pixels","radius","yi","yw","r_sum","g_sum","b_sum","a_sum","r_out_sum","g_out_sum","b_out_sum","a_out_sum","r_in_sum","g_in_sum","b_in_sum","a_in_sum","pr","pg","pb","pa","rbs","widthMinus1","heightMinus1","radiusPlus1","sumFactor","stackStart","stack","stackEnd","stackIn","stackOut","mul_sum","shg_sum","options","locator","DOMHandler","cdata","position","lineNumber","columnNumber","_locator","_toString","chars","java","lang","appendElement","hander","currentElement","source","mimeType","sax","XMLReader","domBuilder","errorHandler","defaultNSMap","xmlns","entityMap","setDocumentLocator","errorImpl","isCallback","Function","fn","buildErrorHandler","nbsp","parse","startDocument","documentURI","startElement","qName","getURI","getQName","getLocator","endElement","startPrefixMapping","endPrefixMapping","processingInstruction","ins","ignorableWhitespace","characters","arguments","charNode","skippedEntity","endDocument","comment","comm","startCDATA","endCDATA","startDTD","impl","dt","warning","warn","fatalError","nameStartChar","nameChar","RegExp","slice","tagNamePattern","copyLocator","parseElementStartPart","currentNSMap","entityReplacer","attrName","add","setTagName","closed","localNSMap","nsp","nsPrefix","_copy","parseHtmlSpecialContent","elStartEnd","elEndStart","fixSelfClosed","closeMap","pos","lastIndexOf","parseDCC","end","matchs","reg","lastMatch","endDTD","parseInstruction","ElementAttributes","_set_proto_","thiz","defaultNSMapCopy","surrogate1","surrogate2","fromCharCode","fixedFromCharCode","appendText","xt","lineEnd","linePattern","lineStart","parseStack","endMatch","locator2","getLocalName"],"mappings":"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AAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,KAG5DC,EAAY,CACV,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC/D,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5D,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5D,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5D,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5D,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5D,GAAI,GAAI,GAAI,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","file":"1.1.js","sourcesContent":["'use strict';\r\n\r\n var RGBColor = require('rgbcolor');\r\n var stackblur = require('stackblur');\r\n var xmldom = require('xmldom');\r\n\r\n/*\r\n * canvg.js - Javascript SVG parser and renderer on Canvas\r\n * MIT Licensed\r\n * Gabe Lerner (gabelerner@gmail.com)\r\n * http://code.google.com/p/canvg/\r\n *\r\n * Requires: rgbcolor.js - http://www.phpied.com/rgb-color-parser-in-javascript/\r\n */\r\n\r\n/*\r\ncanvg(target, s)\r\n  empty parameters: replace all 'svg' elements on page with 'canvas' elements\r\n  target: canvas element or the id of a canvas element\r\n  s: svg string, url to svg file, or xml document\r\n  opts: optional hash of options\r\n    ignoreMouse: true => ignore mouse events\r\n    ignoreAnimation: true => ignore animations\r\n    ignoreDimensions: true => does not try to resize canvas\r\n    ignoreClear: true => does not clear canvas\r\n    offsetX: int => draws at a x offset\r\n    offsetY: int => draws at a y offset\r\n    scaleWidth: int => scales horizontally to width\r\n    scaleHeight: int => scales vertically to height\r\n    renderCallback: function => will call the function after the first render is completed\r\n    forceRedraw: function => will call the function on every frame, if it returns true, will redraw\r\n*/\r\nfunction canvg(target, s, opts) {\r\n\r\n\t// no parameters\r\n\tif (target == null && s == null && opts == null) {\r\n\t\tvar svgTags = document.querySelectorAll('svg');\r\n\t\tfor (var i=0; i<svgTags.length; i++) {\r\n\t\t\tvar svgTag = svgTags[i];\r\n\t\t\tvar c = document.createElement('canvas');\r\n\t\t\tc.width = svgTag.clientWidth;\r\n\t\t\tc.height = svgTag.clientHeight;\r\n\t\t\tsvgTag.parentNode.insertBefore(c, svgTag);\r\n\t\t\tsvgTag.parentNode.removeChild(svgTag);\r\n\t\t\tvar div = document.createElement('div');\r\n\t\t\tdiv.appendChild(svgTag);\r\n\t\t\tcanvg(c, div.innerHTML);\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (typeof target == 'string') {\r\n\t\ttarget = document.getElementById(target);\r\n\t}\r\n\r\n\t// store class on canvas\r\n\tif (target.svg != null) target.svg.stop();\r\n\tvar svg = build(opts || {});\r\n\t// on i.e. 8 for flash canvas, we can't assign the property so check for it\r\n\tif (!(target.childNodes.length == 1 && target.childNodes[0].nodeName == 'OBJECT')) target.svg = svg;\r\n\r\n\tvar ctx = target.getContext('2d');\r\n\tif (typeof s.documentElement != 'undefined') {\r\n\t\t// load from xml doc\r\n\t\tsvg.loadXmlDoc(ctx, s);\r\n\t}\r\n\telse if (s.substr(0,1) == '<') {\r\n\t\t// load from xml string\r\n\t\tsvg.loadXml(ctx, s);\r\n\t}\r\n\telse {\r\n\t\t// load from url\r\n\t\tsvg.load(ctx, s);\r\n\t}\r\n}\r\n\r\nfunction getMatchesSelector() {\r\n  // see https://developer.mozilla.org/en-US/docs/Web/API/Element.matches\r\n  var matchesSelector;\r\n  if (typeof Element.prototype.matches != 'undefined') {\r\n  \tmatchesSelector = function(node, selector) {\r\n  \t\treturn node.matches(selector);\r\n  \t};\r\n  } else if (typeof Element.prototype.webkitMatchesSelector != 'undefined') {\r\n  \tmatchesSelector = function(node, selector) {\r\n  \t\treturn node.webkitMatchesSelector(selector);\r\n  \t};\r\n  } else if (typeof Element.prototype.mozMatchesSelector != 'undefined') {\r\n  \tmatchesSelector = function(node, selector) {\r\n  \t\treturn node.mozMatchesSelector(selector);\r\n  \t};\r\n  } else if (typeof Element.prototype.msMatchesSelector != 'undefined') {\r\n  \tmatchesSelector = function(node, selector) {\r\n  \t\treturn node.msMatchesSelector(selector);\r\n  \t};\r\n  } else if (typeof Element.prototype.oMatchesSelector != 'undefined') {\r\n  \tmatchesSelector = function(node, selector) {\r\n  \t\treturn node.oMatchesSelector(selector);\r\n  \t};\r\n  } else {\r\n  \t// requires Sizzle: https://github.com/jquery/sizzle/wiki/Sizzle-Documentation\r\n  \t// or jQuery: http://jquery.com/download/\r\n  \t// or Zepto: http://zeptojs.com/#\r\n  \t// without it, this is a ReferenceError\r\n\r\n  \tif (typeof jQuery == 'function' || typeof Zepto == 'function') {\r\n  \t\tmatchesSelector = function (node, selector) {\r\n  \t\t\treturn $(node).is(selector);\r\n  \t\t};\r\n  \t}\r\n\r\n  \tif (typeof matchesSelector == 'undefined') {\r\n  \t\tmatchesSelector = Sizzle.matchesSelector;\r\n  \t}\r\n  }\r\n\r\n  return matchesSelector;\r\n}\r\n\r\nfunction getSelectorSpecificity(selector) {\r\n\tvar typeCount = [0, 0, 0];\r\n\r\n  // slightly modified version of https://github.com/keeganstreet/specificity/blob/master/specificity.js\r\n  var attributeRegex = /(\\[[^\\]]+\\])/g;\r\n  var idRegex = /(#[^\\s\\+>~\\.\\[:]+)/g;\r\n  var classRegex = /(\\.[^\\s\\+>~\\.\\[:]+)/g;\r\n  var pseudoElementRegex = /(::[^\\s\\+>~\\.\\[:]+|:first-line|:first-letter|:before|:after)/gi;\r\n  var pseudoClassWithBracketsRegex = /(:[\\w-]+\\([^\\)]*\\))/gi;\r\n  var pseudoClassRegex = /(:[^\\s\\+>~\\.\\[:]+)/g;\r\n  var elementRegex = /([^\\s\\+>~\\.\\[:]+)/g;\r\n\r\n\tvar findMatch = function(regex, type) {\r\n\t\tvar matches = selector.match(regex);\r\n\t\tif (matches == null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\ttypeCount[type] += matches.length;\r\n\t\tselector = selector.replace(regex, ' ');\r\n\t};\r\n\r\n\tselector = selector.replace(/:not\\(([^\\)]*)\\)/g, '     $1 ');\r\n\tselector = selector.replace(/{[^]*/gm, ' ');\r\n\tfindMatch(attributeRegex, 1);\r\n\tfindMatch(idRegex, 0);\r\n\tfindMatch(classRegex, 1);\r\n\tfindMatch(pseudoElementRegex, 2);\r\n\tfindMatch(pseudoClassWithBracketsRegex, 1);\r\n\tfindMatch(pseudoClassRegex, 1);\r\n\tselector = selector.replace(/[\\*\\s\\+>~]/g, ' ');\r\n\tselector = selector.replace(/[#\\.]/g, ' ');\r\n\tfindMatch(elementRegex, 2);\r\n\treturn typeCount.join('');\r\n}\r\n\r\nfunction build(opts) {\r\n\tvar svg = { opts: opts };\r\n\r\n  var matchesSelector = getMatchesSelector();\r\n\r\n  if (typeof CanvasRenderingContext2D  != 'undefined') {\r\n    CanvasRenderingContext2D.prototype.drawSvg = function(s, dx, dy, dw, dh, opts) {\r\n      var cOpts = {\r\n        ignoreMouse: true,\r\n        ignoreAnimation: true,\r\n        ignoreDimensions: true,\r\n        ignoreClear: true,\r\n        offsetX: dx,\r\n        offsetY: dy,\r\n        scaleWidth: dw,\r\n        scaleHeight: dh\r\n      };\r\n\r\n      for(var prop in opts) {\r\n        if(opts.hasOwnProperty(prop)){\r\n          cOpts[prop] = opts[prop];\r\n        }\r\n      }\r\n      canvg(this.canvas, s, cOpts);\r\n    };\r\n  }\r\n\r\n\tsvg.FRAMERATE = 30;\r\n\tsvg.MAX_VIRTUAL_PIXELS = 30000;\r\n\r\n\tsvg.log = function(msg) {};\r\n\tif (svg.opts.log == true && typeof console != 'undefined') {\r\n\t\tsvg.log = function(msg) { console.log(msg); };\r\n\t}\r\n\r\n\t// globals\r\n\tsvg.init = function(ctx) {\r\n\t\tvar uniqueId = 0;\r\n\t\tsvg.UniqueId = function () { uniqueId++; return 'canvg' + uniqueId;\t};\r\n\t\tsvg.Definitions = {};\r\n\t\tsvg.Styles = {};\r\n\t\tsvg.StylesSpecificity = {};\r\n\t\tsvg.Animations = [];\r\n\t\tsvg.Images = [];\r\n\t\tsvg.ctx = ctx;\r\n\t\tsvg.ViewPort = new (function () {\r\n\t\t\tthis.viewPorts = [];\r\n\t\t\tthis.Clear = function() { this.viewPorts = []; };\r\n\t\t\tthis.SetCurrent = function(width, height) { this.viewPorts.push({ width: width, height: height }); };\r\n\t\t\tthis.RemoveCurrent = function() { this.viewPorts.pop(); };\r\n\t\t\tthis.Current = function() { return this.viewPorts[this.viewPorts.length - 1]; };\r\n\t\t\tthis.width = function() { return this.Current().width; };\r\n\t\t\tthis.height = function() { return this.Current().height; };\r\n\t\t\tthis.ComputeSize = function(d) {\r\n\t\t\t\tif (d != null && typeof d == 'number') return d;\r\n\t\t\t\tif (d == 'x') return this.width();\r\n\t\t\t\tif (d == 'y') return this.height();\r\n\t\t\t\treturn Math.sqrt(Math.pow(this.width(), 2) + Math.pow(this.height(), 2)) / Math.sqrt(2);\r\n\t\t\t};\r\n\t\t});\r\n\t}\r\n\tsvg.init();\r\n\r\n\t// images loaded\r\n\tsvg.ImagesLoaded = function() {\r\n\t\tfor (var i=0; i<svg.Images.length; i++) {\r\n\t\t\tif (!svg.Images[i].loaded) return false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// trim\r\n\tsvg.trim = function(s) { return s.replace(/^\\s+|\\s+$/g, ''); }\r\n\r\n\t// compress spaces\r\n\tsvg.compressSpaces = function(s) { return s.replace(/[\\s\\r\\t\\n]+/gm,' '); }\r\n\r\n\t// ajax\r\n\tsvg.ajax = function(url) {\r\n\t\tvar AJAX;\r\n\t\tif(window.XMLHttpRequest){AJAX=new XMLHttpRequest();}\r\n\t\telse{AJAX=new ActiveXObject('Microsoft.XMLHTTP');}\r\n\t\tif(AJAX){\r\n\t\t   AJAX.open('GET',url,false);\r\n\t\t   AJAX.send(null);\r\n\t\t   return AJAX.responseText;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// parse xml\r\n\tsvg.parseXml = function(xml) {\r\n\t\tif (typeof Windows != 'undefined' && typeof Windows.Data != 'undefined' && typeof Windows.Data.Xml != 'undefined') {\r\n\t\t\tvar xmlDoc = new Windows.Data.Xml.Dom.XmlDocument();\r\n\t\t\tvar settings = new Windows.Data.Xml.Dom.XmlLoadSettings();\r\n\t\t\tsettings.prohibitDtd = false;\r\n\t\t\txmlDoc.loadXml(xml, settings);\r\n\t\t\treturn xmlDoc;\r\n\t\t}\r\n\t\telse if (window.DOMParser)\r\n\t\t{\r\n\t\t\tvar parser = new DOMParser();\r\n\t\t\treturn parser.parseFromString(xml, 'text/xml');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\txml = xml.replace(/<!DOCTYPE svg[^>]*>/, '');\r\n\t\t\tvar xmlDoc = new ActiveXObject('Microsoft.XMLDOM');\r\n\t\t\txmlDoc.async = 'false';\r\n\t\t\txmlDoc.loadXML(xml);\r\n\t\t\treturn xmlDoc;\r\n\t\t}\r\n\t}\r\n\r\n\tsvg.Property = function(name, value) {\r\n\t\tthis.name = name;\r\n\t\tthis.value = value;\r\n\t}\r\n\t\tsvg.Property.prototype.getValue = function() {\r\n\t\t\treturn this.value;\r\n\t\t}\r\n\r\n\t\tsvg.Property.prototype.hasValue = function() {\r\n\t\t\treturn (this.value != null && this.value != '');\r\n\t\t}\r\n\r\n\t\t// return the numerical value of the property\r\n\t\tsvg.Property.prototype.numValue = function() {\r\n\t\t\tif (!this.hasValue()) return 0;\r\n\r\n\t\t\tvar n = parseFloat(this.value);\r\n\t\t\tif ((this.value + '').match(/%$/)) {\r\n\t\t\t\tn = n / 100.0;\r\n\t\t\t}\r\n\t\t\treturn n;\r\n\t\t}\r\n\r\n\t\tsvg.Property.prototype.valueOrDefault = function(def) {\r\n\t\t\tif (this.hasValue()) return this.value;\r\n\t\t\treturn def;\r\n\t\t}\r\n\r\n\t\tsvg.Property.prototype.numValueOrDefault = function(def) {\r\n\t\t\tif (this.hasValue()) return this.numValue();\r\n\t\t\treturn def;\r\n\t\t}\r\n\r\n\t\t// color extensions\r\n\t\t\t// augment the current color value with the opacity\r\n\t\t\tsvg.Property.prototype.addOpacity = function(opacityProp) {\r\n\t\t\t\tvar newValue = this.value;\r\n\t\t\t\tif (opacityProp.value != null && opacityProp.value != '' && typeof this.value == 'string') { // can only add opacity to colors, not patterns\r\n\t\t\t\t\tvar color = new RGBColor(this.value);\r\n\t\t\t\t\tif (color.ok) {\r\n\t\t\t\t\t\tnewValue = 'rgba(' + color.r + ', ' + color.g + ', ' + color.b + ', ' + opacityProp.numValue() + ')';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn new svg.Property(this.name, newValue);\r\n\t\t\t}\r\n\r\n\t\t// definition extensions\r\n\t\t\t// get the definition from the definitions table\r\n\t\t\tsvg.Property.prototype.getDefinition = function() {\r\n\t\t\t\tvar name = this.value.match(/#([^\\)'\"]+)/);\r\n\t\t\t\tif (name) { name = name[1]; }\r\n\t\t\t\tif (!name) { name = this.value; }\r\n\t\t\t\treturn svg.Definitions[name];\r\n\t\t\t}\r\n\r\n\t\t\tsvg.Property.prototype.isUrlDefinition = function() {\r\n\t\t\t\treturn this.value.indexOf('url(') == 0\r\n\t\t\t}\r\n\r\n\t\t\tsvg.Property.prototype.getFillStyleDefinition = function(e, opacityProp) {\r\n\t\t\t\tvar def = this.getDefinition();\r\n\r\n\t\t\t\t// gradient\r\n\t\t\t\tif (def != null && def.createGradient) {\r\n\t\t\t\t\treturn def.createGradient(svg.ctx, e, opacityProp);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// pattern\r\n\t\t\t\tif (def != null && def.createPattern) {\r\n\t\t\t\t\tif (def.getHrefAttribute().hasValue()) {\r\n\t\t\t\t\t\tvar pt = def.attribute('patternTransform');\r\n\t\t\t\t\t\tdef = def.getHrefAttribute().getDefinition();\r\n\t\t\t\t\t\tif (pt.hasValue()) { def.attribute('patternTransform', true).value = pt.value; }\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn def.createPattern(svg.ctx, e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t// length extensions\r\n\t\t\tsvg.Property.prototype.getDPI = function(viewPort) {\r\n\t\t\t\treturn 96.0; // TODO: compute?\r\n\t\t\t}\r\n\r\n\t\t\tsvg.Property.prototype.getEM = function(viewPort) {\r\n\t\t\t\tvar em = 12;\r\n\r\n\t\t\t\tvar fontSize = new svg.Property('fontSize', svg.Font.Parse(svg.ctx.font).fontSize);\r\n\t\t\t\tif (fontSize.hasValue()) em = fontSize.toPixels(viewPort);\r\n\r\n\t\t\t\treturn em;\r\n\t\t\t}\r\n\r\n\t\t\tsvg.Property.prototype.getUnits = function() {\r\n\t\t\t\tvar s = this.value+'';\r\n\t\t\t\treturn s.replace(/[0-9\\.\\-]/g,'');\r\n\t\t\t}\r\n\r\n\t\t\t// get the length as pixels\r\n\t\t\tsvg.Property.prototype.toPixels = function(viewPort, processPercent) {\r\n\t\t\t\tif (!this.hasValue()) return 0;\r\n\t\t\t\tvar s = this.value+'';\r\n\t\t\t\tif (s.match(/em$/)) return this.numValue() * this.getEM(viewPort);\r\n\t\t\t\tif (s.match(/ex$/)) return this.numValue() * this.getEM(viewPort) / 2.0;\r\n\t\t\t\tif (s.match(/px$/)) return this.numValue();\r\n\t\t\t\tif (s.match(/pt$/)) return this.numValue() * this.getDPI(viewPort) * (1.0 / 72.0);\r\n\t\t\t\tif (s.match(/pc$/)) return this.numValue() * 15;\r\n\t\t\t\tif (s.match(/cm$/)) return this.numValue() * this.getDPI(viewPort) / 2.54;\r\n\t\t\t\tif (s.match(/mm$/)) return this.numValue() * this.getDPI(viewPort) / 25.4;\r\n\t\t\t\tif (s.match(/in$/)) return this.numValue() * this.getDPI(viewPort);\r\n\t\t\t\tif (s.match(/%$/)) return this.numValue() * svg.ViewPort.ComputeSize(viewPort);\r\n\t\t\t\tvar n = this.numValue();\r\n\t\t\t\tif (processPercent && n < 1.0) return n * svg.ViewPort.ComputeSize(viewPort);\r\n\t\t\t\treturn n;\r\n\t\t\t}\r\n\r\n\t\t// time extensions\r\n\t\t\t// get the time as milliseconds\r\n\t\t\tsvg.Property.prototype.toMilliseconds = function() {\r\n\t\t\t\tif (!this.hasValue()) return 0;\r\n\t\t\t\tvar s = this.value+'';\r\n\t\t\t\tif (s.match(/s$/)) return this.numValue() * 1000;\r\n\t\t\t\tif (s.match(/ms$/)) return this.numValue();\r\n\t\t\t\treturn this.numValue();\r\n\t\t\t}\r\n\r\n\t\t// angle extensions\r\n\t\t\t// get the angle as radians\r\n\t\t\tsvg.Property.prototype.toRadians = function() {\r\n\t\t\t\tif (!this.hasValue()) return 0;\r\n\t\t\t\tvar s = this.value+'';\r\n\t\t\t\tif (s.match(/deg$/)) return this.numValue() * (Math.PI / 180.0);\r\n\t\t\t\tif (s.match(/grad$/)) return this.numValue() * (Math.PI / 200.0);\r\n\t\t\t\tif (s.match(/rad$/)) return this.numValue();\r\n\t\t\t\treturn this.numValue() * (Math.PI / 180.0);\r\n\t\t\t}\r\n\r\n\t\t// text extensions\r\n\t\t\t// get the text baseline\r\n\t\t\tvar textBaselineMapping = {\r\n\t\t\t\t'baseline': 'alphabetic',\r\n\t\t\t\t'before-edge': 'top',\r\n\t\t\t\t'text-before-edge': 'top',\r\n\t\t\t\t'middle': 'middle',\r\n\t\t\t\t'central': 'middle',\r\n\t\t\t\t'after-edge': 'bottom',\r\n\t\t\t\t'text-after-edge': 'bottom',\r\n\t\t\t\t'ideographic': 'ideographic',\r\n\t\t\t\t'alphabetic': 'alphabetic',\r\n\t\t\t\t'hanging': 'hanging',\r\n\t\t\t\t'mathematical': 'alphabetic'\r\n\t\t\t};\r\n\t\t\tsvg.Property.prototype.toTextBaseline = function () {\r\n\t\t\t\tif (!this.hasValue()) return null;\r\n\t\t\t\treturn textBaselineMapping[this.value];\r\n\t\t\t}\r\n\r\n\t// fonts\r\n\tsvg.Font = new (function() {\r\n\t\tthis.Styles = 'normal|italic|oblique|inherit';\r\n\t\tthis.Variants = 'normal|small-caps|inherit';\r\n\t\tthis.Weights = 'normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit';\r\n\r\n\t\tthis.CreateFont = function(fontStyle, fontVariant, fontWeight, fontSize, fontFamily, inherit) {\r\n\t\t\tvar f = inherit != null ? this.Parse(inherit) : this.CreateFont('', '', '', '', '', svg.ctx.font);\r\n\t\t\treturn {\r\n\t\t\t\tfontFamily: fontFamily || f.fontFamily,\r\n\t\t\t\tfontSize: fontSize || f.fontSize,\r\n\t\t\t\tfontStyle: fontStyle || f.fontStyle,\r\n\t\t\t\tfontWeight: fontWeight || f.fontWeight,\r\n\t\t\t\tfontVariant: fontVariant || f.fontVariant,\r\n\t\t\t\ttoString: function () { return [this.fontStyle, this.fontVariant, this.fontWeight, this.fontSize, this.fontFamily].join(' ') }\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar that = this;\r\n\t\tthis.Parse = function(s) {\r\n\t\t\tvar f = {};\r\n\t\t\tvar d = svg.trim(svg.compressSpaces(s || '')).split(' ');\r\n\t\t\tvar set = { fontSize: false, fontStyle: false, fontWeight: false, fontVariant: false }\r\n\t\t\tvar ff = '';\r\n\t\t\tfor (var i=0; i<d.length; i++) {\r\n\t\t\t\tif (!set.fontStyle && that.Styles.indexOf(d[i]) != -1) { if (d[i] != 'inherit') f.fontStyle = d[i]; set.fontStyle = true; }\r\n\t\t\t\telse if (!set.fontVariant && that.Variants.indexOf(d[i]) != -1) { if (d[i] != 'inherit') f.fontVariant = d[i]; set.fontStyle = set.fontVariant = true;\t}\r\n\t\t\t\telse if (!set.fontWeight && that.Weights.indexOf(d[i]) != -1) {\tif (d[i] != 'inherit') f.fontWeight = d[i]; set.fontStyle = set.fontVariant = set.fontWeight = true; }\r\n\t\t\t\telse if (!set.fontSize) { if (d[i] != 'inherit') f.fontSize = d[i].split('/')[0]; set.fontStyle = set.fontVariant = set.fontWeight = set.fontSize = true; }\r\n\t\t\t\telse { if (d[i] != 'inherit') ff += d[i]; }\r\n\t\t\t} if (ff != '') f.fontFamily = ff;\r\n\t\t\treturn f;\r\n\t\t}\r\n\t});\r\n\r\n\t// points and paths\r\n\tsvg.ToNumberArray = function(s) {\r\n\t\tvar a = svg.trim(svg.compressSpaces((s || '').replace(/,/g, ' '))).split(' ');\r\n\t\tfor (var i=0; i<a.length; i++) {\r\n\t\t\ta[i] = parseFloat(a[i]);\r\n\t\t}\r\n\t\treturn a;\r\n\t}\r\n\tsvg.Point = function(x, y) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\t\tsvg.Point.prototype.angleTo = function(p) {\r\n\t\t\treturn Math.atan2(p.y - this.y, p.x - this.x);\r\n\t\t}\r\n\r\n\t\tsvg.Point.prototype.applyTransform = function(v) {\r\n\t\t\tvar xp = this.x * v[0] + this.y * v[2] + v[4];\r\n\t\t\tvar yp = this.x * v[1] + this.y * v[3] + v[5];\r\n\t\t\tthis.x = xp;\r\n\t\t\tthis.y = yp;\r\n\t\t}\r\n\r\n\tsvg.CreatePoint = function(s) {\r\n\t\tvar a = svg.ToNumberArray(s);\r\n\t\treturn new svg.Point(a[0], a[1]);\r\n\t}\r\n\tsvg.CreatePath = function(s) {\r\n\t\tvar a = svg.ToNumberArray(s);\r\n\t\tvar path = [];\r\n\t\tfor (var i=0; i<a.length; i+=2) {\r\n\t\t\tpath.push(new svg.Point(a[i], a[i+1]));\r\n\t\t}\r\n\t\treturn path;\r\n\t}\r\n\r\n\t// bounding box\r\n\tsvg.BoundingBox = function(x1, y1, x2, y2) { // pass in initial points if you want\r\n\t\tthis.x1 = Number.NaN;\r\n\t\tthis.y1 = Number.NaN;\r\n\t\tthis.x2 = Number.NaN;\r\n\t\tthis.y2 = Number.NaN;\r\n\r\n\t\tthis.x = function() { return this.x1; }\r\n\t\tthis.y = function() { return this.y1; }\r\n\t\tthis.width = function() { return this.x2 - this.x1; }\r\n\t\tthis.height = function() { return this.y2 - this.y1; }\r\n\r\n\t\tthis.addPoint = function(x, y) {\r\n\t\t\tif (x != null) {\r\n\t\t\t\tif (isNaN(this.x1) || isNaN(this.x2)) {\r\n\t\t\t\t\tthis.x1 = x;\r\n\t\t\t\t\tthis.x2 = x;\r\n\t\t\t\t}\r\n\t\t\t\tif (x < this.x1) this.x1 = x;\r\n\t\t\t\tif (x > this.x2) this.x2 = x;\r\n\t\t\t}\r\n\r\n\t\t\tif (y != null) {\r\n\t\t\t\tif (isNaN(this.y1) || isNaN(this.y2)) {\r\n\t\t\t\t\tthis.y1 = y;\r\n\t\t\t\t\tthis.y2 = y;\r\n\t\t\t\t}\r\n\t\t\t\tif (y < this.y1) this.y1 = y;\r\n\t\t\t\tif (y > this.y2) this.y2 = y;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.addX = function(x) { this.addPoint(x, null); }\r\n\t\tthis.addY = function(y) { this.addPoint(null, y); }\r\n\r\n\t\tthis.addBoundingBox = function(bb) {\r\n\t\t\tthis.addPoint(bb.x1, bb.y1);\r\n\t\t\tthis.addPoint(bb.x2, bb.y2);\r\n\t\t}\r\n\r\n\t\tthis.addQuadraticCurve = function(p0x, p0y, p1x, p1y, p2x, p2y) {\r\n\t\t\tvar cp1x = p0x + 2/3 * (p1x - p0x); // CP1 = QP0 + 2/3 *(QP1-QP0)\r\n\t\t\tvar cp1y = p0y + 2/3 * (p1y - p0y); // CP1 = QP0 + 2/3 *(QP1-QP0)\r\n\t\t\tvar cp2x = cp1x + 1/3 * (p2x - p0x); // CP2 = CP1 + 1/3 *(QP2-QP0)\r\n\t\t\tvar cp2y = cp1y + 1/3 * (p2y - p0y); // CP2 = CP1 + 1/3 *(QP2-QP0)\r\n\t\t\tthis.addBezierCurve(p0x, p0y, cp1x, cp2x, cp1y,\tcp2y, p2x, p2y);\r\n\t\t}\r\n\r\n\t\tthis.addBezierCurve = function(p0x, p0y, p1x, p1y, p2x, p2y, p3x, p3y) {\r\n\t\t\t// from http://blog.hackers-cafe.net/2009/06/how-to-calculate-bezier-curves-bounding.html\r\n\t\t\tvar p0 = [p0x, p0y], p1 = [p1x, p1y], p2 = [p2x, p2y], p3 = [p3x, p3y];\r\n\t\t\tthis.addPoint(p0[0], p0[1]);\r\n\t\t\tthis.addPoint(p3[0], p3[1]);\r\n\r\n\t\t\tfor (var i=0; i<=1; i++) {\r\n\t\t\t\tvar f = function(t) {\r\n\t\t\t\t\treturn Math.pow(1-t, 3) * p0[i]\r\n\t\t\t\t\t+ 3 * Math.pow(1-t, 2) * t * p1[i]\r\n\t\t\t\t\t+ 3 * (1-t) * Math.pow(t, 2) * p2[i]\r\n\t\t\t\t\t+ Math.pow(t, 3) * p3[i];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar b = 6 * p0[i] - 12 * p1[i] + 6 * p2[i];\r\n\t\t\t\tvar a = -3 * p0[i] + 9 * p1[i] - 9 * p2[i] + 3 * p3[i];\r\n\t\t\t\tvar c = 3 * p1[i] - 3 * p0[i];\r\n\r\n\t\t\t\tif (a == 0) {\r\n\t\t\t\t\tif (b == 0) continue;\r\n\t\t\t\t\tvar t = -c / b;\r\n\t\t\t\t\tif (0 < t && t < 1) {\r\n\t\t\t\t\t\tif (i == 0) this.addX(f(t));\r\n\t\t\t\t\t\tif (i == 1) this.addY(f(t));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar b2ac = Math.pow(b, 2) - 4 * c * a;\r\n\t\t\t\tif (b2ac < 0) continue;\r\n\t\t\t\tvar t1 = (-b + Math.sqrt(b2ac)) / (2 * a);\r\n\t\t\t\tif (0 < t1 && t1 < 1) {\r\n\t\t\t\t\tif (i == 0) this.addX(f(t1));\r\n\t\t\t\t\tif (i == 1) this.addY(f(t1));\r\n\t\t\t\t}\r\n\t\t\t\tvar t2 = (-b - Math.sqrt(b2ac)) / (2 * a);\r\n\t\t\t\tif (0 < t2 && t2 < 1) {\r\n\t\t\t\t\tif (i == 0) this.addX(f(t2));\r\n\t\t\t\t\tif (i == 1) this.addY(f(t2));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.isPointInBox = function(x, y) {\r\n\t\t\treturn (this.x1 <= x && x <= this.x2 && this.y1 <= y && y <= this.y2);\r\n\t\t}\r\n\r\n\t\tthis.addPoint(x1, y1);\r\n\t\tthis.addPoint(x2, y2);\r\n\t}\r\n\r\n\t// transforms\r\n\tsvg.Transform = function(v) {\r\n\t\tvar that = this;\r\n\t\tthis.Type = {}\r\n\r\n\t\t// translate\r\n\t\tthis.Type.translate = function(s) {\r\n\t\t\tthis.p = svg.CreatePoint(s);\r\n\t\t\tthis.apply = function(ctx) {\r\n\t\t\t\tctx.translate(this.p.x || 0.0, this.p.y || 0.0);\r\n\t\t\t}\r\n\t\t\tthis.unapply = function(ctx) {\r\n\t\t\t\tctx.translate(-1.0 * this.p.x || 0.0, -1.0 * this.p.y || 0.0);\r\n\t\t\t}\r\n\t\t\tthis.applyToPoint = function(p) {\r\n\t\t\t\tp.applyTransform([1, 0, 0, 1, this.p.x || 0.0, this.p.y || 0.0]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// rotate\r\n\t\tthis.Type.rotate = function(s) {\r\n\t\t\tvar a = svg.ToNumberArray(s);\r\n\t\t\tthis.angle = new svg.Property('angle', a[0]);\r\n\t\t\tthis.cx = a[1] || 0;\r\n\t\t\tthis.cy = a[2] || 0;\r\n\t\t\tthis.apply = function(ctx) {\r\n\t\t\t\tctx.translate(this.cx, this.cy);\r\n\t\t\t\tctx.rotate(this.angle.toRadians());\r\n\t\t\t\tctx.translate(-this.cx, -this.cy);\r\n\t\t\t}\r\n\t\t\tthis.unapply = function(ctx) {\r\n\t\t\t\tctx.translate(this.cx, this.cy);\r\n\t\t\t\tctx.rotate(-1.0 * this.angle.toRadians());\r\n\t\t\t\tctx.translate(-this.cx, -this.cy);\r\n\t\t\t}\r\n\t\t\tthis.applyToPoint = function(p) {\r\n\t\t\t\tvar a = this.angle.toRadians();\r\n\t\t\t\tp.applyTransform([1, 0, 0, 1, this.p.x || 0.0, this.p.y || 0.0]);\r\n\t\t\t\tp.applyTransform([Math.cos(a), Math.sin(a), -Math.sin(a), Math.cos(a), 0, 0]);\r\n\t\t\t\tp.applyTransform([1, 0, 0, 1, -this.p.x || 0.0, -this.p.y || 0.0]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.Type.scale = function(s) {\r\n\t\t\tthis.p = svg.CreatePoint(s);\r\n\t\t\tthis.apply = function(ctx) {\r\n\t\t\t\tctx.scale(this.p.x || 1.0, this.p.y || this.p.x || 1.0);\r\n\t\t\t}\r\n\t\t\tthis.unapply = function(ctx) {\r\n\t\t\t\tctx.scale(1.0 / this.p.x || 1.0, 1.0 / this.p.y || this.p.x || 1.0);\r\n\t\t\t}\r\n\t\t\tthis.applyToPoint = function(p) {\r\n\t\t\t\tp.applyTransform([this.p.x || 0.0, 0, 0, this.p.y || 0.0, 0, 0]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.Type.matrix = function(s) {\r\n\t\t\tthis.m = svg.ToNumberArray(s);\r\n\t\t\tthis.apply = function(ctx) {\r\n\t\t\t\tctx.transform(this.m[0], this.m[1], this.m[2], this.m[3], this.m[4], this.m[5]);\r\n\t\t\t}\r\n\t\t\tthis.unapply = function(ctx) {\r\n\t\t\t\tvar a = this.m[0];\r\n\t\t\t\tvar b = this.m[2];\r\n\t\t\t\tvar c = this.m[4];\r\n\t\t\t\tvar d = this.m[1];\r\n\t\t\t\tvar e = this.m[3];\r\n\t\t\t\tvar f = this.m[5];\r\n\t\t\t\tvar g = 0.0;\r\n\t\t\t\tvar h = 0.0;\r\n\t\t\t\tvar i = 1.0;\r\n\t\t\t\tvar det = 1 / (a*(e*i-f*h)-b*(d*i-f*g)+c*(d*h-e*g));\r\n\t\t\t\tctx.transform(\r\n\t\t\t\t\tdet*(e*i-f*h),\r\n\t\t\t\t\tdet*(f*g-d*i),\r\n\t\t\t\t\tdet*(c*h-b*i),\r\n\t\t\t\t\tdet*(a*i-c*g),\r\n\t\t\t\t\tdet*(b*f-c*e),\r\n\t\t\t\t\tdet*(c*d-a*f)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tthis.applyToPoint = function(p) {\r\n\t\t\t\tp.applyTransform(this.m);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.Type.SkewBase = function(s) {\r\n\t\t\tthis.base = that.Type.matrix;\r\n\t\t\tthis.base(s);\r\n\t\t\tthis.angle = new svg.Property('angle', s);\r\n\t\t}\r\n\t\tthis.Type.SkewBase.prototype = new this.Type.matrix;\r\n\r\n\t\tthis.Type.skewX = function(s) {\r\n\t\t\tthis.base = that.Type.SkewBase;\r\n\t\t\tthis.base(s);\r\n\t\t\tthis.m = [1, 0, Math.tan(this.angle.toRadians()), 1, 0, 0];\r\n\t\t}\r\n\t\tthis.Type.skewX.prototype = new this.Type.SkewBase;\r\n\r\n\t\tthis.Type.skewY = function(s) {\r\n\t\t\tthis.base = that.Type.SkewBase;\r\n\t\t\tthis.base(s);\r\n\t\t\tthis.m = [1, Math.tan(this.angle.toRadians()), 0, 1, 0, 0];\r\n\t\t}\r\n\t\tthis.Type.skewY.prototype = new this.Type.SkewBase;\r\n\r\n\t\tthis.transforms = [];\r\n\r\n\t\tthis.apply = function(ctx) {\r\n\t\t\tfor (var i=0; i<this.transforms.length; i++) {\r\n\t\t\t\tthis.transforms[i].apply(ctx);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.unapply = function(ctx) {\r\n\t\t\tfor (var i=this.transforms.length-1; i>=0; i--) {\r\n\t\t\t\tthis.transforms[i].unapply(ctx);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.applyToPoint = function(p) {\r\n\t\t\tfor (var i=0; i<this.transforms.length; i++) {\r\n\t\t\t\tthis.transforms[i].applyToPoint(p);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar data = svg.trim(svg.compressSpaces(v)).replace(/\\)([a-zA-Z])/g, ') $1').replace(/\\)(\\s?,\\s?)/g,') ').split(/\\s(?=[a-z])/);\r\n\t\tfor (var i=0; i<data.length; i++) {\r\n\t\t\tvar type = svg.trim(data[i].split('(')[0]);\r\n\t\t\tvar s = data[i].split('(')[1].replace(')','');\r\n\t\t\tvar transformType = this.Type[type];\r\n\t\t\tif (typeof transformType != 'undefined') {\r\n\t\t\t\tvar transform = new transformType(s);\r\n\t\t\t\ttransform.type = type;\r\n\t\t\t\tthis.transforms.push(transform);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// aspect ratio\r\n\tsvg.AspectRatio = function(ctx, aspectRatio, width, desiredWidth, height, desiredHeight, minX, minY, refX, refY) {\r\n\t\t// aspect ratio - http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute\r\n\t\taspectRatio = svg.compressSpaces(aspectRatio);\r\n\t\taspectRatio = aspectRatio.replace(/^defer\\s/,''); // ignore defer\r\n\t\tvar align = aspectRatio.split(' ')[0] || 'xMidYMid';\r\n\t\tvar meetOrSlice = aspectRatio.split(' ')[1] || 'meet';\r\n\r\n\t\t// calculate scale\r\n\t\tvar scaleX = width / desiredWidth;\r\n\t\tvar scaleY = height / desiredHeight;\r\n\t\tvar scaleMin = Math.min(scaleX, scaleY);\r\n\t\tvar scaleMax = Math.max(scaleX, scaleY);\r\n\t\tif (meetOrSlice == 'meet') { desiredWidth *= scaleMin; desiredHeight *= scaleMin; }\r\n\t\tif (meetOrSlice == 'slice') { desiredWidth *= scaleMax; desiredHeight *= scaleMax; }\r\n\r\n\t\trefX = new svg.Property('refX', refX);\r\n\t\trefY = new svg.Property('refY', refY);\r\n\t\tif (refX.hasValue() && refY.hasValue()) {\r\n\t\t\tctx.translate(-scaleMin * refX.toPixels('x'), -scaleMin * refY.toPixels('y'));\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// align\r\n\t\t\tif (align.match(/^xMid/) && ((meetOrSlice == 'meet' && scaleMin == scaleY) || (meetOrSlice == 'slice' && scaleMax == scaleY))) ctx.translate(width / 2.0 - desiredWidth / 2.0, 0);\r\n\t\t\tif (align.match(/YMid$/) && ((meetOrSlice == 'meet' && scaleMin == scaleX) || (meetOrSlice == 'slice' && scaleMax == scaleX))) ctx.translate(0, height / 2.0 - desiredHeight / 2.0);\r\n\t\t\tif (align.match(/^xMax/) && ((meetOrSlice == 'meet' && scaleMin == scaleY) || (meetOrSlice == 'slice' && scaleMax == scaleY))) ctx.translate(width - desiredWidth, 0);\r\n\t\t\tif (align.match(/YMax$/) && ((meetOrSlice == 'meet' && scaleMin == scaleX) || (meetOrSlice == 'slice' && scaleMax == scaleX))) ctx.translate(0, height - desiredHeight);\r\n\t\t}\r\n\r\n\t\t// scale\r\n\t\tif (align == 'none') ctx.scale(scaleX, scaleY);\r\n\t\telse if (meetOrSlice == 'meet') ctx.scale(scaleMin, scaleMin);\r\n\t\telse if (meetOrSlice == 'slice') ctx.scale(scaleMax, scaleMax);\r\n\r\n\t\t// translate\r\n\t\tctx.translate(minX == null ? 0 : -minX, minY == null ? 0 : -minY);\r\n\t}\r\n\r\n\t// elements\r\n\tsvg.Element = {}\r\n\r\n\tsvg.EmptyProperty = new svg.Property('EMPTY', '');\r\n\r\n\tsvg.Element.ElementBase = function(node) {\r\n\t\tthis.attributes = {};\r\n\t\tthis.styles = {};\r\n\t\tthis.stylesSpecificity = {};\r\n\t\tthis.children = [];\r\n\r\n\t\t// get or create attribute\r\n\t\tthis.attribute = function(name, createIfNotExists) {\r\n\t\t\tvar a = this.attributes[name];\r\n\t\t\tif (a != null) return a;\r\n\r\n\t\t\tif (createIfNotExists == true) { a = new svg.Property(name, ''); this.attributes[name] = a; }\r\n\t\t\treturn a || svg.EmptyProperty;\r\n\t\t}\r\n\r\n\t\tthis.getHrefAttribute = function() {\r\n\t\t\tfor (var a in this.attributes) {\r\n\t\t\t\tif (a == 'href' || a.match(/:href$/)) {\r\n\t\t\t\t\treturn this.attributes[a];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn svg.EmptyProperty;\r\n\t\t}\r\n\r\n\t\t// get or create style, crawls up node tree\r\n\t\tthis.style = function(name, createIfNotExists, skipAncestors) {\r\n\t\t\tvar s = this.styles[name];\r\n\t\t\tif (s != null) return s;\r\n\r\n\t\t\tvar a = this.attribute(name);\r\n\t\t\tif (a != null && a.hasValue()) {\r\n\t\t\t\tthis.styles[name] = a; // move up to me to cache\r\n\t\t\t\treturn a;\r\n\t\t\t}\r\n\r\n\t\t\tif (skipAncestors != true) {\r\n\t\t\t\tvar p = this.parent;\r\n\t\t\t\tif (p != null) {\r\n\t\t\t\t\tvar ps = p.style(name);\r\n\t\t\t\t\tif (ps != null && ps.hasValue()) {\r\n\t\t\t\t\t\treturn ps;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (createIfNotExists == true) { s = new svg.Property(name, ''); this.styles[name] = s; }\r\n\t\t\treturn s || svg.EmptyProperty;\r\n\t\t}\r\n\r\n\t\t// base render\r\n\t\tthis.render = function(ctx) {\r\n\t\t\t// don't render display=none\r\n\t\t\tif (this.style('display').value == 'none') return;\r\n\r\n\t\t\t// don't render visibility=hidden\r\n\t\t\tif (this.style('visibility').value == 'hidden') return;\r\n\r\n\t\t\tctx.save();\r\n\t\t\tif (this.style('mask').hasValue()) { // mask\r\n\t\t\t\tvar mask = this.style('mask').getDefinition();\r\n\t\t\t\tif (mask != null) mask.apply(ctx, this);\r\n\t\t\t}\r\n\t\t\telse if (this.style('filter').hasValue()) { // filter\r\n\t\t\t\tvar filter = this.style('filter').getDefinition();\r\n\t\t\t\tif (filter != null) filter.apply(ctx, this);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setContext(ctx);\r\n\t\t\t\tthis.renderChildren(ctx);\r\n\t\t\t\tthis.clearContext(ctx);\r\n\t\t\t}\r\n\t\t\tctx.restore();\r\n\t\t}\r\n\r\n\t\t// base set context\r\n\t\tthis.setContext = function(ctx) {\r\n\t\t\t// OVERRIDE ME!\r\n\t\t}\r\n\r\n\t\t// base clear context\r\n\t\tthis.clearContext = function(ctx) {\r\n\t\t\t// OVERRIDE ME!\r\n\t\t}\r\n\r\n\t\t// base render children\r\n\t\tthis.renderChildren = function(ctx) {\r\n\t\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\t\tthis.children[i].render(ctx);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.addChild = function(childNode, create) {\r\n\t\t\tvar child = childNode;\r\n\t\t\tif (create) child = svg.CreateElement(childNode);\r\n\t\t\tchild.parent = this;\r\n\t\t\tif (child.type != 'title') { this.children.push(child);\t}\r\n\t\t}\r\n\r\n\t\tthis.addStylesFromStyleDefinition = function () {\r\n\t\t\t// add styles\r\n\t\t\tfor (var selector in svg.Styles) {\r\n\t\t\t\tif (selector[0] != '@' && matchesSelector(node, selector)) {\r\n\t\t\t\t\tvar styles = svg.Styles[selector];\r\n\t\t\t\t\tvar specificity = svg.StylesSpecificity[selector];\r\n\t\t\t\t\tif (styles != null) {\r\n\t\t\t\t\t\tfor (var name in styles) {\r\n\t\t\t\t\t\t\tvar existingSpecificity = this.stylesSpecificity[name];\r\n\t\t\t\t\t\t\tif (typeof existingSpecificity == 'undefined') {\r\n\t\t\t\t\t\t\t\texistingSpecificity = '000';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (specificity > existingSpecificity) {\r\n\t\t\t\t\t\t\t\tthis.styles[name] = styles[name];\r\n\t\t\t\t\t\t\t\tthis.stylesSpecificity[name] = specificity;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (node != null && node.nodeType == 1) { //ELEMENT_NODE\r\n\t\t\t// add attributes\r\n\t\t\tfor (var i=0; i<node.attributes.length; i++) {\r\n\t\t\t\tvar attribute = node.attributes[i];\r\n\t\t\t\tthis.attributes[attribute.nodeName] = new svg.Property(attribute.nodeName, attribute.value);\r\n\t\t\t}\r\n\r\n\t\t\tthis.addStylesFromStyleDefinition();\r\n\r\n\t\t\t// add inline styles\r\n\t\t\tif (this.attribute('style').hasValue()) {\r\n\t\t\t\tvar styles = this.attribute('style').value.split(';');\r\n\t\t\t\tfor (var i=0; i<styles.length; i++) {\r\n\t\t\t\t\tif (svg.trim(styles[i]) != '') {\r\n\t\t\t\t\t\tvar style = styles[i].split(':');\r\n\t\t\t\t\t\tvar name = svg.trim(style[0]);\r\n\t\t\t\t\t\tvar value = svg.trim(style[1]);\r\n\t\t\t\t\t\tthis.styles[name] = new svg.Property(name, value);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// add id\r\n\t\t\tif (this.attribute('id').hasValue()) {\r\n\t\t\t\tif (svg.Definitions[this.attribute('id').value] == null) {\r\n\t\t\t\t\tsvg.Definitions[this.attribute('id').value] = this;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// add children\r\n\t\t\tfor (var i=0; i<node.childNodes.length; i++) {\r\n\t\t\t\tvar childNode = node.childNodes[i];\r\n\t\t\t\tif (childNode.nodeType == 1) this.addChild(childNode, true); //ELEMENT_NODE\r\n\t\t\t\tif (this.captureTextNodes && (childNode.nodeType == 3 || childNode.nodeType == 4)) {\r\n\t\t\t\t\tvar text = childNode.value || childNode.text || childNode.textContent || '';\r\n\t\t\t\t\tif (svg.compressSpaces(text) != '') {\r\n\t\t\t\t\t\tthis.addChild(new svg.Element.tspan(childNode), false); // TEXT_NODE\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsvg.Element.RenderedElementBase = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.setContext = function(ctx) {\r\n\t\t\t// fill\r\n\t\t\tif (this.style('fill').isUrlDefinition()) {\r\n\t\t\t\tvar fs = this.style('fill').getFillStyleDefinition(this, this.style('fill-opacity'));\r\n\t\t\t\tif (fs != null) ctx.fillStyle = fs;\r\n\t\t\t}\r\n\t\t\telse if (this.style('fill').hasValue()) {\r\n\t\t\t\tvar fillStyle = this.style('fill');\r\n\t\t\t\tif (fillStyle.value == 'currentColor') fillStyle.value = this.style('color').value;\r\n\t\t\t\tif (fillStyle.value != 'inherit') ctx.fillStyle = (fillStyle.value == 'none' ? 'rgba(0,0,0,0)' : fillStyle.value);\r\n\t\t\t}\r\n\t\t\tif (this.style('fill-opacity').hasValue()) {\r\n\t\t\t\tvar fillStyle = new svg.Property('fill', ctx.fillStyle);\r\n\t\t\t\tfillStyle = fillStyle.addOpacity(this.style('fill-opacity'));\r\n\t\t\t\tctx.fillStyle = fillStyle.value;\r\n\t\t\t}\r\n\r\n\t\t\t// stroke\r\n\t\t\tif (this.style('stroke').isUrlDefinition()) {\r\n\t\t\t\tvar fs = this.style('stroke').getFillStyleDefinition(this, this.style('stroke-opacity'));\r\n\t\t\t\tif (fs != null) ctx.strokeStyle = fs;\r\n\t\t\t}\r\n\t\t\telse if (this.style('stroke').hasValue()) {\r\n\t\t\t\tvar strokeStyle = this.style('stroke');\r\n\t\t\t\tif (strokeStyle.value == 'currentColor') strokeStyle.value = this.style('color').value;\r\n\t\t\t\tif (strokeStyle.value != 'inherit') ctx.strokeStyle = (strokeStyle.value == 'none' ? 'rgba(0,0,0,0)' : strokeStyle.value);\r\n\t\t\t}\r\n\t\t\tif (this.style('stroke-opacity').hasValue()) {\r\n\t\t\t\tvar strokeStyle = new svg.Property('stroke', ctx.strokeStyle);\r\n\t\t\t\tstrokeStyle = strokeStyle.addOpacity(this.style('stroke-opacity'));\r\n\t\t\t\tctx.strokeStyle = strokeStyle.value;\r\n\t\t\t}\r\n\t\t\tif (this.style('stroke-width').hasValue()) {\r\n\t\t\t\tvar newLineWidth = this.style('stroke-width').toPixels();\r\n\t\t\t\tctx.lineWidth = newLineWidth == 0 ? 0.001 : newLineWidth; // browsers don't respect 0\r\n\t\t    }\r\n\t\t\tif (this.style('stroke-linecap').hasValue()) ctx.lineCap = this.style('stroke-linecap').value;\r\n\t\t\tif (this.style('stroke-linejoin').hasValue()) ctx.lineJoin = this.style('stroke-linejoin').value;\r\n\t\t\tif (this.style('stroke-miterlimit').hasValue()) ctx.miterLimit = this.style('stroke-miterlimit').value;\r\n\t\t\tif (this.style('stroke-dasharray').hasValue() && this.style('stroke-dasharray').value != 'none') {\r\n\t\t\t\tvar gaps = svg.ToNumberArray(this.style('stroke-dasharray').value);\r\n\t\t\t\tif (typeof ctx.setLineDash != 'undefined') { ctx.setLineDash(gaps); }\r\n\t\t\t\telse if (typeof ctx.webkitLineDash != 'undefined') { ctx.webkitLineDash = gaps; }\r\n\t\t\t\telse if (typeof ctx.mozDash != 'undefined' && !(gaps.length==1 && gaps[0]==0)) { ctx.mozDash = gaps; }\r\n\r\n\t\t\t\tvar offset = this.style('stroke-dashoffset').numValueOrDefault(1);\r\n\t\t\t\tif (typeof ctx.lineDashOffset != 'undefined') { ctx.lineDashOffset = offset; }\r\n\t\t\t\telse if (typeof ctx.webkitLineDashOffset != 'undefined') { ctx.webkitLineDashOffset = offset; }\r\n\t\t\t\telse if (typeof ctx.mozDashOffset != 'undefined') { ctx.mozDashOffset = offset; }\r\n\t\t\t}\r\n\r\n\t\t\t// font\r\n\t\t\tif (typeof ctx.font != 'undefined') {\r\n\t\t\t\tctx.font = svg.Font.CreateFont(\r\n\t\t\t\t\tthis.style('font-style').value,\r\n\t\t\t\t\tthis.style('font-variant').value,\r\n\t\t\t\t\tthis.style('font-weight').value,\r\n\t\t\t\t\tthis.style('font-size').hasValue() ? this.style('font-size').toPixels() + 'px' : '',\r\n\t\t\t\t\tthis.style('font-family').value).toString();\r\n\t\t\t}\r\n\r\n\t\t\t// transform\r\n\t\t\tif (this.style('transform', false, true).hasValue()) {\r\n\t\t\t\tvar transform = new svg.Transform(this.style('transform', false, true).value);\r\n\t\t\t\ttransform.apply(ctx);\r\n\t\t\t}\r\n\r\n\t\t\t// clip\r\n\t\t\tif (this.style('clip-path', false, true).hasValue()) {\r\n\t\t\t\tvar clip = this.style('clip-path', false, true).getDefinition();\r\n\t\t\t\tif (clip != null) clip.apply(ctx);\r\n\t\t\t}\r\n\r\n\t\t\t// opacity\r\n\t\t\tif (this.style('opacity').hasValue()) {\r\n\t\t\t\tctx.globalAlpha = this.style('opacity').numValue();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tsvg.Element.RenderedElementBase.prototype = new svg.Element.ElementBase;\r\n\r\n\tsvg.Element.PathElementBase = function(node) {\r\n\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.path = function(ctx) {\r\n\t\t\tif (ctx != null) ctx.beginPath();\r\n\t\t\treturn new svg.BoundingBox();\r\n\t\t}\r\n\r\n\t\tthis.renderChildren = function(ctx) {\r\n\t\t\tthis.path(ctx);\r\n\t\t\tsvg.Mouse.checkPath(this, ctx);\r\n\t\t\tif (ctx.fillStyle != '') {\r\n\t\t\t\tif (this.style('fill-rule').valueOrDefault('inherit') != 'inherit') { ctx.fill(this.style('fill-rule').value); }\r\n\t\t\t\telse { ctx.fill(); }\r\n\t\t\t}\r\n\t\t\tif (ctx.strokeStyle != '') ctx.stroke();\r\n\r\n\t\t\tvar markers = this.getMarkers();\r\n\t\t\tif (markers != null) {\r\n\t\t\t\tif (this.style('marker-start').isUrlDefinition()) {\r\n\t\t\t\t\tvar marker = this.style('marker-start').getDefinition();\r\n\t\t\t\t\tmarker.render(ctx, markers[0][0], markers[0][1]);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.style('marker-mid').isUrlDefinition()) {\r\n\t\t\t\t\tvar marker = this.style('marker-mid').getDefinition();\r\n\t\t\t\t\tfor (var i=1;i<markers.length-1;i++) {\r\n\t\t\t\t\t\tmarker.render(ctx, markers[i][0], markers[i][1]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (this.style('marker-end').isUrlDefinition()) {\r\n\t\t\t\t\tvar marker = this.style('marker-end').getDefinition();\r\n\t\t\t\t\tmarker.render(ctx, markers[markers.length-1][0], markers[markers.length-1][1]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.getBoundingBox = function() {\r\n\t\t\treturn this.path();\r\n\t\t}\r\n\r\n\t\tthis.getMarkers = function() {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\tsvg.Element.PathElementBase.prototype = new svg.Element.RenderedElementBase;\r\n\r\n\t// svg element\r\n\tsvg.Element.svg = function(node) {\r\n\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.baseClearContext = this.clearContext;\r\n\t\tthis.clearContext = function(ctx) {\r\n\t\t\tthis.baseClearContext(ctx);\r\n\t\t\tsvg.ViewPort.RemoveCurrent();\r\n\t\t}\r\n\r\n\t\tthis.baseSetContext = this.setContext;\r\n\t\tthis.setContext = function(ctx) {\r\n\t\t\t// initial values and defaults\r\n\t\t\tctx.strokeStyle = 'rgba(0,0,0,0)';\r\n\t\t\tctx.lineCap = 'butt';\r\n\t\t\tctx.lineJoin = 'miter';\r\n\t\t\tctx.miterLimit = 4;\r\n\t\t\tif (typeof ctx.font != 'undefined' && typeof window.getComputedStyle != 'undefined') {\r\n\t\t\t\tctx.font = window.getComputedStyle(ctx.canvas).getPropertyValue('font');\r\n\t\t\t}\r\n\r\n\t\t\tthis.baseSetContext(ctx);\r\n\r\n\t\t\t// create new view port\r\n\t\t\tif (!this.attribute('x').hasValue()) this.attribute('x', true).value = 0;\r\n\t\t\tif (!this.attribute('y').hasValue()) this.attribute('y', true).value = 0;\r\n\t\t\tctx.translate(this.attribute('x').toPixels('x'), this.attribute('y').toPixels('y'));\r\n\r\n\t\t\tvar width = svg.ViewPort.width();\r\n\t\t\tvar height = svg.ViewPort.height();\r\n\r\n\t\t\tif (!this.attribute('width').hasValue()) this.attribute('width', true).value = '100%';\r\n\t\t\tif (!this.attribute('height').hasValue()) this.attribute('height', true).value = '100%';\r\n\t\t\tif (typeof this.root == 'undefined') {\r\n\t\t\t\twidth = this.attribute('width').toPixels('x');\r\n\t\t\t\theight = this.attribute('height').toPixels('y');\r\n\r\n\t\t\t\tvar x = 0;\r\n\t\t\t\tvar y = 0;\r\n\t\t\t\tif (this.attribute('refX').hasValue() && this.attribute('refY').hasValue()) {\r\n\t\t\t\t\tx = -this.attribute('refX').toPixels('x');\r\n\t\t\t\t\ty = -this.attribute('refY').toPixels('y');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.attribute('overflow').valueOrDefault('hidden') != 'visible') {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(x, y);\r\n\t\t\t\t\tctx.lineTo(width, y);\r\n\t\t\t\t\tctx.lineTo(width, height);\r\n\t\t\t\t\tctx.lineTo(x, height);\r\n\t\t\t\t\tctx.closePath();\r\n\t\t\t\t\tctx.clip();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tsvg.ViewPort.SetCurrent(width, height);\r\n\r\n\t\t\t// viewbox\r\n\t\t\tif (this.attribute('viewBox').hasValue()) {\r\n\t\t\t\tvar viewBox = svg.ToNumberArray(this.attribute('viewBox').value);\r\n\t\t\t\tvar minX = viewBox[0];\r\n\t\t\t\tvar minY = viewBox[1];\r\n\t\t\t\twidth = viewBox[2];\r\n\t\t\t\theight = viewBox[3];\r\n\r\n\t\t\t\tsvg.AspectRatio(ctx,\r\n\t\t\t\t\t\t\t\tthis.attribute('preserveAspectRatio').value,\r\n\t\t\t\t\t\t\t\tsvg.ViewPort.width(),\r\n\t\t\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\t\t\tsvg.ViewPort.height(),\r\n\t\t\t\t\t\t\t\theight,\r\n\t\t\t\t\t\t\t\tminX,\r\n\t\t\t\t\t\t\t\tminY,\r\n\t\t\t\t\t\t\t\tthis.attribute('refX').value,\r\n\t\t\t\t\t\t\t\tthis.attribute('refY').value);\r\n\r\n\t\t\t\tsvg.ViewPort.RemoveCurrent();\r\n\t\t\t\tsvg.ViewPort.SetCurrent(viewBox[2], viewBox[3]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tsvg.Element.svg.prototype = new svg.Element.RenderedElementBase;\r\n\r\n\t// rect element\r\n\tsvg.Element.rect = function(node) {\r\n\t\tthis.base = svg.Element.PathElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.path = function(ctx) {\r\n\t\t\tvar x = this.attribute('x').toPixels('x');\r\n\t\t\tvar y = this.attribute('y').toPixels('y');\r\n\t\t\tvar width = this.attribute('width').toPixels('x');\r\n\t\t\tvar height = this.attribute('height').toPixels('y');\r\n\t\t\tvar rx = this.attribute('rx').toPixels('x');\r\n\t\t\tvar ry = this.attribute('ry').toPixels('y');\r\n\t\t\tif (this.attribute('rx').hasValue() && !this.attribute('ry').hasValue()) ry = rx;\r\n\t\t\tif (this.attribute('ry').hasValue() && !this.attribute('rx').hasValue()) rx = ry;\r\n\t\t\trx = Math.min(rx, width / 2.0);\r\n\t\t\try = Math.min(ry, height / 2.0);\r\n\t\t\tif (ctx != null) {\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(x + rx, y);\r\n\t\t\t\tctx.lineTo(x + width - rx, y);\r\n\t\t\t\tctx.quadraticCurveTo(x + width, y, x + width, y + ry)\r\n\t\t\t\tctx.lineTo(x + width, y + height - ry);\r\n\t\t\t\tctx.quadraticCurveTo(x + width, y + height, x + width - rx, y + height)\r\n\t\t\t\tctx.lineTo(x + rx, y + height);\r\n\t\t\t\tctx.quadraticCurveTo(x, y + height, x, y + height - ry)\r\n\t\t\t\tctx.lineTo(x, y + ry);\r\n\t\t\t\tctx.quadraticCurveTo(x, y, x + rx, y)\r\n\t\t\t\tctx.closePath();\r\n\t\t\t}\r\n\r\n\t\t\treturn new svg.BoundingBox(x, y, x + width, y + height);\r\n\t\t}\r\n\t}\r\n\tsvg.Element.rect.prototype = new svg.Element.PathElementBase;\r\n\r\n\t// circle element\r\n\tsvg.Element.circle = function(node) {\r\n\t\tthis.base = svg.Element.PathElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.path = function(ctx) {\r\n\t\t\tvar cx = this.attribute('cx').toPixels('x');\r\n\t\t\tvar cy = this.attribute('cy').toPixels('y');\r\n\t\t\tvar r = this.attribute('r').toPixels();\r\n\r\n\t\t\tif (ctx != null) {\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(cx, cy, r, 0, Math.PI * 2, true);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t}\r\n\r\n\t\t\treturn new svg.BoundingBox(cx - r, cy - r, cx + r, cy + r);\r\n\t\t}\r\n\t}\r\n\tsvg.Element.circle.prototype = new svg.Element.PathElementBase;\r\n\r\n\t// ellipse element\r\n\tsvg.Element.ellipse = function(node) {\r\n\t\tthis.base = svg.Element.PathElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.path = function(ctx) {\r\n\t\t\tvar KAPPA = 4 * ((Math.sqrt(2) - 1) / 3);\r\n\t\t\tvar rx = this.attribute('rx').toPixels('x');\r\n\t\t\tvar ry = this.attribute('ry').toPixels('y');\r\n\t\t\tvar cx = this.attribute('cx').toPixels('x');\r\n\t\t\tvar cy = this.attribute('cy').toPixels('y');\r\n\r\n\t\t\tif (ctx != null) {\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(cx, cy - ry);\r\n\t\t\t\tctx.bezierCurveTo(cx + (KAPPA * rx), cy - ry,  cx + rx, cy - (KAPPA * ry), cx + rx, cy);\r\n\t\t\t\tctx.bezierCurveTo(cx + rx, cy + (KAPPA * ry), cx + (KAPPA * rx), cy + ry, cx, cy + ry);\r\n\t\t\t\tctx.bezierCurveTo(cx - (KAPPA * rx), cy + ry, cx - rx, cy + (KAPPA * ry), cx - rx, cy);\r\n\t\t\t\tctx.bezierCurveTo(cx - rx, cy - (KAPPA * ry), cx - (KAPPA * rx), cy - ry, cx, cy - ry);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t}\r\n\r\n\t\t\treturn new svg.BoundingBox(cx - rx, cy - ry, cx + rx, cy + ry);\r\n\t\t}\r\n\t}\r\n\tsvg.Element.ellipse.prototype = new svg.Element.PathElementBase;\r\n\r\n\t// line element\r\n\tsvg.Element.line = function(node) {\r\n\t\tthis.base = svg.Element.PathElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.getPoints = function() {\r\n\t\t\treturn [\r\n\t\t\t\tnew svg.Point(this.attribute('x1').toPixels('x'), this.attribute('y1').toPixels('y')),\r\n\t\t\t\tnew svg.Point(this.attribute('x2').toPixels('x'), this.attribute('y2').toPixels('y'))];\r\n\t\t}\r\n\r\n\t\tthis.path = function(ctx) {\r\n\t\t\tvar points = this.getPoints();\r\n\r\n\t\t\tif (ctx != null) {\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(points[0].x, points[0].y);\r\n\t\t\t\tctx.lineTo(points[1].x, points[1].y);\r\n\t\t\t}\r\n\r\n\t\t\treturn new svg.BoundingBox(points[0].x, points[0].y, points[1].x, points[1].y);\r\n\t\t}\r\n\r\n\t\tthis.getMarkers = function() {\r\n\t\t\tvar points = this.getPoints();\r\n\t\t\tvar a = points[0].angleTo(points[1]);\r\n\t\t\treturn [[points[0], a], [points[1], a]];\r\n\t\t}\r\n\t}\r\n\tsvg.Element.line.prototype = new svg.Element.PathElementBase;\r\n\r\n\t// polyline element\r\n\tsvg.Element.polyline = function(node) {\r\n\t\tthis.base = svg.Element.PathElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.points = svg.CreatePath(this.attribute('points').value);\r\n\t\tthis.path = function(ctx) {\r\n\t\t\tvar bb = new svg.BoundingBox(this.points[0].x, this.points[0].y);\r\n\t\t\tif (ctx != null) {\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(this.points[0].x, this.points[0].y);\r\n\t\t\t}\r\n\t\t\tfor (var i=1; i<this.points.length; i++) {\r\n\t\t\t\tbb.addPoint(this.points[i].x, this.points[i].y);\r\n\t\t\t\tif (ctx != null) ctx.lineTo(this.points[i].x, this.points[i].y);\r\n\t\t\t}\r\n\t\t\treturn bb;\r\n\t\t}\r\n\r\n\t\tthis.getMarkers = function() {\r\n\t\t\tvar markers = [];\r\n\t\t\tfor (var i=0; i<this.points.length - 1; i++) {\r\n\t\t\t\tmarkers.push([this.points[i], this.points[i].angleTo(this.points[i+1])]);\r\n\t\t\t}\r\n\t\t\tif (markers.length > 0) {\r\n\t\t\t\tmarkers.push([this.points[this.points.length-1], markers[markers.length-1][1]]);\r\n\t\t\t}\r\n\t\t\treturn markers;\r\n\t\t}\r\n\t}\r\n\tsvg.Element.polyline.prototype = new svg.Element.PathElementBase;\r\n\r\n\t// polygon element\r\n\tsvg.Element.polygon = function(node) {\r\n\t\tthis.base = svg.Element.polyline;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.basePath = this.path;\r\n\t\tthis.path = function(ctx) {\r\n\t\t\tvar bb = this.basePath(ctx);\r\n\t\t\tif (ctx != null) {\r\n\t\t\t\tctx.lineTo(this.points[0].x, this.points[0].y);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t}\r\n\t\t\treturn bb;\r\n\t\t}\r\n\t}\r\n\tsvg.Element.polygon.prototype = new svg.Element.polyline;\r\n\r\n\t// path element\r\n\tsvg.Element.path = function(node) {\r\n\t\tthis.base = svg.Element.PathElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tvar d = this.attribute('d').value;\r\n\t\t// TODO: convert to real lexer based on http://www.w3.org/TR/SVG11/paths.html#PathDataBNF\r\n\t\td = d.replace(/,/gm,' '); // get rid of all commas\r\n\t\t// As the end of a match can also be the start of the next match, we need to run this replace twice.\r\n\t\tfor(var i=0; i<2; i++)\r\n\t\t\td = d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\\s])/gm,'$1 $2'); // suffix commands with spaces\r\n\t\td = d.replace(/([^\\s])([MmZzLlHhVvCcSsQqTtAa])/gm,'$1 $2'); // prefix commands with spaces\r\n\t\td = d.replace(/([0-9])([+\\-])/gm,'$1 $2'); // separate digits on +- signs\r\n\t\t// Again, we need to run this twice to find all occurances\r\n\t\tfor(var i=0; i<2; i++)\r\n\t\t\td = d.replace(/(\\.[0-9]*)(\\.)/gm,'$1 $2'); // separate digits when they start with a comma\r\n\t\td = d.replace(/([Aa](\\s+[0-9]+){3})\\s+([01])\\s*([01])/gm,'$1 $3 $4 '); // shorthand elliptical arc path syntax\r\n\t\td = svg.compressSpaces(d); // compress multiple spaces\r\n\t\td = svg.trim(d);\r\n\t\tthis.PathParser = new (function(d) {\r\n\t\t\tthis.tokens = d.split(' ');\r\n\r\n\t\t\tthis.reset = function() {\r\n\t\t\t\tthis.i = -1;\r\n\t\t\t\tthis.command = '';\r\n\t\t\t\tthis.previousCommand = '';\r\n\t\t\t\tthis.start = new svg.Point(0, 0);\r\n\t\t\t\tthis.control = new svg.Point(0, 0);\r\n\t\t\t\tthis.current = new svg.Point(0, 0);\r\n\t\t\t\tthis.points = [];\r\n\t\t\t\tthis.angles = [];\r\n\t\t\t}\r\n\r\n\t\t\tthis.isEnd = function() {\r\n\t\t\t\treturn this.i >= this.tokens.length - 1;\r\n\t\t\t}\r\n\r\n\t\t\tthis.isCommandOrEnd = function() {\r\n\t\t\t\tif (this.isEnd()) return true;\r\n\t\t\t\treturn this.tokens[this.i + 1].match(/^[A-Za-z]$/) != null;\r\n\t\t\t}\r\n\r\n\t\t\tthis.isRelativeCommand = function() {\r\n\t\t\t\tswitch(this.command)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 'm':\r\n\t\t\t\t\tcase 'l':\r\n\t\t\t\t\tcase 'h':\r\n\t\t\t\t\tcase 'v':\r\n\t\t\t\t\tcase 'c':\r\n\t\t\t\t\tcase 's':\r\n\t\t\t\t\tcase 'q':\r\n\t\t\t\t\tcase 't':\r\n\t\t\t\t\tcase 'a':\r\n\t\t\t\t\tcase 'z':\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthis.getToken = function() {\r\n\t\t\t\tthis.i++;\r\n\t\t\t\treturn this.tokens[this.i];\r\n\t\t\t}\r\n\r\n\t\t\tthis.getScalar = function() {\r\n\t\t\t\treturn parseFloat(this.getToken());\r\n\t\t\t}\r\n\r\n\t\t\tthis.nextCommand = function() {\r\n\t\t\t\tthis.previousCommand = this.command;\r\n\t\t\t\tthis.command = this.getToken();\r\n\t\t\t}\r\n\r\n\t\t\tthis.getPoint = function() {\r\n\t\t\t\tvar p = new svg.Point(this.getScalar(), this.getScalar());\r\n\t\t\t\treturn this.makeAbsolute(p);\r\n\t\t\t}\r\n\r\n\t\t\tthis.getAsControlPoint = function() {\r\n\t\t\t\tvar p = this.getPoint();\r\n\t\t\t\tthis.control = p;\r\n\t\t\t\treturn p;\r\n\t\t\t}\r\n\r\n\t\t\tthis.getAsCurrentPoint = function() {\r\n\t\t\t\tvar p = this.getPoint();\r\n\t\t\t\tthis.current = p;\r\n\t\t\t\treturn p;\r\n\t\t\t}\r\n\r\n\t\t\tthis.getReflectedControlPoint = function() {\r\n\t\t\t\tif (this.previousCommand.toLowerCase() != 'c' &&\r\n\t\t\t\t    this.previousCommand.toLowerCase() != 's' &&\r\n\t\t\t\t\tthis.previousCommand.toLowerCase() != 'q' &&\r\n\t\t\t\t\tthis.previousCommand.toLowerCase() != 't' ){\r\n\t\t\t\t\treturn this.current;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// reflect point\r\n\t\t\t\tvar p = new svg.Point(2 * this.current.x - this.control.x, 2 * this.current.y - this.control.y);\r\n\t\t\t\treturn p;\r\n\t\t\t}\r\n\r\n\t\t\tthis.makeAbsolute = function(p) {\r\n\t\t\t\tif (this.isRelativeCommand()) {\r\n\t\t\t\t\tp.x += this.current.x;\r\n\t\t\t\t\tp.y += this.current.y;\r\n\t\t\t\t}\r\n\t\t\t\treturn p;\r\n\t\t\t}\r\n\r\n\t\t\tthis.addMarker = function(p, from, priorTo) {\r\n\t\t\t\t// if the last angle isn't filled in because we didn't have this point yet ...\r\n\t\t\t\tif (priorTo != null && this.angles.length > 0 && this.angles[this.angles.length-1] == null) {\r\n\t\t\t\t\tthis.angles[this.angles.length-1] = this.points[this.points.length-1].angleTo(priorTo);\r\n\t\t\t\t}\r\n\t\t\t\tthis.addMarkerAngle(p, from == null ? null : from.angleTo(p));\r\n\t\t\t}\r\n\r\n\t\t\tthis.addMarkerAngle = function(p, a) {\r\n\t\t\t\tthis.points.push(p);\r\n\t\t\t\tthis.angles.push(a);\r\n\t\t\t}\r\n\r\n\t\t\tthis.getMarkerPoints = function() { return this.points; }\r\n\t\t\tthis.getMarkerAngles = function() {\r\n\t\t\t\tfor (var i=0; i<this.angles.length; i++) {\r\n\t\t\t\t\tif (this.angles[i] == null) {\r\n\t\t\t\t\t\tfor (var j=i+1; j<this.angles.length; j++) {\r\n\t\t\t\t\t\t\tif (this.angles[j] != null) {\r\n\t\t\t\t\t\t\t\tthis.angles[i] = this.angles[j];\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn this.angles;\r\n\t\t\t}\r\n\t\t})(d);\r\n\r\n\t\tthis.path = function(ctx) {\r\n\t\t\tvar pp = this.PathParser;\r\n\t\t\tpp.reset();\r\n\r\n\t\t\tvar bb = new svg.BoundingBox();\r\n\t\t\tif (ctx != null) ctx.beginPath();\r\n\t\t\twhile (!pp.isEnd()) {\r\n\t\t\t\tpp.nextCommand();\r\n\t\t\t\tswitch (pp.command) {\r\n\t\t\t\tcase 'M':\r\n\t\t\t\tcase 'm':\r\n\t\t\t\t\tvar p = pp.getAsCurrentPoint();\r\n\t\t\t\t\tpp.addMarker(p);\r\n\t\t\t\t\tbb.addPoint(p.x, p.y);\r\n\t\t\t\t\tif (ctx != null) ctx.moveTo(p.x, p.y);\r\n\t\t\t\t\tpp.start = pp.current;\r\n\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\tvar p = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\tpp.addMarker(p, pp.start);\r\n\t\t\t\t\t\tbb.addPoint(p.x, p.y);\r\n\t\t\t\t\t\tif (ctx != null) ctx.lineTo(p.x, p.y);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'L':\r\n\t\t\t\tcase 'l':\r\n\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\tvar c = pp.current;\r\n\t\t\t\t\t\tvar p = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\tpp.addMarker(p, c);\r\n\t\t\t\t\t\tbb.addPoint(p.x, p.y);\r\n\t\t\t\t\t\tif (ctx != null) ctx.lineTo(p.x, p.y);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'H':\r\n\t\t\t\tcase 'h':\r\n\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\tvar newP = new svg.Point((pp.isRelativeCommand() ? pp.current.x : 0) + pp.getScalar(), pp.current.y);\r\n\t\t\t\t\t\tpp.addMarker(newP, pp.current);\r\n\t\t\t\t\t\tpp.current = newP;\r\n\t\t\t\t\t\tbb.addPoint(pp.current.x, pp.current.y);\r\n\t\t\t\t\t\tif (ctx != null) ctx.lineTo(pp.current.x, pp.current.y);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'V':\r\n\t\t\t\tcase 'v':\r\n\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\tvar newP = new svg.Point(pp.current.x, (pp.isRelativeCommand() ? pp.current.y : 0) + pp.getScalar());\r\n\t\t\t\t\t\tpp.addMarker(newP, pp.current);\r\n\t\t\t\t\t\tpp.current = newP;\r\n\t\t\t\t\t\tbb.addPoint(pp.current.x, pp.current.y);\r\n\t\t\t\t\t\tif (ctx != null) ctx.lineTo(pp.current.x, pp.current.y);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'C':\r\n\t\t\t\tcase 'c':\r\n\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\tvar curr = pp.current;\r\n\t\t\t\t\t\tvar p1 = pp.getPoint();\r\n\t\t\t\t\t\tvar cntrl = pp.getAsControlPoint();\r\n\t\t\t\t\t\tvar cp = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\tpp.addMarker(cp, cntrl, p1);\r\n\t\t\t\t\t\tbb.addBezierCurve(curr.x, curr.y, p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t\tif (ctx != null) ctx.bezierCurveTo(p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'S':\r\n\t\t\t\tcase 's':\r\n\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\tvar curr = pp.current;\r\n\t\t\t\t\t\tvar p1 = pp.getReflectedControlPoint();\r\n\t\t\t\t\t\tvar cntrl = pp.getAsControlPoint();\r\n\t\t\t\t\t\tvar cp = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\tpp.addMarker(cp, cntrl, p1);\r\n\t\t\t\t\t\tbb.addBezierCurve(curr.x, curr.y, p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t\tif (ctx != null) ctx.bezierCurveTo(p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Q':\r\n\t\t\t\tcase 'q':\r\n\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\tvar curr = pp.current;\r\n\t\t\t\t\t\tvar cntrl = pp.getAsControlPoint();\r\n\t\t\t\t\t\tvar cp = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\tpp.addMarker(cp, cntrl, cntrl);\r\n\t\t\t\t\t\tbb.addQuadraticCurve(curr.x, curr.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t\tif (ctx != null) ctx.quadraticCurveTo(cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'T':\r\n\t\t\t\tcase 't':\r\n\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\tvar curr = pp.current;\r\n\t\t\t\t\t\tvar cntrl = pp.getReflectedControlPoint();\r\n\t\t\t\t\t\tpp.control = cntrl;\r\n\t\t\t\t\t\tvar cp = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\tpp.addMarker(cp, cntrl, cntrl);\r\n\t\t\t\t\t\tbb.addQuadraticCurve(curr.x, curr.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t\tif (ctx != null) ctx.quadraticCurveTo(cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'A':\r\n\t\t\t\tcase 'a':\r\n\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t    var curr = pp.current;\r\n\t\t\t\t\t\tvar rx = pp.getScalar();\r\n\t\t\t\t\t\tvar ry = pp.getScalar();\r\n\t\t\t\t\t\tvar xAxisRotation = pp.getScalar() * (Math.PI / 180.0);\r\n\t\t\t\t\t\tvar largeArcFlag = pp.getScalar();\r\n\t\t\t\t\t\tvar sweepFlag = pp.getScalar();\r\n\t\t\t\t\t\tvar cp = pp.getAsCurrentPoint();\r\n\r\n\t\t\t\t\t\t// Conversion from endpoint to center parameterization\r\n\t\t\t\t\t\t// http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\r\n\t\t\t\t\t\t// x1', y1'\r\n\t\t\t\t\t\tvar currp = new svg.Point(\r\n\t\t\t\t\t\t\tMath.cos(xAxisRotation) * (curr.x - cp.x) / 2.0 + Math.sin(xAxisRotation) * (curr.y - cp.y) / 2.0,\r\n\t\t\t\t\t\t\t-Math.sin(xAxisRotation) * (curr.x - cp.x) / 2.0 + Math.cos(xAxisRotation) * (curr.y - cp.y) / 2.0\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\t// adjust radii\r\n\t\t\t\t\t\tvar l = Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);\r\n\t\t\t\t\t\tif (l > 1) {\r\n\t\t\t\t\t\t\trx *= Math.sqrt(l);\r\n\t\t\t\t\t\t\try *= Math.sqrt(l);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// cx', cy'\r\n\t\t\t\t\t\tvar s = (largeArcFlag == sweepFlag ? -1 : 1) * Math.sqrt(\r\n\t\t\t\t\t\t\t((Math.pow(rx,2)*Math.pow(ry,2))-(Math.pow(rx,2)*Math.pow(currp.y,2))-(Math.pow(ry,2)*Math.pow(currp.x,2))) /\r\n\t\t\t\t\t\t\t(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2))\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tif (isNaN(s)) s = 0;\r\n\t\t\t\t\t\tvar cpp = new svg.Point(s * rx * currp.y / ry, s * -ry * currp.x / rx);\r\n\t\t\t\t\t\t// cx, cy\r\n\t\t\t\t\t\tvar centp = new svg.Point(\r\n\t\t\t\t\t\t\t(curr.x + cp.x) / 2.0 + Math.cos(xAxisRotation) * cpp.x - Math.sin(xAxisRotation) * cpp.y,\r\n\t\t\t\t\t\t\t(curr.y + cp.y) / 2.0 + Math.sin(xAxisRotation) * cpp.x + Math.cos(xAxisRotation) * cpp.y\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\t// vector magnitude\r\n\t\t\t\t\t\tvar m = function(v) { return Math.sqrt(Math.pow(v[0],2) + Math.pow(v[1],2)); }\r\n\t\t\t\t\t\t// ratio between two vectors\r\n\t\t\t\t\t\tvar r = function(u, v) { return (u[0]*v[0]+u[1]*v[1]) / (m(u)*m(v)) }\r\n\t\t\t\t\t\t// angle between two vectors\r\n\t\t\t\t\t\tvar a = function(u, v) { return (u[0]*v[1] < u[1]*v[0] ? -1 : 1) * Math.acos(r(u,v)); }\r\n\t\t\t\t\t\t// initial angle\r\n\t\t\t\t\t\tvar a1 = a([1,0], [(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]);\r\n\t\t\t\t\t\t// angle delta\r\n\t\t\t\t\t\tvar u = [(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry];\r\n\t\t\t\t\t\tvar v = [(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry];\r\n\t\t\t\t\t\tvar ad = a(u, v);\r\n\t\t\t\t\t\tif (r(u,v) <= -1) ad = Math.PI;\r\n\t\t\t\t\t\tif (r(u,v) >= 1) ad = 0;\r\n\r\n\t\t\t\t\t\t// for markers\r\n\t\t\t\t\t\tvar dir = 1 - sweepFlag ? 1.0 : -1.0;\r\n\t\t\t\t\t\tvar ah = a1 + dir * (ad / 2.0);\r\n\t\t\t\t\t\tvar halfWay = new svg.Point(\r\n\t\t\t\t\t\t\tcentp.x + rx * Math.cos(ah),\r\n\t\t\t\t\t\t\tcentp.y + ry * Math.sin(ah)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tpp.addMarkerAngle(halfWay, ah - dir * Math.PI / 2);\r\n\t\t\t\t\t\tpp.addMarkerAngle(cp, ah - dir * Math.PI);\r\n\r\n\t\t\t\t\t\tbb.addPoint(cp.x, cp.y); // TODO: this is too naive, make it better\r\n\t\t\t\t\t\tif (ctx != null) {\r\n\t\t\t\t\t\t\tvar r = rx > ry ? rx : ry;\r\n\t\t\t\t\t\t\tvar sx = rx > ry ? 1 : rx / ry;\r\n\t\t\t\t\t\t\tvar sy = rx > ry ? ry / rx : 1;\r\n\r\n\t\t\t\t\t\t\tctx.translate(centp.x, centp.y);\r\n\t\t\t\t\t\t\tctx.rotate(xAxisRotation);\r\n\t\t\t\t\t\t\tctx.scale(sx, sy);\r\n\t\t\t\t\t\t\tctx.arc(0, 0, r, a1, a1 + ad, 1 - sweepFlag);\r\n\t\t\t\t\t\t\tctx.scale(1/sx, 1/sy);\r\n\t\t\t\t\t\t\tctx.rotate(-xAxisRotation);\r\n\t\t\t\t\t\t\tctx.translate(-centp.x, -centp.y);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Z':\r\n\t\t\t\tcase 'z':\r\n\t\t\t\t\tif (ctx != null) ctx.closePath();\r\n\t\t\t\t\tpp.current = pp.start;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn bb;\r\n\t\t}\r\n\r\n\t\tthis.getMarkers = function() {\r\n\t\t\tvar points = this.PathParser.getMarkerPoints();\r\n\t\t\tvar angles = this.PathParser.getMarkerAngles();\r\n\r\n\t\t\tvar markers = [];\r\n\t\t\tfor (var i=0; i<points.length; i++) {\r\n\t\t\t\tmarkers.push([points[i], angles[i]]);\r\n\t\t\t}\r\n\t\t\treturn markers;\r\n\t\t}\r\n\t}\r\n\tsvg.Element.path.prototype = new svg.Element.PathElementBase;\r\n\r\n\t// pattern element\r\n\tsvg.Element.pattern = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.createPattern = function(ctx, element) {\r\n\t\t\tvar width = this.attribute('width').toPixels('x', true);\r\n\t\t\tvar height = this.attribute('height').toPixels('y', true);\r\n\r\n\t\t\t// render me using a temporary svg element\r\n\t\t\tvar tempSvg = new svg.Element.svg();\r\n\t\t\ttempSvg.attributes['viewBox'] = new svg.Property('viewBox', this.attribute('viewBox').value);\r\n\t\t\ttempSvg.attributes['width'] = new svg.Property('width', width + 'px');\r\n\t\t\ttempSvg.attributes['height'] = new svg.Property('height', height + 'px');\r\n\t\t\ttempSvg.attributes['transform'] = new svg.Property('transform', this.attribute('patternTransform').value);\r\n\t\t\ttempSvg.children = this.children;\r\n\r\n\t\t\tvar c = document.createElement('canvas');\r\n\t\t\tc.width = width;\r\n\t\t\tc.height = height;\r\n\t\t\tvar cctx = c.getContext('2d');\r\n\t\t\tif (this.attribute('x').hasValue() && this.attribute('y').hasValue()) {\r\n\t\t\t\tcctx.translate(this.attribute('x').toPixels('x', true), this.attribute('y').toPixels('y', true));\r\n\t\t\t}\r\n\t\t\t// render 3x3 grid so when we transform there's no white space on edges\r\n\t\t\tfor (var x=-1; x<=1; x++) {\r\n\t\t\t\tfor (var y=-1; y<=1; y++) {\r\n\t\t\t\t\tcctx.save();\r\n\t\t\t\t\ttempSvg.attributes['x'] = new svg.Property('x', x * c.width);\r\n\t\t\t\t\ttempSvg.attributes['y'] = new svg.Property('y', y * c.height);\r\n\t\t\t\t\ttempSvg.render(cctx);\r\n\t\t\t\t\tcctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar pattern = ctx.createPattern(c, 'repeat');\r\n\t\t\treturn pattern;\r\n\t\t}\r\n\t}\r\n\tsvg.Element.pattern.prototype = new svg.Element.ElementBase;\r\n\r\n\t// marker element\r\n\tsvg.Element.marker = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.baseRender = this.render;\r\n\t\tthis.render = function(ctx, point, angle) {\r\n\t\t\tctx.translate(point.x, point.y);\r\n\t\t\tif (this.attribute('orient').valueOrDefault('auto') == 'auto') ctx.rotate(angle);\r\n\t\t\tif (this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth') ctx.scale(ctx.lineWidth, ctx.lineWidth);\r\n\t\t\tctx.save();\r\n\r\n\t\t\t// render me using a temporary svg element\r\n\t\t\tvar tempSvg = new svg.Element.svg();\r\n\t\t\ttempSvg.attributes['viewBox'] = new svg.Property('viewBox', this.attribute('viewBox').value);\r\n\t\t\ttempSvg.attributes['refX'] = new svg.Property('refX', this.attribute('refX').value);\r\n\t\t\ttempSvg.attributes['refY'] = new svg.Property('refY', this.attribute('refY').value);\r\n\t\t\ttempSvg.attributes['width'] = new svg.Property('width', this.attribute('markerWidth').value);\r\n\t\t\ttempSvg.attributes['height'] = new svg.Property('height', this.attribute('markerHeight').value);\r\n\t\t\ttempSvg.attributes['fill'] = new svg.Property('fill', this.attribute('fill').valueOrDefault('black'));\r\n\t\t\ttempSvg.attributes['stroke'] = new svg.Property('stroke', this.attribute('stroke').valueOrDefault('none'));\r\n\t\t\ttempSvg.children = this.children;\r\n\t\t\ttempSvg.render(ctx);\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tif (this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth') ctx.scale(1/ctx.lineWidth, 1/ctx.lineWidth);\r\n\t\t\tif (this.attribute('orient').valueOrDefault('auto') == 'auto') ctx.rotate(-angle);\r\n\t\t\tctx.translate(-point.x, -point.y);\r\n\t\t}\r\n\t}\r\n\tsvg.Element.marker.prototype = new svg.Element.ElementBase;\r\n\r\n\t// definitions element\r\n\tsvg.Element.defs = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.render = function(ctx) {\r\n\t\t\t// NOOP\r\n\t\t}\r\n\t}\r\n\tsvg.Element.defs.prototype = new svg.Element.ElementBase;\r\n\r\n\t// base for gradients\r\n\tsvg.Element.GradientBase = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.stops = [];\r\n\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\tvar child = this.children[i];\r\n\t\t\tif (child.type == 'stop') this.stops.push(child);\r\n\t\t}\r\n\r\n\t\tthis.getGradient = function() {\r\n\t\t\t// OVERRIDE ME!\r\n\t\t}\r\n\r\n\t\tthis.gradientUnits = function () {\r\n\t\t\treturn this.attribute('gradientUnits').valueOrDefault('objectBoundingBox');\r\n\t\t}\r\n\r\n\t\tthis.attributesToInherit = ['gradientUnits'];\r\n\r\n\t\tthis.inheritStopContainer = function (stopsContainer) {\r\n\t\t\tfor (var i=0; i<this.attributesToInherit.length; i++) {\r\n\t\t\t\tvar attributeToInherit = this.attributesToInherit[i];\r\n\t\t\t\tif (!this.attribute(attributeToInherit).hasValue() && stopsContainer.attribute(attributeToInherit).hasValue()) {\r\n\t\t\t\t\tthis.attribute(attributeToInherit, true).value = stopsContainer.attribute(attributeToInherit).value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.createGradient = function(ctx, element, parentOpacityProp) {\r\n\t\t\tvar stopsContainer = this;\r\n\t\t\tif (this.getHrefAttribute().hasValue()) {\r\n\t\t\t\tstopsContainer = this.getHrefAttribute().getDefinition();\r\n\t\t\t\tthis.inheritStopContainer(stopsContainer);\r\n\t\t\t}\r\n\r\n\t\t\tvar addParentOpacity = function (color) {\r\n\t\t\t\tif (parentOpacityProp.hasValue()) {\r\n\t\t\t\t\tvar p = new svg.Property('color', color);\r\n\t\t\t\t\treturn p.addOpacity(parentOpacityProp).value;\r\n\t\t\t\t}\r\n\t\t\t\treturn color;\r\n\t\t\t};\r\n\r\n\t\t\tvar g = this.getGradient(ctx, element);\r\n\t\t\tif (g == null) return addParentOpacity(stopsContainer.stops[stopsContainer.stops.length - 1].color);\r\n\t\t\tfor (var i=0; i<stopsContainer.stops.length; i++) {\r\n\t\t\t\tg.addColorStop(stopsContainer.stops[i].offset, addParentOpacity(stopsContainer.stops[i].color));\r\n\t\t\t}\r\n\r\n\t\t\tif (this.attribute('gradientTransform').hasValue()) {\r\n\t\t\t\t// render as transformed pattern on temporary canvas\r\n\t\t\t\tvar rootView = svg.ViewPort.viewPorts[0];\r\n\r\n\t\t\t\tvar rect = new svg.Element.rect();\r\n\t\t\t\trect.attributes['x'] = new svg.Property('x', -svg.MAX_VIRTUAL_PIXELS/3.0);\r\n\t\t\t\trect.attributes['y'] = new svg.Property('y', -svg.MAX_VIRTUAL_PIXELS/3.0);\r\n\t\t\t\trect.attributes['width'] = new svg.Property('width', svg.MAX_VIRTUAL_PIXELS);\r\n\t\t\t\trect.attributes['height'] = new svg.Property('height', svg.MAX_VIRTUAL_PIXELS);\r\n\r\n\t\t\t\tvar group = new svg.Element.g();\r\n\t\t\t\tgroup.attributes['transform'] = new svg.Property('transform', this.attribute('gradientTransform').value);\r\n\t\t\t\tgroup.children = [ rect ];\r\n\r\n\t\t\t\tvar tempSvg = new svg.Element.svg();\r\n\t\t\t\ttempSvg.attributes['x'] = new svg.Property('x', 0);\r\n\t\t\t\ttempSvg.attributes['y'] = new svg.Property('y', 0);\r\n\t\t\t\ttempSvg.attributes['width'] = new svg.Property('width', rootView.width);\r\n\t\t\t\ttempSvg.attributes['height'] = new svg.Property('height', rootView.height);\r\n\t\t\t\ttempSvg.children = [ group ];\r\n\r\n\t\t\t\tvar c = document.createElement('canvas');\r\n\t\t\t\tc.width = rootView.width;\r\n\t\t\t\tc.height = rootView.height;\r\n\t\t\t\tvar tempCtx = c.getContext('2d');\r\n\t\t\t\ttempCtx.fillStyle = g;\r\n\t\t\t\ttempSvg.render(tempCtx);\r\n\t\t\t\treturn tempCtx.createPattern(c, 'no-repeat');\r\n\t\t\t}\r\n\r\n\t\t\treturn g;\r\n\t\t}\r\n\t}\r\n\tsvg.Element.GradientBase.prototype = new svg.Element.ElementBase;\r\n\r\n\t// linear gradient element\r\n\tsvg.Element.linearGradient = function(node) {\r\n\t\tthis.base = svg.Element.GradientBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.attributesToInherit.push('x1');\r\n\t\tthis.attributesToInherit.push('y1');\r\n\t\tthis.attributesToInherit.push('x2');\r\n\t\tthis.attributesToInherit.push('y2');\r\n\r\n\t\tthis.getGradient = function(ctx, element) {\r\n\t\t\tvar bb = this.gradientUnits() == 'objectBoundingBox' ? element.getBoundingBox() : null;\r\n\r\n\t\t\tif (!this.attribute('x1').hasValue()\r\n\t\t\t && !this.attribute('y1').hasValue()\r\n\t\t\t && !this.attribute('x2').hasValue()\r\n\t\t\t && !this.attribute('y2').hasValue()) {\r\n\t\t\t\tthis.attribute('x1', true).value = 0;\r\n\t\t\t\tthis.attribute('y1', true).value = 0;\r\n\t\t\t\tthis.attribute('x2', true).value = 1;\r\n\t\t\t\tthis.attribute('y2', true).value = 0;\r\n\t\t\t }\r\n\r\n\t\t\tvar x1 = (this.gradientUnits() == 'objectBoundingBox'\r\n\t\t\t\t? bb.x() + bb.width() * this.attribute('x1').numValue()\r\n\t\t\t\t: this.attribute('x1').toPixels('x'));\r\n\t\t\tvar y1 = (this.gradientUnits() == 'objectBoundingBox'\r\n\t\t\t\t? bb.y() + bb.height() * this.attribute('y1').numValue()\r\n\t\t\t\t: this.attribute('y1').toPixels('y'));\r\n\t\t\tvar x2 = (this.gradientUnits() == 'objectBoundingBox'\r\n\t\t\t\t? bb.x() + bb.width() * this.attribute('x2').numValue()\r\n\t\t\t\t: this.attribute('x2').toPixels('x'));\r\n\t\t\tvar y2 = (this.gradientUnits() == 'objectBoundingBox'\r\n\t\t\t\t? bb.y() + bb.height() * this.attribute('y2').numValue()\r\n\t\t\t\t: this.attribute('y2').toPixels('y'));\r\n\r\n\t\t\tif (x1 == x2 && y1 == y2) return null;\r\n\t\t\treturn ctx.createLinearGradient(x1, y1, x2, y2);\r\n\t\t}\r\n\t}\r\n\tsvg.Element.linearGradient.prototype = new svg.Element.GradientBase;\r\n\r\n\t// radial gradient element\r\n\tsvg.Element.radialGradient = function(node) {\r\n\t\tthis.base = svg.Element.GradientBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.attributesToInherit.push('cx');\r\n\t\tthis.attributesToInherit.push('cy');\r\n\t\tthis.attributesToInherit.push('r');\r\n\t\tthis.attributesToInherit.push('fx');\r\n\t\tthis.attributesToInherit.push('fy');\r\n\r\n\t\tthis.getGradient = function(ctx, element) {\r\n\t\t\tvar bb = element.getBoundingBox();\r\n\r\n\t\t\tif (!this.attribute('cx').hasValue()) this.attribute('cx', true).value = '50%';\r\n\t\t\tif (!this.attribute('cy').hasValue()) this.attribute('cy', true).value = '50%';\r\n\t\t\tif (!this.attribute('r').hasValue()) this.attribute('r', true).value = '50%';\r\n\r\n\t\t\tvar cx = (this.gradientUnits() == 'objectBoundingBox'\r\n\t\t\t\t? bb.x() + bb.width() * this.attribute('cx').numValue()\r\n\t\t\t\t: this.attribute('cx').toPixels('x'));\r\n\t\t\tvar cy = (this.gradientUnits() == 'objectBoundingBox'\r\n\t\t\t\t? bb.y() + bb.height() * this.attribute('cy').numValue()\r\n\t\t\t\t: this.attribute('cy').toPixels('y'));\r\n\r\n\t\t\tvar fx = cx;\r\n\t\t\tvar fy = cy;\r\n\t\t\tif (this.attribute('fx').hasValue()) {\r\n\t\t\t\tfx = (this.gradientUnits() == 'objectBoundingBox'\r\n\t\t\t\t? bb.x() + bb.width() * this.attribute('fx').numValue()\r\n\t\t\t\t: this.attribute('fx').toPixels('x'));\r\n\t\t\t}\r\n\t\t\tif (this.attribute('fy').hasValue()) {\r\n\t\t\t\tfy = (this.gradientUnits() == 'objectBoundingBox'\r\n\t\t\t\t? bb.y() + bb.height() * this.attribute('fy').numValue()\r\n\t\t\t\t: this.attribute('fy').toPixels('y'));\r\n\t\t\t}\r\n\r\n\t\t\tvar r = (this.gradientUnits() == 'objectBoundingBox'\r\n\t\t\t\t? (bb.width() + bb.height()) / 2.0 * this.attribute('r').numValue()\r\n\t\t\t\t: this.attribute('r').toPixels());\r\n\r\n\t\t\treturn ctx.createRadialGradient(fx, fy, 0, cx, cy, r);\r\n\t\t}\r\n\t}\r\n\tsvg.Element.radialGradient.prototype = new svg.Element.GradientBase;\r\n\r\n\t// gradient stop element\r\n\tsvg.Element.stop = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.offset = this.attribute('offset').numValue();\r\n\t\tif (this.offset < 0) this.offset = 0;\r\n\t\tif (this.offset > 1) this.offset = 1;\r\n\r\n\t\tvar stopColor = this.style('stop-color', true);\r\n\t\tif (stopColor.value == '') stopColor.value = '#000';\r\n\t\tif (this.style('stop-opacity').hasValue()) stopColor = stopColor.addOpacity(this.style('stop-opacity'));\r\n\t\tthis.color = stopColor.value;\r\n\t}\r\n\tsvg.Element.stop.prototype = new svg.Element.ElementBase;\r\n\r\n\t// animation base element\r\n\tsvg.Element.AnimateBase = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tsvg.Animations.push(this);\r\n\r\n\t\tthis.duration = 0.0;\r\n\t\tthis.begin = this.attribute('begin').toMilliseconds();\r\n\t\tthis.maxDuration = this.begin + this.attribute('dur').toMilliseconds();\r\n\r\n\t\tthis.getProperty = function() {\r\n\t\t\tvar attributeType = this.attribute('attributeType').value;\r\n\t\t\tvar attributeName = this.attribute('attributeName').value;\r\n\r\n\t\t\tif (attributeType == 'CSS') {\r\n\t\t\t\treturn this.parent.style(attributeName, true);\r\n\t\t\t}\r\n\t\t\treturn this.parent.attribute(attributeName, true);\r\n\t\t};\r\n\r\n\t\tthis.initialValue = null;\r\n\t\tthis.initialUnits = '';\r\n\t\tthis.removed = false;\r\n\r\n\t\tthis.calcValue = function() {\r\n\t\t\t// OVERRIDE ME!\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tthis.update = function(delta) {\r\n\t\t\t// set initial value\r\n\t\t\tif (this.initialValue == null) {\r\n\t\t\t\tthis.initialValue = this.getProperty().value;\r\n\t\t\t\tthis.initialUnits = this.getProperty().getUnits();\r\n\t\t\t}\r\n\r\n\t\t\t// if we're past the end time\r\n\t\t\tif (this.duration > this.maxDuration) {\r\n\t\t\t\t// loop for indefinitely repeating animations\r\n\t\t\t\tif (this.attribute('repeatCount').value == 'indefinite'\r\n\t\t\t\t || this.attribute('repeatDur').value == 'indefinite') {\r\n\t\t\t\t\tthis.duration = 0.0\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.attribute('fill').valueOrDefault('remove') == 'freeze' && !this.frozen) {\r\n\t\t\t\t\tthis.frozen = true;\r\n\t\t\t\t\tthis.parent.animationFrozen = true;\r\n\t\t\t\t\tthis.parent.animationFrozenValue = this.getProperty().value;\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.attribute('fill').valueOrDefault('remove') == 'remove' && !this.removed) {\r\n\t\t\t\t\tthis.removed = true;\r\n\t\t\t\t\tthis.getProperty().value = this.parent.animationFrozen ? this.parent.animationFrozenValue : this.initialValue;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tthis.duration = this.duration + delta;\r\n\r\n\t\t\t// if we're past the begin time\r\n\t\t\tvar updated = false;\r\n\t\t\tif (this.begin < this.duration) {\r\n\t\t\t\tvar newValue = this.calcValue(); // tween\r\n\r\n\t\t\t\tif (this.attribute('type').hasValue()) {\r\n\t\t\t\t\t// for transform, etc.\r\n\t\t\t\t\tvar type = this.attribute('type').value;\r\n\t\t\t\t\tnewValue = type + '(' + newValue + ')';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.getProperty().value = newValue;\r\n\t\t\t\tupdated = true;\r\n\t\t\t}\r\n\r\n\t\t\treturn updated;\r\n\t\t}\r\n\r\n\t\tthis.from = this.attribute('from');\r\n\t\tthis.to = this.attribute('to');\r\n\t\tthis.values = this.attribute('values');\r\n\t\tif (this.values.hasValue()) this.values.value = this.values.value.split(';');\r\n\r\n\t\t// fraction of duration we've covered\r\n\t\tthis.progress = function() {\r\n\t\t\tvar ret = { progress: (this.duration - this.begin) / (this.maxDuration - this.begin) };\r\n\t\t\tif (this.values.hasValue()) {\r\n\t\t\t\tvar p = ret.progress * (this.values.value.length - 1);\r\n\t\t\t\tvar lb = Math.floor(p), ub = Math.ceil(p);\r\n\t\t\t\tret.from = new svg.Property('from', parseFloat(this.values.value[lb]));\r\n\t\t\t\tret.to = new svg.Property('to', parseFloat(this.values.value[ub]));\r\n\t\t\t\tret.progress = (p - lb) / (ub - lb);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tret.from = this.from;\r\n\t\t\t\tret.to = this.to;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t}\r\n\tsvg.Element.AnimateBase.prototype = new svg.Element.ElementBase;\r\n\r\n\t// animate element\r\n\tsvg.Element.animate = function(node) {\r\n\t\tthis.base = svg.Element.AnimateBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.calcValue = function() {\r\n\t\t\tvar p = this.progress();\r\n\r\n\t\t\t// tween value linearly\r\n\t\t\tvar newValue = p.from.numValue() + (p.to.numValue() - p.from.numValue()) * p.progress;\r\n\t\t\treturn newValue + this.initialUnits;\r\n\t\t};\r\n\t}\r\n\tsvg.Element.animate.prototype = new svg.Element.AnimateBase;\r\n\r\n\t// animate color element\r\n\tsvg.Element.animateColor = function(node) {\r\n\t\tthis.base = svg.Element.AnimateBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.calcValue = function() {\r\n\t\t\tvar p = this.progress();\r\n\t\t\tvar from = new RGBColor(p.from.value);\r\n\t\t\tvar to = new RGBColor(p.to.value);\r\n\r\n\t\t\tif (from.ok && to.ok) {\r\n\t\t\t\t// tween color linearly\r\n\t\t\t\tvar r = from.r + (to.r - from.r) * p.progress;\r\n\t\t\t\tvar g = from.g + (to.g - from.g) * p.progress;\r\n\t\t\t\tvar b = from.b + (to.b - from.b) * p.progress;\r\n\t\t\t\treturn 'rgb('+parseInt(r,10)+','+parseInt(g,10)+','+parseInt(b,10)+')';\r\n\t\t\t}\r\n\t\t\treturn this.attribute('from').value;\r\n\t\t};\r\n\t}\r\n\tsvg.Element.animateColor.prototype = new svg.Element.AnimateBase;\r\n\r\n\t// animate transform element\r\n\tsvg.Element.animateTransform = function(node) {\r\n\t\tthis.base = svg.Element.AnimateBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.calcValue = function() {\r\n\t\t\tvar p = this.progress();\r\n\r\n\t\t\t// tween value linearly\r\n\t\t\tvar from = svg.ToNumberArray(p.from.value);\r\n\t\t\tvar to = svg.ToNumberArray(p.to.value);\r\n\t\t\tvar newValue = '';\r\n\t\t\tfor (var i=0; i<from.length; i++) {\r\n\t\t\t\tnewValue += from[i] + (to[i] - from[i]) * p.progress + ' ';\r\n\t\t\t}\r\n\t\t\treturn newValue;\r\n\t\t};\r\n\t}\r\n\tsvg.Element.animateTransform.prototype = new svg.Element.animate;\r\n\r\n\t// font element\r\n\tsvg.Element.font = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.horizAdvX = this.attribute('horiz-adv-x').numValue();\r\n\r\n\t\tthis.isRTL = false;\r\n\t\tthis.isArabic = false;\r\n\t\tthis.fontFace = null;\r\n\t\tthis.missingGlyph = null;\r\n\t\tthis.glyphs = [];\r\n\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\tvar child = this.children[i];\r\n\t\t\tif (child.type == 'font-face') {\r\n\t\t\t\tthis.fontFace = child;\r\n\t\t\t\tif (child.style('font-family').hasValue()) {\r\n\t\t\t\t\tsvg.Definitions[child.style('font-family').value] = this;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (child.type == 'missing-glyph') this.missingGlyph = child;\r\n\t\t\telse if (child.type == 'glyph') {\r\n\t\t\t\tif (child.arabicForm != '') {\r\n\t\t\t\t\tthis.isRTL = true;\r\n\t\t\t\t\tthis.isArabic = true;\r\n\t\t\t\t\tif (typeof this.glyphs[child.unicode] == 'undefined') this.glyphs[child.unicode] = [];\r\n\t\t\t\t\tthis.glyphs[child.unicode][child.arabicForm] = child;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.glyphs[child.unicode] = child;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tsvg.Element.font.prototype = new svg.Element.ElementBase;\r\n\r\n\t// font-face element\r\n\tsvg.Element.fontface = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.ascent = this.attribute('ascent').value;\r\n\t\tthis.descent = this.attribute('descent').value;\r\n\t\tthis.unitsPerEm = this.attribute('units-per-em').numValue();\r\n\t}\r\n\tsvg.Element.fontface.prototype = new svg.Element.ElementBase;\r\n\r\n\t// missing-glyph element\r\n\tsvg.Element.missingglyph = function(node) {\r\n\t\tthis.base = svg.Element.path;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.horizAdvX = 0;\r\n\t}\r\n\tsvg.Element.missingglyph.prototype = new svg.Element.path;\r\n\r\n\t// glyph element\r\n\tsvg.Element.glyph = function(node) {\r\n\t\tthis.base = svg.Element.path;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.horizAdvX = this.attribute('horiz-adv-x').numValue();\r\n\t\tthis.unicode = this.attribute('unicode').value;\r\n\t\tthis.arabicForm = this.attribute('arabic-form').value;\r\n\t}\r\n\tsvg.Element.glyph.prototype = new svg.Element.path;\r\n\r\n\t// text element\r\n\tsvg.Element.text = function(node) {\r\n\t\tthis.captureTextNodes = true;\r\n\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.baseSetContext = this.setContext;\r\n\t\tthis.setContext = function(ctx) {\r\n\t\t\tthis.baseSetContext(ctx);\r\n\r\n\t\t\tvar textBaseline = this.style('dominant-baseline').toTextBaseline();\r\n\t\t\tif (textBaseline == null) textBaseline = this.style('alignment-baseline').toTextBaseline();\r\n\t\t\tif (textBaseline != null) ctx.textBaseline = textBaseline;\r\n\t\t}\r\n\r\n\t\tthis.getBoundingBox = function () {\r\n\t\t\tvar x = this.attribute('x').toPixels('x');\r\n\t\t\tvar y = this.attribute('y').toPixels('y');\r\n\t\t\tvar fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);\r\n\t\t\treturn new svg.BoundingBox(x, y - fontSize, x + Math.floor(fontSize * 2.0 / 3.0) * this.children[0].getText().length, y);\r\n\t\t}\r\n\r\n\t\tthis.renderChildren = function(ctx) {\r\n\t\t\tthis.x = this.attribute('x').toPixels('x');\r\n\t\t\tthis.y = this.attribute('y').toPixels('y');\r\n\t\t\tif (this.attribute('dx').hasValue()) this.x += this.attribute('dx').toPixels('x');\r\n\t\t\tif (this.attribute('dy').hasValue()) this.y += this.attribute('dy').toPixels('y');\r\n\t\t\tthis.x += this.getAnchorDelta(ctx, this, 0);\r\n\t\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\t\tthis.renderChild(ctx, this, this, i);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.getAnchorDelta = function (ctx, parent, startI) {\r\n\t\t\tvar textAnchor = this.style('text-anchor').valueOrDefault('start');\r\n\t\t\tif (textAnchor != 'start') {\r\n\t\t\t\tvar width = 0;\r\n\t\t\t\tfor (var i=startI; i<parent.children.length; i++) {\r\n\t\t\t\t\tvar child = parent.children[i];\r\n\t\t\t\t\tif (i > startI && child.attribute('x').hasValue()) break; // new group\r\n\t\t\t\t\twidth += child.measureTextRecursive(ctx);\r\n\t\t\t\t}\r\n\t\t\t\treturn -1 * (textAnchor == 'end' ? width : width / 2.0);\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tthis.renderChild = function(ctx, textParent, parent, i) {\r\n\t\t\tvar child = parent.children[i];\r\n\t\t\tif (child.attribute('x').hasValue()) {\r\n\t\t\t\tchild.x = child.attribute('x').toPixels('x') + textParent.getAnchorDelta(ctx, parent, i);\r\n\t\t\t\tif (child.attribute('dx').hasValue()) child.x += child.attribute('dx').toPixels('x');\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (child.attribute('dx').hasValue()) textParent.x += child.attribute('dx').toPixels('x');\r\n\t\t\t\tchild.x = textParent.x;\r\n\t\t\t}\r\n\t\t\ttextParent.x = child.x + child.measureText(ctx);\r\n\r\n\t\t\tif (child.attribute('y').hasValue()) {\r\n\t\t\t\tchild.y = child.attribute('y').toPixels('y');\r\n\t\t\t\tif (child.attribute('dy').hasValue()) child.y += child.attribute('dy').toPixels('y');\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (child.attribute('dy').hasValue()) textParent.y += child.attribute('dy').toPixels('y');\r\n\t\t\t\tchild.y = textParent.y;\r\n\t\t\t}\r\n\t\t\ttextParent.y = child.y;\r\n\r\n\t\t\tchild.render(ctx);\r\n\r\n\t\t\tfor (var i=0; i<child.children.length; i++) {\r\n\t\t\t\ttextParent.renderChild(ctx, textParent, child, i);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tsvg.Element.text.prototype = new svg.Element.RenderedElementBase;\r\n\r\n\t// text base\r\n\tsvg.Element.TextElementBase = function(node) {\r\n\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.getGlyph = function(font, text, i) {\r\n\t\t\tvar c = text[i];\r\n\t\t\tvar glyph = null;\r\n\t\t\tif (font.isArabic) {\r\n\t\t\t\tvar arabicForm = 'isolated';\r\n\t\t\t\tif ((i==0 || text[i-1]==' ') && i<text.length-2 && text[i+1]!=' ') arabicForm = 'terminal';\r\n\t\t\t\tif (i>0 && text[i-1]!=' ' && i<text.length-2 && text[i+1]!=' ') arabicForm = 'medial';\r\n\t\t\t\tif (i>0 && text[i-1]!=' ' && (i == text.length-1 || text[i+1]==' ')) arabicForm = 'initial';\r\n\t\t\t\tif (typeof font.glyphs[c] != 'undefined') {\r\n\t\t\t\t\tglyph = font.glyphs[c][arabicForm];\r\n\t\t\t\t\tif (glyph == null && font.glyphs[c].type == 'glyph') glyph = font.glyphs[c];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tglyph = font.glyphs[c];\r\n\t\t\t}\r\n\t\t\tif (glyph == null) glyph = font.missingGlyph;\r\n\t\t\treturn glyph;\r\n\t\t}\r\n\r\n\t\tthis.renderChildren = function(ctx) {\r\n\t\t\tvar customFont = this.parent.style('font-family').getDefinition();\r\n\t\t\tif (customFont != null) {\r\n\t\t\t\tvar fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);\r\n\t\t\t\tvar fontStyle = this.parent.style('font-style').valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle);\r\n\t\t\t\tvar text = this.getText();\r\n\t\t\t\tif (customFont.isRTL) text = text.split(\"\").reverse().join(\"\");\r\n\r\n\t\t\t\tvar dx = svg.ToNumberArray(this.parent.attribute('dx').value);\r\n\t\t\t\tfor (var i=0; i<text.length; i++) {\r\n\t\t\t\t\tvar glyph = this.getGlyph(customFont, text, i);\r\n\t\t\t\t\tvar scale = fontSize / customFont.fontFace.unitsPerEm;\r\n\t\t\t\t\tctx.translate(this.x, this.y);\r\n\t\t\t\t\tctx.scale(scale, -scale);\r\n\t\t\t\t\tvar lw = ctx.lineWidth;\r\n\t\t\t\t\tctx.lineWidth = ctx.lineWidth * customFont.fontFace.unitsPerEm / fontSize;\r\n\t\t\t\t\tif (fontStyle == 'italic') ctx.transform(1, 0, .4, 1, 0, 0);\r\n\t\t\t\t\tglyph.render(ctx);\r\n\t\t\t\t\tif (fontStyle == 'italic') ctx.transform(1, 0, -.4, 1, 0, 0);\r\n\t\t\t\t\tctx.lineWidth = lw;\r\n\t\t\t\t\tctx.scale(1/scale, -1/scale);\r\n\t\t\t\t\tctx.translate(-this.x, -this.y);\r\n\r\n\t\t\t\t\tthis.x += fontSize * (glyph.horizAdvX || customFont.horizAdvX) / customFont.fontFace.unitsPerEm;\r\n\t\t\t\t\tif (typeof dx[i] != 'undefined' && !isNaN(dx[i])) {\r\n\t\t\t\t\t\tthis.x += dx[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (ctx.fillStyle != '') ctx.fillText(svg.compressSpaces(this.getText()), this.x, this.y);\r\n\t\t\tif (ctx.strokeStyle != '') ctx.strokeText(svg.compressSpaces(this.getText()), this.x, this.y);\r\n\t\t}\r\n\r\n\t\tthis.getText = function() {\r\n\t\t\t// OVERRIDE ME\r\n\t\t}\r\n\r\n\t\tthis.measureTextRecursive = function(ctx) {\r\n\t\t\tvar width = this.measureText(ctx);\r\n\t\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\t\twidth += this.children[i].measureTextRecursive(ctx);\r\n\t\t\t}\r\n\t\t\treturn width;\r\n\t\t}\r\n\r\n\t\tthis.measureText = function(ctx) {\r\n\t\t\tvar customFont = this.parent.style('font-family').getDefinition();\r\n\t\t\tif (customFont != null) {\r\n\t\t\t\tvar fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);\r\n\t\t\t\tvar measure = 0;\r\n\t\t\t\tvar text = this.getText();\r\n\t\t\t\tif (customFont.isRTL) text = text.split(\"\").reverse().join(\"\");\r\n\t\t\t\tvar dx = svg.ToNumberArray(this.parent.attribute('dx').value);\r\n\t\t\t\tfor (var i=0; i<text.length; i++) {\r\n\t\t\t\t\tvar glyph = this.getGlyph(customFont, text, i);\r\n\t\t\t\t\tmeasure += (glyph.horizAdvX || customFont.horizAdvX) * fontSize / customFont.fontFace.unitsPerEm;\r\n\t\t\t\t\tif (typeof dx[i] != 'undefined' && !isNaN(dx[i])) {\r\n\t\t\t\t\t\tmeasure += dx[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn measure;\r\n\t\t\t}\r\n\r\n\t\t\tvar textToMeasure = svg.compressSpaces(this.getText());\r\n\t\t\tif (!ctx.measureText) return textToMeasure.length * 10;\r\n\r\n\t\t\tctx.save();\r\n\t\t\tthis.setContext(ctx);\r\n\t\t\tvar width = ctx.measureText(textToMeasure).width;\r\n\t\t\tctx.restore();\r\n\t\t\treturn width;\r\n\t\t}\r\n\t}\r\n\tsvg.Element.TextElementBase.prototype = new svg.Element.RenderedElementBase;\r\n\r\n\t// tspan\r\n\tsvg.Element.tspan = function(node) {\r\n\t\tthis.captureTextNodes = true;\r\n\t\tthis.base = svg.Element.TextElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.text = svg.compressSpaces(node.value || node.text || node.textContent || '');\r\n\t\tthis.getText = function() {\r\n\t\t\t// if this node has children, then they own the text\r\n\t\t\tif (this.children.length > 0) { return ''; }\r\n\t\t\treturn this.text;\r\n\t\t}\r\n\t}\r\n\tsvg.Element.tspan.prototype = new svg.Element.TextElementBase;\r\n\r\n\t// tref\r\n\tsvg.Element.tref = function(node) {\r\n\t\tthis.base = svg.Element.TextElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.getText = function() {\r\n\t\t\tvar element = this.getHrefAttribute().getDefinition();\r\n\t\t\tif (element != null) return element.children[0].getText();\r\n\t\t}\r\n\t}\r\n\tsvg.Element.tref.prototype = new svg.Element.TextElementBase;\r\n\r\n\t// a element\r\n\tsvg.Element.a = function(node) {\r\n\t\tthis.base = svg.Element.TextElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.hasText = node.childNodes.length > 0;\r\n\t\tfor (var i=0; i<node.childNodes.length; i++) {\r\n\t\t\tif (node.childNodes[i].nodeType != 3) this.hasText = false;\r\n\t\t}\r\n\r\n\t\t// this might contain text\r\n\t\tthis.text = this.hasText ? node.childNodes[0].value : '';\r\n\t\tthis.getText = function() {\r\n\t\t\treturn this.text;\r\n\t\t}\r\n\r\n\t\tthis.baseRenderChildren = this.renderChildren;\r\n\t\tthis.renderChildren = function(ctx) {\r\n\t\t\tif (this.hasText) {\r\n\t\t\t\t// render as text element\r\n\t\t\t\tthis.baseRenderChildren(ctx);\r\n\t\t\t\tvar fontSize = new svg.Property('fontSize', svg.Font.Parse(svg.ctx.font).fontSize);\r\n\t\t\t\tsvg.Mouse.checkBoundingBox(this, new svg.BoundingBox(this.x, this.y - fontSize.toPixels('y'), this.x + this.measureText(ctx), this.y));\r\n\t\t\t}\r\n\t\t\telse if (this.children.length > 0) {\r\n\t\t\t\t// render as temporary group\r\n\t\t\t\tvar g = new svg.Element.g();\r\n\t\t\t\tg.children = this.children;\r\n\t\t\t\tg.parent = this;\r\n\t\t\t\tg.render(ctx);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.onclick = function() {\r\n\t\t\twindow.open(this.getHrefAttribute().value);\r\n\t\t}\r\n\r\n\t\tthis.onmousemove = function() {\r\n\t\t\tsvg.ctx.canvas.style.cursor = 'pointer';\r\n\t\t}\r\n\t}\r\n\tsvg.Element.a.prototype = new svg.Element.TextElementBase;\r\n\r\n\t// image element\r\n\tsvg.Element.image = function(node) {\r\n\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tvar href = this.getHrefAttribute().value;\r\n\t\tif (href == '') { return; }\r\n\t\tvar isSvg = href.match(/\\.svg$/)\r\n\r\n\t\tsvg.Images.push(this);\r\n\t\tthis.loaded = false;\r\n\t\tif (!isSvg) {\r\n\t\t\tthis.img = document.createElement('img');\r\n\t\t\tif (svg.opts['useCORS'] == true) { this.img.crossOrigin = 'Anonymous'; }\r\n\t\t\tvar self = this;\r\n\t\t\tthis.img.onload = function() { self.loaded = true; }\r\n\t\t\tthis.img.onerror = function() { svg.log('ERROR: image \"' + href + '\" not found'); self.loaded = true; }\r\n\t\t\tthis.img.src = href;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.img = svg.ajax(href);\r\n\t\t\tthis.loaded = true;\r\n\t\t}\r\n\r\n\t\tthis.renderChildren = function(ctx) {\r\n\t\t\tvar x = this.attribute('x').toPixels('x');\r\n\t\t\tvar y = this.attribute('y').toPixels('y');\r\n\r\n\t\t\tvar width = this.attribute('width').toPixels('x');\r\n\t\t\tvar height = this.attribute('height').toPixels('y');\r\n\t\t\tif (width == 0 || height == 0) return;\r\n\r\n\t\t\tctx.save();\r\n\t\t\tif (isSvg) {\r\n\t\t\t\tctx.drawSvg(this.img, x, y, width, height);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tctx.translate(x, y);\r\n\t\t\t\tsvg.AspectRatio(ctx,\r\n\t\t\t\t\t\t\t\tthis.attribute('preserveAspectRatio').value,\r\n\t\t\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\t\t\tthis.img.width,\r\n\t\t\t\t\t\t\t\theight,\r\n\t\t\t\t\t\t\t\tthis.img.height,\r\n\t\t\t\t\t\t\t\t0,\r\n\t\t\t\t\t\t\t\t0);\r\n\t\t\t\tctx.drawImage(this.img, 0, 0);\r\n\t\t\t}\r\n\t\t\tctx.restore();\r\n\t\t}\r\n\r\n\t\tthis.getBoundingBox = function() {\r\n\t\t\tvar x = this.attribute('x').toPixels('x');\r\n\t\t\tvar y = this.attribute('y').toPixels('y');\r\n\t\t\tvar width = this.attribute('width').toPixels('x');\r\n\t\t\tvar height = this.attribute('height').toPixels('y');\r\n\t\t\treturn new svg.BoundingBox(x, y, x + width, y + height);\r\n\t\t}\r\n\t}\r\n\tsvg.Element.image.prototype = new svg.Element.RenderedElementBase;\r\n\r\n\t// group element\r\n\tsvg.Element.g = function(node) {\r\n\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.getBoundingBox = function() {\r\n\t\t\tvar bb = new svg.BoundingBox();\r\n\t\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\t\tbb.addBoundingBox(this.children[i].getBoundingBox());\r\n\t\t\t}\r\n\t\t\treturn bb;\r\n\t\t};\r\n\t}\r\n\tsvg.Element.g.prototype = new svg.Element.RenderedElementBase;\r\n\r\n\t// symbol element\r\n\tsvg.Element.symbol = function(node) {\r\n\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.render = function(ctx) {\r\n\t\t\t// NO RENDER\r\n\t\t};\r\n\t}\r\n\tsvg.Element.symbol.prototype = new svg.Element.RenderedElementBase;\r\n\r\n\t// style element\r\n\tsvg.Element.style = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\t// text, or spaces then CDATA\r\n\t\tvar css = ''\r\n\t\tfor (var i=0; i<node.childNodes.length; i++) {\r\n\t\t  css += node.childNodes[i].data;\r\n\t\t}\r\n\t\tcss = css.replace(/(\\/\\*([^*]|[\\r\\n]|(\\*+([^*\\/]|[\\r\\n])))*\\*+\\/)|(^[\\s]*\\/\\/.*)/gm, ''); // remove comments\r\n\t\tcss = svg.compressSpaces(css); // replace whitespace\r\n\t\tvar cssDefs = css.split('}');\r\n\t\tfor (var i=0; i<cssDefs.length; i++) {\r\n\t\t\tif (svg.trim(cssDefs[i]) != '') {\r\n\t\t\t\tvar cssDef = cssDefs[i].split('{');\r\n\t\t\t\tvar cssClasses = cssDef[0].split(',');\r\n\t\t\t\tvar cssProps = cssDef[1].split(';');\r\n\t\t\t\tfor (var j=0; j<cssClasses.length; j++) {\r\n\t\t\t\t\tvar cssClass = svg.trim(cssClasses[j]);\r\n\t\t\t\t\tif (cssClass != '') {\r\n\t\t\t\t\t\tvar props = svg.Styles[cssClass] || {};\r\n\t\t\t\t\t\tfor (var k=0; k<cssProps.length; k++) {\r\n\t\t\t\t\t\t\tvar prop = cssProps[k].indexOf(':');\r\n\t\t\t\t\t\t\tvar name = cssProps[k].substr(0, prop);\r\n\t\t\t\t\t\t\tvar value = cssProps[k].substr(prop + 1, cssProps[k].length - prop);\r\n\t\t\t\t\t\t\tif (name != null && value != null) {\r\n\t\t\t\t\t\t\t\tprops[svg.trim(name)] = new svg.Property(svg.trim(name), svg.trim(value));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsvg.Styles[cssClass] = props;\r\n\t\t\t\t\t\tsvg.StylesSpecificity[cssClass] = getSelectorSpecificity(cssClass);\r\n\t\t\t\t\t\tif (cssClass == '@font-face') {\r\n\t\t\t\t\t\t\tvar fontFamily = props['font-family'].value.replace(/\"/g,'');\r\n\t\t\t\t\t\t\tvar srcs = props['src'].value.split(',');\r\n\t\t\t\t\t\t\tfor (var s=0; s<srcs.length; s++) {\r\n\t\t\t\t\t\t\t\tif (srcs[s].indexOf('format(\"svg\")') > 0) {\r\n\t\t\t\t\t\t\t\t\tvar urlStart = srcs[s].indexOf('url');\r\n\t\t\t\t\t\t\t\t\tvar urlEnd = srcs[s].indexOf(')', urlStart);\r\n\t\t\t\t\t\t\t\t\tvar url = srcs[s].substr(urlStart + 5, urlEnd - urlStart - 6);\r\n\t\t\t\t\t\t\t\t\tvar doc = svg.parseXml(svg.ajax(url));\r\n\t\t\t\t\t\t\t\t\tvar fonts = doc.getElementsByTagName('font');\r\n\t\t\t\t\t\t\t\t\tfor (var f=0; f<fonts.length; f++) {\r\n\t\t\t\t\t\t\t\t\t\tvar font = svg.CreateElement(fonts[f]);\r\n\t\t\t\t\t\t\t\t\t\tsvg.Definitions[fontFamily] = font;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tsvg.Element.style.prototype = new svg.Element.ElementBase;\r\n\r\n\t// use element\r\n\tsvg.Element.use = function(node) {\r\n\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.baseSetContext = this.setContext;\r\n\t\tthis.setContext = function(ctx) {\r\n\t\t\tthis.baseSetContext(ctx);\r\n\t\t\tif (this.attribute('x').hasValue()) ctx.translate(this.attribute('x').toPixels('x'), 0);\r\n\t\t\tif (this.attribute('y').hasValue()) ctx.translate(0, this.attribute('y').toPixels('y'));\r\n\t\t}\r\n\r\n\t\tvar element = this.getHrefAttribute().getDefinition();\r\n\r\n\t\tthis.path = function(ctx) {\r\n\t\t\tif (element != null) element.path(ctx);\r\n\t\t}\r\n\r\n\t\tthis.getBoundingBox = function() {\r\n\t\t\tif (element != null) return element.getBoundingBox();\r\n\t\t}\r\n\r\n\t\tthis.renderChildren = function(ctx) {\r\n\t\t\tif (element != null) {\r\n\t\t\t\tvar tempSvg = element;\r\n\t\t\t\tif (element.type == 'symbol') {\r\n\t\t\t\t\t// render me using a temporary svg element in symbol cases (http://www.w3.org/TR/SVG/struct.html#UseElement)\r\n\t\t\t\t\ttempSvg = new svg.Element.svg();\r\n\t\t\t\t\ttempSvg.type = 'svg';\r\n\t\t\t\t\ttempSvg.attributes['viewBox'] = new svg.Property('viewBox', element.attribute('viewBox').value);\r\n\t\t\t\t\ttempSvg.attributes['preserveAspectRatio'] = new svg.Property('preserveAspectRatio', element.attribute('preserveAspectRatio').value);\r\n\t\t\t\t\ttempSvg.attributes['overflow'] = new svg.Property('overflow', element.attribute('overflow').value);\r\n\t\t\t\t\ttempSvg.children = element.children;\r\n\t\t\t\t}\r\n\t\t\t\tif (tempSvg.type == 'svg') {\r\n\t\t\t\t\t// if symbol or svg, inherit width/height from me\r\n\t\t\t\t\tif (this.attribute('width').hasValue()) tempSvg.attributes['width'] = new svg.Property('width', this.attribute('width').value);\r\n\t\t\t\t\tif (this.attribute('height').hasValue()) tempSvg.attributes['height'] = new svg.Property('height', this.attribute('height').value);\r\n\t\t\t\t}\r\n\t\t\t\tvar oldParent = tempSvg.parent;\r\n\t\t\t\ttempSvg.parent = null;\r\n\t\t\t\ttempSvg.render(ctx);\r\n\t\t\t\ttempSvg.parent = oldParent;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tsvg.Element.use.prototype = new svg.Element.RenderedElementBase;\r\n\r\n\t// mask element\r\n\tsvg.Element.mask = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.apply = function(ctx, element) {\r\n\t\t\t// render as temp svg\r\n\t\t\tvar x = this.attribute('x').toPixels('x');\r\n\t\t\tvar y = this.attribute('y').toPixels('y');\r\n\t\t\tvar width = this.attribute('width').toPixels('x');\r\n\t\t\tvar height = this.attribute('height').toPixels('y');\r\n\r\n\t\t\tif (width == 0 && height == 0) {\r\n\t\t\t\tvar bb = new svg.BoundingBox();\r\n\t\t\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\t\t\tbb.addBoundingBox(this.children[i].getBoundingBox());\r\n\t\t\t\t}\r\n\t\t\t\tvar x = Math.floor(bb.x1);\r\n\t\t\t\tvar y = Math.floor(bb.y1);\r\n\t\t\t\tvar width = Math.floor(bb.width());\r\n\t\t\t\tvar\theight = Math.floor(bb.height());\r\n\t\t\t}\r\n\r\n\t\t\t// temporarily remove mask to avoid recursion\r\n\t\t\tvar mask = element.attribute('mask').value;\r\n\t\t\telement.attribute('mask').value = '';\r\n\r\n\t\t\t\tvar cMask = document.createElement('canvas');\r\n\t\t\t\tcMask.width = x + width;\r\n\t\t\t\tcMask.height = y + height;\r\n\t\t\t\tvar maskCtx = cMask.getContext('2d');\r\n\t\t\t\tthis.renderChildren(maskCtx);\r\n\r\n\t\t\t\tvar c = document.createElement('canvas');\r\n\t\t\t\tc.width = x + width;\r\n\t\t\t\tc.height = y + height;\r\n\t\t\t\tvar tempCtx = c.getContext('2d');\r\n\t\t\t\telement.render(tempCtx);\r\n\t\t\t\ttempCtx.globalCompositeOperation = 'destination-in';\r\n\t\t\t\ttempCtx.fillStyle = maskCtx.createPattern(cMask, 'no-repeat');\r\n\t\t\t\ttempCtx.fillRect(0, 0, x + width, y + height);\r\n\r\n\t\t\t\tctx.fillStyle = tempCtx.createPattern(c, 'no-repeat');\r\n\t\t\t\tctx.fillRect(0, 0, x + width, y + height);\r\n\r\n\t\t\t// reassign mask\r\n\t\t\telement.attribute('mask').value = mask;\r\n\t\t}\r\n\r\n\t\tthis.render = function(ctx) {\r\n\t\t\t// NO RENDER\r\n\t\t}\r\n\t}\r\n\tsvg.Element.mask.prototype = new svg.Element.ElementBase;\r\n\r\n\t// clip element\r\n\tsvg.Element.clipPath = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.apply = function(ctx) {\r\n\t\t\tvar oldBeginPath = CanvasRenderingContext2D.prototype.beginPath;\r\n\t\t\tCanvasRenderingContext2D.prototype.beginPath = function () { };\r\n\r\n\t\t\tvar oldClosePath = CanvasRenderingContext2D.prototype.closePath;\r\n\t\t\tCanvasRenderingContext2D.prototype.closePath = function () { };\r\n\r\n\t\t\toldBeginPath.call(ctx);\r\n\t\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\t\tvar child = this.children[i];\r\n\t\t\t\tif (typeof child.path != 'undefined') {\r\n\t\t\t\t\tvar transform = null;\r\n\t\t\t\t\tif (child.style('transform', false, true).hasValue()) {\r\n\t\t\t\t\t\ttransform = new svg.Transform(child.style('transform', false, true).value);\r\n\t\t\t\t\t\ttransform.apply(ctx);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchild.path(ctx);\r\n\t\t\t\t\tCanvasRenderingContext2D.prototype.closePath = oldClosePath;\r\n\t\t\t\t\tif (transform) { transform.unapply(ctx); }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\toldClosePath.call(ctx);\r\n\t\t\tctx.clip();\r\n\r\n\t\t\tCanvasRenderingContext2D.prototype.beginPath = oldBeginPath;\r\n\t\t\tCanvasRenderingContext2D.prototype.closePath = oldClosePath;\r\n\t\t}\r\n\r\n\t\tthis.render = function(ctx) {\r\n\t\t\t// NO RENDER\r\n\t\t}\r\n\t}\r\n\tsvg.Element.clipPath.prototype = new svg.Element.ElementBase;\r\n\r\n\t// filters\r\n\tsvg.Element.filter = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.apply = function(ctx, element) {\r\n\t\t\t// render as temp svg\r\n\t\t\tvar bb = element.getBoundingBox();\r\n\t\t\tvar x = Math.floor(bb.x1);\r\n\t\t\tvar y = Math.floor(bb.y1);\r\n\t\t\tvar width = Math.floor(bb.width());\r\n\t\t\tvar\theight = Math.floor(bb.height());\r\n\r\n\t\t\t// temporarily remove filter to avoid recursion\r\n\t\t\tvar filter = element.style('filter').value;\r\n\t\t\telement.style('filter').value = '';\r\n\r\n\t\t\tvar px = 0, py = 0;\r\n\t\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\t\tvar efd = this.children[i].extraFilterDistance || 0;\r\n\t\t\t\tpx = Math.max(px, efd);\r\n\t\t\t\tpy = Math.max(py, efd);\r\n\t\t\t}\r\n\r\n\t\t\tvar c = document.createElement('canvas');\r\n\t\t\tc.width = width + 2*px;\r\n\t\t\tc.height = height + 2*py;\r\n\t\t\tvar tempCtx = c.getContext('2d');\r\n\t\t\ttempCtx.translate(-x + px, -y + py);\r\n\t\t\telement.render(tempCtx);\r\n\r\n\t\t\t// apply filters\r\n\t\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\t\tif (typeof this.children[i].apply == 'function') {\r\n\t\t\t\t\tthis.children[i].apply(tempCtx, 0, 0, width + 2*px, height + 2*py);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// render on me\r\n\t\t\tctx.drawImage(c, 0, 0, width + 2*px, height + 2*py, x - px, y - py, width + 2*px, height + 2*py);\r\n\r\n\t\t\t// reassign filter\r\n\t\t\telement.style('filter', true).value = filter;\r\n\t\t}\r\n\r\n\t\tthis.render = function(ctx) {\r\n\t\t\t// NO RENDER\r\n\t\t}\r\n\t}\r\n\tsvg.Element.filter.prototype = new svg.Element.ElementBase;\r\n\r\n\tsvg.Element.feMorphology = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.apply = function(ctx, x, y, width, height) {\r\n\t\t\t// TODO: implement\r\n\t\t}\r\n\t}\r\n\tsvg.Element.feMorphology.prototype = new svg.Element.ElementBase;\r\n\r\n\tsvg.Element.feComposite = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.apply = function(ctx, x, y, width, height) {\r\n\t\t\t// TODO: implement\r\n\t\t}\r\n\t}\r\n\tsvg.Element.feComposite.prototype = new svg.Element.ElementBase;\r\n\r\n\tsvg.Element.feColorMatrix = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tvar matrix = svg.ToNumberArray(this.attribute('values').value);\r\n\t\tswitch (this.attribute('type').valueOrDefault('matrix')) { // http://www.w3.org/TR/SVG/filters.html#feColorMatrixElement\r\n\t\t\tcase 'saturate':\r\n\t\t\t\tvar s = matrix[0];\r\n\t\t\t\tmatrix = [0.213+0.787*s,0.715-0.715*s,0.072-0.072*s,0,0,\r\n\t\t\t\t\t\t  0.213-0.213*s,0.715+0.285*s,0.072-0.072*s,0,0,\r\n\t\t\t\t\t\t  0.213-0.213*s,0.715-0.715*s,0.072+0.928*s,0,0,\r\n\t\t\t\t\t\t  0,0,0,1,0,\r\n\t\t\t\t\t\t  0,0,0,0,1];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'hueRotate':\r\n\t\t\t\tvar a = matrix[0] * Math.PI / 180.0;\r\n\t\t\t\tvar c = function (m1,m2,m3) { return m1 + Math.cos(a)*m2 + Math.sin(a)*m3; };\r\n\t\t\t\tmatrix = [c(0.213,0.787,-0.213),c(0.715,-0.715,-0.715),c(0.072,-0.072,0.928),0,0,\r\n\t\t\t\t\t\t  c(0.213,-0.213,0.143),c(0.715,0.285,0.140),c(0.072,-0.072,-0.283),0,0,\r\n\t\t\t\t\t\t  c(0.213,-0.213,-0.787),c(0.715,-0.715,0.715),c(0.072,0.928,0.072),0,0,\r\n\t\t\t\t\t\t  0,0,0,1,0,\r\n\t\t\t\t\t\t  0,0,0,0,1];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'luminanceToAlpha':\r\n\t\t\t\tmatrix = [0,0,0,0,0,\r\n\t\t\t\t\t\t  0,0,0,0,0,\r\n\t\t\t\t\t\t  0,0,0,0,0,\r\n\t\t\t\t\t\t  0.2125,0.7154,0.0721,0,0,\r\n\t\t\t\t\t\t  0,0,0,0,1];\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tfunction imGet(img, x, y, width, height, rgba) {\r\n\t\t\treturn img[y*width*4 + x*4 + rgba];\r\n\t\t}\r\n\r\n\t\tfunction imSet(img, x, y, width, height, rgba, val) {\r\n\t\t\timg[y*width*4 + x*4 + rgba] = val;\r\n\t\t}\r\n\r\n\t\tfunction m(i, v) {\r\n\t\t\tvar mi = matrix[i];\r\n\t\t\treturn mi * (mi < 0 ? v - 255 : v);\r\n\t\t}\r\n\r\n\t\tthis.apply = function(ctx, x, y, width, height) {\r\n\t\t\t// assuming x==0 && y==0 for now\r\n\t\t\tvar srcData = ctx.getImageData(0, 0, width, height);\r\n\t\t\tfor (var y = 0; y < height; y++) {\r\n\t\t\t\tfor (var x = 0; x < width; x++) {\r\n\t\t\t\t\tvar r = imGet(srcData.data, x, y, width, height, 0);\r\n\t\t\t\t\tvar g = imGet(srcData.data, x, y, width, height, 1);\r\n\t\t\t\t\tvar b = imGet(srcData.data, x, y, width, height, 2);\r\n\t\t\t\t\tvar a = imGet(srcData.data, x, y, width, height, 3);\r\n\t\t\t\t\timSet(srcData.data, x, y, width, height, 0, m(0,r)+m(1,g)+m(2,b)+m(3,a)+m(4,1));\r\n\t\t\t\t\timSet(srcData.data, x, y, width, height, 1, m(5,r)+m(6,g)+m(7,b)+m(8,a)+m(9,1));\r\n\t\t\t\t\timSet(srcData.data, x, y, width, height, 2, m(10,r)+m(11,g)+m(12,b)+m(13,a)+m(14,1));\r\n\t\t\t\t\timSet(srcData.data, x, y, width, height, 3, m(15,r)+m(16,g)+m(17,b)+m(18,a)+m(19,1));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tctx.clearRect(0, 0, width, height);\r\n\t\t\tctx.putImageData(srcData, 0, 0);\r\n\t\t}\r\n\t}\r\n\tsvg.Element.feColorMatrix.prototype = new svg.Element.ElementBase;\r\n\r\n\tsvg.Element.feGaussianBlur = function(node) {\r\n\t\tthis.base = svg.Element.ElementBase;\r\n\t\tthis.base(node);\r\n\r\n\t\tthis.blurRadius = Math.floor(this.attribute('stdDeviation').numValue());\r\n\t\tthis.extraFilterDistance = this.blurRadius;\r\n\r\n\t\tthis.apply = function(ctx, x, y, width, height) {\r\n\t\t\tif (typeof stackblur.canvasRGBA == 'undefined') {\r\n\t\t\t\tsvg.log('ERROR: StackBlur.js must be included for blur to work');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// StackBlur requires canvas be on document\r\n\t\t\tctx.canvas.id = svg.UniqueId();\r\n\t\t\tctx.canvas.style.display = 'none';\r\n\t\t\tdocument.body.appendChild(ctx.canvas);\r\n\t\t\tstackblur.canvasRGBA(ctx.canvas.id, x, y, width, height, this.blurRadius);\r\n\t\t\tdocument.body.removeChild(ctx.canvas);\r\n\t\t}\r\n\t}\r\n\tsvg.Element.feGaussianBlur.prototype = new svg.Element.ElementBase;\r\n\r\n\t// title element, do nothing\r\n\tsvg.Element.title = function(node) {\r\n\t}\r\n\tsvg.Element.title.prototype = new svg.Element.ElementBase;\r\n\r\n\t// desc element, do nothing\r\n\tsvg.Element.desc = function(node) {\r\n\t}\r\n\tsvg.Element.desc.prototype = new svg.Element.ElementBase;\r\n\r\n\tsvg.Element.MISSING = function(node) {\r\n\t\tsvg.log('ERROR: Element \\'' + node.nodeName + '\\' not yet implemented.');\r\n\t}\r\n\tsvg.Element.MISSING.prototype = new svg.Element.ElementBase;\r\n\r\n\t// element factory\r\n\tsvg.CreateElement = function(node) {\r\n\t\tvar className = node.nodeName.replace(/^[^:]+:/,''); // remove namespace\r\n\t\tclassName = className.replace(/\\-/g,''); // remove dashes\r\n\t\tvar e = null;\r\n\t\tif (typeof svg.Element[className] != 'undefined') {\r\n\t\t\te = new svg.Element[className](node);\r\n\t\t}\r\n\t\telse {\r\n\t\t\te = new svg.Element.MISSING(node);\r\n\t\t}\r\n\r\n\t\te.type = node.nodeName;\r\n\t\treturn e;\r\n\t}\r\n\r\n\t// load from url\r\n\tsvg.load = function(ctx, url) {\r\n\t\tsvg.loadXml(ctx, svg.ajax(url));\r\n\t}\r\n\r\n\t// load from xml\r\n\tsvg.loadXml = function(ctx, xml) {\r\n\t\tsvg.loadXmlDoc(ctx, svg.parseXml(xml));\r\n\t}\r\n\r\n\tsvg.loadXmlDoc = function(ctx, dom) {\r\n\t\tsvg.init(ctx);\r\n\r\n\t\tvar mapXY = function(p) {\r\n\t\t\tvar e = ctx.canvas;\r\n\t\t\twhile (e) {\r\n\t\t\t\tp.x -= e.offsetLeft;\r\n\t\t\t\tp.y -= e.offsetTop;\r\n\t\t\t\te = e.offsetParent;\r\n\t\t\t}\r\n\t\t\tif (window.scrollX) p.x += window.scrollX;\r\n\t\t\tif (window.scrollY) p.y += window.scrollY;\r\n\t\t\treturn p;\r\n\t\t}\r\n\r\n\t\t// bind mouse\r\n\t\tif (svg.opts['ignoreMouse'] != true) {\r\n\t\t\tctx.canvas.onclick = function(e) {\r\n\t\t\t\tvar p = mapXY(new svg.Point(e != null ? e.clientX : event.clientX, e != null ? e.clientY : event.clientY));\r\n\t\t\t\tsvg.Mouse.onclick(p.x, p.y);\r\n\t\t\t};\r\n\t\t\tctx.canvas.onmousemove = function(e) {\r\n\t\t\t\tvar p = mapXY(new svg.Point(e != null ? e.clientX : event.clientX, e != null ? e.clientY : event.clientY));\r\n\t\t\t\tsvg.Mouse.onmousemove(p.x, p.y);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tvar e = svg.CreateElement(dom.documentElement);\r\n\t\te.root = true;\r\n\t\te.addStylesFromStyleDefinition();\r\n\r\n\t\t// render loop\r\n\t\tvar isFirstRender = true;\r\n\t\tvar draw = function() {\r\n\t\t\tsvg.ViewPort.Clear();\r\n\t\t\tif (ctx.canvas.parentNode) svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth, ctx.canvas.parentNode.clientHeight);\r\n\r\n\t\t\tif (svg.opts['ignoreDimensions'] != true) {\r\n\t\t\t\t// set canvas size\r\n\t\t\t\tif (e.style('width').hasValue()) {\r\n\t\t\t\t\tctx.canvas.width = e.style('width').toPixels('x');\r\n\t\t\t\t\tctx.canvas.style.width = ctx.canvas.width + 'px';\r\n\t\t\t\t}\r\n\t\t\t\tif (e.style('height').hasValue()) {\r\n\t\t\t\t\tctx.canvas.height = e.style('height').toPixels('y');\r\n\t\t\t\t\tctx.canvas.style.height = ctx.canvas.height + 'px';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar cWidth = ctx.canvas.clientWidth || ctx.canvas.width;\r\n\t\t\tvar cHeight = ctx.canvas.clientHeight || ctx.canvas.height;\r\n\t\t\tif (svg.opts['ignoreDimensions'] == true && e.style('width').hasValue() && e.style('height').hasValue()) {\r\n\t\t\t\tcWidth = e.style('width').toPixels('x');\r\n\t\t\t\tcHeight = e.style('height').toPixels('y');\r\n\t\t\t}\r\n\t\t\tsvg.ViewPort.SetCurrent(cWidth, cHeight);\r\n\r\n\t\t\tif (svg.opts['offsetX'] != null) e.attribute('x', true).value = svg.opts['offsetX'];\r\n\t\t\tif (svg.opts['offsetY'] != null) e.attribute('y', true).value = svg.opts['offsetY'];\r\n\t\t\tif (svg.opts['scaleWidth'] != null || svg.opts['scaleHeight'] != null) {\r\n\t\t\t\tvar xRatio = null, yRatio = null, viewBox = svg.ToNumberArray(e.attribute('viewBox').value);\r\n\r\n\t\t\t\tif (svg.opts['scaleWidth'] != null) {\r\n\t\t\t\t\tif (e.attribute('width').hasValue()) xRatio = e.attribute('width').toPixels('x') / svg.opts['scaleWidth'];\r\n\t\t\t\t\telse if (!isNaN(viewBox[2])) xRatio = viewBox[2] / svg.opts['scaleWidth'];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (svg.opts['scaleHeight'] != null) {\r\n\t\t\t\t\tif (e.attribute('height').hasValue()) yRatio = e.attribute('height').toPixels('y') / svg.opts['scaleHeight'];\r\n\t\t\t\t\telse if (!isNaN(viewBox[3])) yRatio = viewBox[3] / svg.opts['scaleHeight'];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (xRatio == null) { xRatio = yRatio; }\r\n\t\t\t\tif (yRatio == null) { yRatio = xRatio; }\r\n\r\n\t\t\t\te.attribute('width', true).value = svg.opts['scaleWidth'];\r\n\t\t\t\te.attribute('height', true).value = svg.opts['scaleHeight'];\r\n\t\t\t\te.style('transform', true, true).value += ' scale('+(1.0/xRatio)+','+(1.0/yRatio)+')';\r\n\t\t\t}\r\n\r\n\t\t\t// clear and render\r\n\t\t\tif (svg.opts['ignoreClear'] != true) {\r\n\t\t\t\tctx.clearRect(0, 0, cWidth, cHeight);\r\n\t\t\t}\r\n\t\t\te.render(ctx);\r\n\t\t\tif (isFirstRender) {\r\n\t\t\t\tisFirstRender = false;\r\n\t\t\t\tif (typeof svg.opts['renderCallback'] == 'function') svg.opts['renderCallback'](dom);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar waitingForImages = true;\r\n\t\tif (svg.ImagesLoaded()) {\r\n\t\t\twaitingForImages = false;\r\n\t\t\tdraw();\r\n\t\t}\r\n\t\tsvg.intervalID = setInterval(function() {\r\n\t\t\tvar needUpdate = false;\r\n\r\n\t\t\tif (waitingForImages && svg.ImagesLoaded()) {\r\n\t\t\t\twaitingForImages = false;\r\n\t\t\t\tneedUpdate = true;\r\n\t\t\t}\r\n\r\n\t\t\t// need update from mouse events?\r\n\t\t\tif (svg.opts['ignoreMouse'] != true) {\r\n\t\t\t\tneedUpdate = needUpdate | svg.Mouse.hasEvents();\r\n\t\t\t}\r\n\r\n\t\t\t// need update from animations?\r\n\t\t\tif (svg.opts['ignoreAnimation'] != true) {\r\n\t\t\t\tfor (var i=0; i<svg.Animations.length; i++) {\r\n\t\t\t\t\tneedUpdate = needUpdate | svg.Animations[i].update(1000 / svg.FRAMERATE);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// need update from redraw?\r\n\t\t\tif (typeof svg.opts['forceRedraw'] == 'function') {\r\n\t\t\t\tif (svg.opts['forceRedraw']() == true) needUpdate = true;\r\n\t\t\t}\r\n\r\n\t\t\t// render if needed\r\n\t\t\tif (needUpdate) {\r\n\t\t\t\tdraw();\r\n\t\t\t\tsvg.Mouse.runEvents(); // run and clear our events\r\n\t\t\t}\r\n\t\t}, 1000 / svg.FRAMERATE);\r\n\t}\r\n\r\n\tsvg.stop = function() {\r\n\t\tif (svg.intervalID) {\r\n\t\t\tclearInterval(svg.intervalID);\r\n\t\t}\r\n\t}\r\n\r\n\tsvg.Mouse = new (function() {\r\n\t\tthis.events = [];\r\n\t\tthis.hasEvents = function() { return this.events.length != 0; }\r\n\r\n\t\tthis.onclick = function(x, y) {\r\n\t\t\tthis.events.push({ type: 'onclick', x: x, y: y,\r\n\t\t\t\trun: function(e) { if (e.onclick) e.onclick(); }\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.onmousemove = function(x, y) {\r\n\t\t\tthis.events.push({ type: 'onmousemove', x: x, y: y,\r\n\t\t\t\trun: function(e) { if (e.onmousemove) e.onmousemove(); }\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.eventElements = [];\r\n\r\n\t\tthis.checkPath = function(element, ctx) {\r\n\t\t\tfor (var i=0; i<this.events.length; i++) {\r\n\t\t\t\tvar e = this.events[i];\r\n\t\t\t\tif (ctx.isPointInPath && ctx.isPointInPath(e.x, e.y)) this.eventElements[i] = element;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.checkBoundingBox = function(element, bb) {\r\n\t\t\tfor (var i=0; i<this.events.length; i++) {\r\n\t\t\t\tvar e = this.events[i];\r\n\t\t\t\tif (bb.isPointInBox(e.x, e.y)) this.eventElements[i] = element;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.runEvents = function() {\r\n\t\t\tsvg.ctx.canvas.style.cursor = '';\r\n\r\n\t\t\tfor (var i=0; i<this.events.length; i++) {\r\n\t\t\t\tvar e = this.events[i];\r\n\t\t\t\tvar element = this.eventElements[i];\r\n\t\t\t\twhile (element) {\r\n\t\t\t\t\te.run(element);\r\n\t\t\t\t\telement = element.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// done running, clear\r\n\t\t\tthis.events = [];\r\n\t\t\tthis.eventElements = [];\r\n\t\t}\r\n\t});\r\n\r\n\treturn svg;\r\n};\r\n\r\nmodule.exports = canvg;\r\n","// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n\"use strict\";\n\nvar htmlConfig = {\n  autoSelfClosers: {'area': true, 'base': true, 'br': true, 'col': true, 'command': true,\n                    'embed': true, 'frame': true, 'hr': true, 'img': true, 'input': true,\n                    'keygen': true, 'link': true, 'meta': true, 'param': true, 'source': true,\n                    'track': true, 'wbr': true, 'menuitem': true},\n  implicitlyClosed: {'dd': true, 'li': true, 'optgroup': true, 'option': true, 'p': true,\n                     'rp': true, 'rt': true, 'tbody': true, 'td': true, 'tfoot': true,\n                     'th': true, 'tr': true},\n  contextGrabbers: {\n    'dd': {'dd': true, 'dt': true},\n    'dt': {'dd': true, 'dt': true},\n    'li': {'li': true},\n    'option': {'option': true, 'optgroup': true},\n    'optgroup': {'optgroup': true},\n    'p': {'address': true, 'article': true, 'aside': true, 'blockquote': true, 'dir': true,\n          'div': true, 'dl': true, 'fieldset': true, 'footer': true, 'form': true,\n          'h1': true, 'h2': true, 'h3': true, 'h4': true, 'h5': true, 'h6': true,\n          'header': true, 'hgroup': true, 'hr': true, 'menu': true, 'nav': true, 'ol': true,\n          'p': true, 'pre': true, 'section': true, 'table': true, 'ul': true},\n    'rp': {'rp': true, 'rt': true},\n    'rt': {'rp': true, 'rt': true},\n    'tbody': {'tbody': true, 'tfoot': true},\n    'td': {'td': true, 'th': true},\n    'tfoot': {'tbody': true},\n    'th': {'td': true, 'th': true},\n    'thead': {'tbody': true, 'tfoot': true},\n    'tr': {'tr': true}\n  },\n  doNotIndent: {\"pre\": true},\n  allowUnquoted: true,\n  allowMissing: true,\n  caseFold: true\n}\n\nvar xmlConfig = {\n  autoSelfClosers: {},\n  implicitlyClosed: {},\n  contextGrabbers: {},\n  doNotIndent: {},\n  allowUnquoted: false,\n  allowMissing: false,\n  allowMissingTagName: false,\n  caseFold: false\n}\n\nCodeMirror.defineMode(\"xml\", function(editorConf, config_) {\n  var indentUnit = editorConf.indentUnit\n  var config = {}\n  var defaults = config_.htmlMode ? htmlConfig : xmlConfig\n  for (var prop in defaults) config[prop] = defaults[prop]\n  for (var prop in config_) config[prop] = config_[prop]\n\n  // Return variables for tokenizers\n  var type, setStyle;\n\n  function inText(stream, state) {\n    function chain(parser) {\n      state.tokenize = parser;\n      return parser(stream, state);\n    }\n\n    var ch = stream.next();\n    if (ch == \"<\") {\n      if (stream.eat(\"!\")) {\n        if (stream.eat(\"[\")) {\n          if (stream.match(\"CDATA[\")) return chain(inBlock(\"atom\", \"]]>\"));\n          else return null;\n        } else if (stream.match(\"--\")) {\n          return chain(inBlock(\"comment\", \"-->\"));\n        } else if (stream.match(\"DOCTYPE\", true, true)) {\n          stream.eatWhile(/[\\w\\._\\-]/);\n          return chain(doctype(1));\n        } else {\n          return null;\n        }\n      } else if (stream.eat(\"?\")) {\n        stream.eatWhile(/[\\w\\._\\-]/);\n        state.tokenize = inBlock(\"meta\", \"?>\");\n        return \"meta\";\n      } else {\n        type = stream.eat(\"/\") ? \"closeTag\" : \"openTag\";\n        state.tokenize = inTag;\n        return \"tag bracket\";\n      }\n    } else if (ch == \"&\") {\n      var ok;\n      if (stream.eat(\"#\")) {\n        if (stream.eat(\"x\")) {\n          ok = stream.eatWhile(/[a-fA-F\\d]/) && stream.eat(\";\");\n        } else {\n          ok = stream.eatWhile(/[\\d]/) && stream.eat(\";\");\n        }\n      } else {\n        ok = stream.eatWhile(/[\\w\\.\\-:]/) && stream.eat(\";\");\n      }\n      return ok ? \"atom\" : \"error\";\n    } else {\n      stream.eatWhile(/[^&<]/);\n      return null;\n    }\n  }\n  inText.isInText = true;\n\n  function inTag(stream, state) {\n    var ch = stream.next();\n    if (ch == \">\" || (ch == \"/\" && stream.eat(\">\"))) {\n      state.tokenize = inText;\n      type = ch == \">\" ? \"endTag\" : \"selfcloseTag\";\n      return \"tag bracket\";\n    } else if (ch == \"=\") {\n      type = \"equals\";\n      return null;\n    } else if (ch == \"<\") {\n      state.tokenize = inText;\n      state.state = baseState;\n      state.tagName = state.tagStart = null;\n      var next = state.tokenize(stream, state);\n      return next ? next + \" tag error\" : \"tag error\";\n    } else if (/[\\'\\\"]/.test(ch)) {\n      state.tokenize = inAttribute(ch);\n      state.stringStartCol = stream.column();\n      return state.tokenize(stream, state);\n    } else {\n      stream.match(/^[^\\s\\u00a0=<>\\\"\\']*[^\\s\\u00a0=<>\\\"\\'\\/]/);\n      return \"word\";\n    }\n  }\n\n  function inAttribute(quote) {\n    var closure = function(stream, state) {\n      while (!stream.eol()) {\n        if (stream.next() == quote) {\n          state.tokenize = inTag;\n          break;\n        }\n      }\n      return \"string\";\n    };\n    closure.isInAttribute = true;\n    return closure;\n  }\n\n  function inBlock(style, terminator) {\n    return function(stream, state) {\n      while (!stream.eol()) {\n        if (stream.match(terminator)) {\n          state.tokenize = inText;\n          break;\n        }\n        stream.next();\n      }\n      return style;\n    }\n  }\n\n  function doctype(depth) {\n    return function(stream, state) {\n      var ch;\n      while ((ch = stream.next()) != null) {\n        if (ch == \"<\") {\n          state.tokenize = doctype(depth + 1);\n          return state.tokenize(stream, state);\n        } else if (ch == \">\") {\n          if (depth == 1) {\n            state.tokenize = inText;\n            break;\n          } else {\n            state.tokenize = doctype(depth - 1);\n            return state.tokenize(stream, state);\n          }\n        }\n      }\n      return \"meta\";\n    };\n  }\n\n  function lower(tagName) {\n    return tagName && tagName.toLowerCase();\n  }\n\n  function Context(state, tagName, startOfLine) {\n    this.prev = state.context;\n    this.tagName = tagName || \"\";\n    this.indent = state.indented;\n    this.startOfLine = startOfLine;\n    if (config.doNotIndent.hasOwnProperty(tagName) || (state.context && state.context.noIndent))\n      this.noIndent = true;\n  }\n  function popContext(state) {\n    if (state.context) state.context = state.context.prev;\n  }\n  function maybePopContext(state, nextTagName) {\n    var parentTagName;\n    while (true) {\n      if (!state.context) {\n        return;\n      }\n      parentTagName = state.context.tagName;\n      if (!config.contextGrabbers.hasOwnProperty(lower(parentTagName)) ||\n          !config.contextGrabbers[lower(parentTagName)].hasOwnProperty(lower(nextTagName))) {\n        return;\n      }\n      popContext(state);\n    }\n  }\n\n  function baseState(type, stream, state) {\n    if (type == \"openTag\") {\n      state.tagStart = stream.column();\n      return tagNameState;\n    } else if (type == \"closeTag\") {\n      return closeTagNameState;\n    } else {\n      return baseState;\n    }\n  }\n  function tagNameState(type, stream, state) {\n    if (type == \"word\") {\n      state.tagName = stream.current();\n      setStyle = \"tag\";\n      return attrState;\n    } else if (config.allowMissingTagName && type == \"endTag\") {\n      setStyle = \"tag bracket\";\n      return attrState(type, stream, state);\n    } else {\n      setStyle = \"error\";\n      return tagNameState;\n    }\n  }\n  function closeTagNameState(type, stream, state) {\n    if (type == \"word\") {\n      var tagName = stream.current();\n      if (state.context && state.context.tagName != tagName &&\n          config.implicitlyClosed.hasOwnProperty(lower(state.context.tagName)))\n        popContext(state);\n      if ((state.context && state.context.tagName == tagName) || config.matchClosing === false) {\n        setStyle = \"tag\";\n        return closeState;\n      } else {\n        setStyle = \"tag error\";\n        return closeStateErr;\n      }\n    } else if (config.allowMissingTagName && type == \"endTag\") {\n      setStyle = \"tag bracket\";\n      return closeState(type, stream, state);\n    } else {\n      setStyle = \"error\";\n      return closeStateErr;\n    }\n  }\n\n  function closeState(type, _stream, state) {\n    if (type != \"endTag\") {\n      setStyle = \"error\";\n      return closeState;\n    }\n    popContext(state);\n    return baseState;\n  }\n  function closeStateErr(type, stream, state) {\n    setStyle = \"error\";\n    return closeState(type, stream, state);\n  }\n\n  function attrState(type, _stream, state) {\n    if (type == \"word\") {\n      setStyle = \"attribute\";\n      return attrEqState;\n    } else if (type == \"endTag\" || type == \"selfcloseTag\") {\n      var tagName = state.tagName, tagStart = state.tagStart;\n      state.tagName = state.tagStart = null;\n      if (type == \"selfcloseTag\" ||\n          config.autoSelfClosers.hasOwnProperty(lower(tagName))) {\n        maybePopContext(state, tagName);\n      } else {\n        maybePopContext(state, tagName);\n        state.context = new Context(state, tagName, tagStart == state.indented);\n      }\n      return baseState;\n    }\n    setStyle = \"error\";\n    return attrState;\n  }\n  function attrEqState(type, stream, state) {\n    if (type == \"equals\") return attrValueState;\n    if (!config.allowMissing) setStyle = \"error\";\n    return attrState(type, stream, state);\n  }\n  function attrValueState(type, stream, state) {\n    if (type == \"string\") return attrContinuedState;\n    if (type == \"word\" && config.allowUnquoted) {setStyle = \"string\"; return attrState;}\n    setStyle = \"error\";\n    return attrState(type, stream, state);\n  }\n  function attrContinuedState(type, stream, state) {\n    if (type == \"string\") return attrContinuedState;\n    return attrState(type, stream, state);\n  }\n\n  return {\n    startState: function(baseIndent) {\n      var state = {tokenize: inText,\n                   state: baseState,\n                   indented: baseIndent || 0,\n                   tagName: null, tagStart: null,\n                   context: null}\n      if (baseIndent != null) state.baseIndent = baseIndent\n      return state\n    },\n\n    token: function(stream, state) {\n      if (!state.tagName && stream.sol())\n        state.indented = stream.indentation();\n\n      if (stream.eatSpace()) return null;\n      type = null;\n      var style = state.tokenize(stream, state);\n      if ((style || type) && style != \"comment\") {\n        setStyle = null;\n        state.state = state.state(type || style, stream, state);\n        if (setStyle)\n          style = setStyle == \"error\" ? style + \" error\" : setStyle;\n      }\n      return style;\n    },\n\n    indent: function(state, textAfter, fullLine) {\n      var context = state.context;\n      // Indent multi-line strings (e.g. css).\n      if (state.tokenize.isInAttribute) {\n        if (state.tagStart == state.indented)\n          return state.stringStartCol + 1;\n        else\n          return state.indented + indentUnit;\n      }\n      if (context && context.noIndent) return CodeMirror.Pass;\n      if (state.tokenize != inTag && state.tokenize != inText)\n        return fullLine ? fullLine.match(/^(\\s*)/)[0].length : 0;\n      // Indent the starts of attribute names.\n      if (state.tagName) {\n        if (config.multilineTagIndentPastTag !== false)\n          return state.tagStart + state.tagName.length + 2;\n        else\n          return state.tagStart + indentUnit * (config.multilineTagIndentFactor || 1);\n      }\n      if (config.alignCDATA && /<!\\[CDATA\\[/.test(textAfter)) return 0;\n      var tagAfter = textAfter && /^<(\\/)?([\\w_:\\.-]*)/.exec(textAfter);\n      if (tagAfter && tagAfter[1]) { // Closing tag spotted\n        while (context) {\n          if (context.tagName == tagAfter[2]) {\n            context = context.prev;\n            break;\n          } else if (config.implicitlyClosed.hasOwnProperty(lower(context.tagName))) {\n            context = context.prev;\n          } else {\n            break;\n          }\n        }\n      } else if (tagAfter) { // Opening tag spotted\n        while (context) {\n          var grabbers = config.contextGrabbers[lower(context.tagName)];\n          if (grabbers && grabbers.hasOwnProperty(lower(tagAfter[2])))\n            context = context.prev;\n          else\n            break;\n        }\n      }\n      while (context && context.prev && !context.startOfLine)\n        context = context.prev;\n      if (context) return context.indent + indentUnit;\n      else return state.baseIndent || 0;\n    },\n\n    electricInput: /<\\/[\\s\\w:]+>$/,\n    blockCommentStart: \"<!--\",\n    blockCommentEnd: \"-->\",\n\n    configuration: config.htmlMode ? \"html\" : \"xml\",\n    helperType: config.htmlMode ? \"html\" : \"xml\",\n\n    skipAttribute: function(state) {\n      if (state.state == attrValueState)\n        state.state = attrState\n    },\n\n    xmlCurrentTag: function(state) {\n      return state.tagName ? {name: state.tagName, close: state.type == \"closeTag\"} : null\n    },\n\n    xmlCurrentContext: function(state) {\n      var context = []\n      for (var cx = state.context; cx; cx = cx.prev)\n        context.push(cx.tagName)\n      return context.reverse()\n    }\n  };\n});\n\nCodeMirror.defineMIME(\"text/xml\", \"xml\");\nCodeMirror.defineMIME(\"application/xml\", \"xml\");\nif (!CodeMirror.mimeModes.hasOwnProperty(\"text/html\"))\n  CodeMirror.defineMIME(\"text/html\", {name: \"xml\", htmlMode: true});\n\n});\n","/**\n * Adds the exporter and exporterVersion meta-data on diagram export.\n *\n * Must provide the values via config.exporter = { name, version }.\n *\n * @param {Object} config\n * @param {EventBus} eventBus\n */\nexport default function AddExporter(config, eventBus) {\n\n  if (!config) {\n    throw new Error('config.exporter = { name, version } not configured');\n  }\n\n  var name = config.name,\n      version = config.version;\n\n  if (!name || !version) {\n    throw new Error('config.exporter = { name, version } missing required props');\n  }\n\n  eventBus.on('saveXML.start', function(event) {\n    var definitions = event.definitions;\n\n    definitions.exporter = name;\n    definitions.exporterVersion = version;\n  });\n\n}\n\nAddExporter.$inject = [\n  'config.exporter',\n  'eventBus'\n];","/*\n * DOM Level 2\n * Object DOMException\n * @see http://www.w3.org/TR/REC-DOM-Level-1/ecma-script-language-binding.html\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/ecma-script-binding.html\n */\n\nfunction copy(src,dest){\n\tfor(var p in src){\n\t\tdest[p] = src[p];\n\t}\n}\n/**\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*((?:.*\\{\\s*?[\\r\\n][\\s\\S]*?^})|\\S.*?(?=[;\\r\\n]));?\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*(\\S.*?(?=[;\\r\\n]));?\n */\nfunction _extends(Class,Super){\n\tvar pt = Class.prototype;\n\tif(Object.create){\n\t\tvar ppt = Object.create(Super.prototype)\n\t\tpt.__proto__ = ppt;\n\t}\n\tif(!(pt instanceof Super)){\n\t\tfunction t(){};\n\t\tt.prototype = Super.prototype;\n\t\tt = new t();\n\t\tcopy(pt,t);\n\t\tClass.prototype = pt = t;\n\t}\n\tif(pt.constructor != Class){\n\t\tif(typeof Class != 'function'){\n\t\t\tconsole.error(\"unknow Class:\"+Class)\n\t\t}\n\t\tpt.constructor = Class\n\t}\n}\nvar htmlns = 'http://www.w3.org/1999/xhtml' ;\n// Node Types\nvar NodeType = {}\nvar ELEMENT_NODE                = NodeType.ELEMENT_NODE                = 1;\nvar ATTRIBUTE_NODE              = NodeType.ATTRIBUTE_NODE              = 2;\nvar TEXT_NODE                   = NodeType.TEXT_NODE                   = 3;\nvar CDATA_SECTION_NODE          = NodeType.CDATA_SECTION_NODE          = 4;\nvar ENTITY_REFERENCE_NODE       = NodeType.ENTITY_REFERENCE_NODE       = 5;\nvar ENTITY_NODE                 = NodeType.ENTITY_NODE                 = 6;\nvar PROCESSING_INSTRUCTION_NODE = NodeType.PROCESSING_INSTRUCTION_NODE = 7;\nvar COMMENT_NODE                = NodeType.COMMENT_NODE                = 8;\nvar DOCUMENT_NODE               = NodeType.DOCUMENT_NODE               = 9;\nvar DOCUMENT_TYPE_NODE          = NodeType.DOCUMENT_TYPE_NODE          = 10;\nvar DOCUMENT_FRAGMENT_NODE      = NodeType.DOCUMENT_FRAGMENT_NODE      = 11;\nvar NOTATION_NODE               = NodeType.NOTATION_NODE               = 12;\n\n// ExceptionCode\nvar ExceptionCode = {}\nvar ExceptionMessage = {};\nvar INDEX_SIZE_ERR              = ExceptionCode.INDEX_SIZE_ERR              = ((ExceptionMessage[1]=\"Index size error\"),1);\nvar DOMSTRING_SIZE_ERR          = ExceptionCode.DOMSTRING_SIZE_ERR          = ((ExceptionMessage[2]=\"DOMString size error\"),2);\nvar HIERARCHY_REQUEST_ERR       = ExceptionCode.HIERARCHY_REQUEST_ERR       = ((ExceptionMessage[3]=\"Hierarchy request error\"),3);\nvar WRONG_DOCUMENT_ERR          = ExceptionCode.WRONG_DOCUMENT_ERR          = ((ExceptionMessage[4]=\"Wrong document\"),4);\nvar INVALID_CHARACTER_ERR       = ExceptionCode.INVALID_CHARACTER_ERR       = ((ExceptionMessage[5]=\"Invalid character\"),5);\nvar NO_DATA_ALLOWED_ERR         = ExceptionCode.NO_DATA_ALLOWED_ERR         = ((ExceptionMessage[6]=\"No data allowed\"),6);\nvar NO_MODIFICATION_ALLOWED_ERR = ExceptionCode.NO_MODIFICATION_ALLOWED_ERR = ((ExceptionMessage[7]=\"No modification allowed\"),7);\nvar NOT_FOUND_ERR               = ExceptionCode.NOT_FOUND_ERR               = ((ExceptionMessage[8]=\"Not found\"),8);\nvar NOT_SUPPORTED_ERR           = ExceptionCode.NOT_SUPPORTED_ERR           = ((ExceptionMessage[9]=\"Not supported\"),9);\nvar INUSE_ATTRIBUTE_ERR         = ExceptionCode.INUSE_ATTRIBUTE_ERR         = ((ExceptionMessage[10]=\"Attribute in use\"),10);\n//level2\nvar INVALID_STATE_ERR        \t= ExceptionCode.INVALID_STATE_ERR        \t= ((ExceptionMessage[11]=\"Invalid state\"),11);\nvar SYNTAX_ERR               \t= ExceptionCode.SYNTAX_ERR               \t= ((ExceptionMessage[12]=\"Syntax error\"),12);\nvar INVALID_MODIFICATION_ERR \t= ExceptionCode.INVALID_MODIFICATION_ERR \t= ((ExceptionMessage[13]=\"Invalid modification\"),13);\nvar NAMESPACE_ERR            \t= ExceptionCode.NAMESPACE_ERR           \t= ((ExceptionMessage[14]=\"Invalid namespace\"),14);\nvar INVALID_ACCESS_ERR       \t= ExceptionCode.INVALID_ACCESS_ERR      \t= ((ExceptionMessage[15]=\"Invalid access\"),15);\n\n\nfunction DOMException(code, message) {\n\tif(message instanceof Error){\n\t\tvar error = message;\n\t}else{\n\t\terror = this;\n\t\tError.call(this, ExceptionMessage[code]);\n\t\tthis.message = ExceptionMessage[code];\n\t\tif(Error.captureStackTrace) Error.captureStackTrace(this, DOMException);\n\t}\n\terror.code = code;\n\tif(message) this.message = this.message + \": \" + message;\n\treturn error;\n};\nDOMException.prototype = Error.prototype;\ncopy(ExceptionCode,DOMException)\n/**\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-536297177\n * The NodeList interface provides the abstraction of an ordered collection of nodes, without defining or constraining how this collection is implemented. NodeList objects in the DOM are live.\n * The items in the NodeList are accessible via an integral index, starting from 0.\n */\nfunction NodeList() {\n};\nNodeList.prototype = {\n\t/**\n\t * The number of nodes in the list. The range of valid child node indices is 0 to length-1 inclusive.\n\t * @standard level1\n\t */\n\tlength:0, \n\t/**\n\t * Returns the indexth item in the collection. If index is greater than or equal to the number of nodes in the list, this returns null.\n\t * @standard level1\n\t * @param index  unsigned long \n\t *   Index into the collection.\n\t * @return Node\n\t * \tThe node at the indexth position in the NodeList, or null if that is not a valid index. \n\t */\n\titem: function(index) {\n\t\treturn this[index] || null;\n\t},\n\ttoString:function(isHTML,nodeFilter){\n\t\tfor(var buf = [], i = 0;i<this.length;i++){\n\t\t\tserializeToString(this[i],buf,isHTML,nodeFilter);\n\t\t}\n\t\treturn buf.join('');\n\t}\n};\nfunction LiveNodeList(node,refresh){\n\tthis._node = node;\n\tthis._refresh = refresh\n\t_updateLiveList(this);\n}\nfunction _updateLiveList(list){\n\tvar inc = list._node._inc || list._node.ownerDocument._inc;\n\tif(list._inc != inc){\n\t\tvar ls = list._refresh(list._node);\n\t\t//console.log(ls.length)\n\t\t__set__(list,'length',ls.length);\n\t\tcopy(ls,list);\n\t\tlist._inc = inc;\n\t}\n}\nLiveNodeList.prototype.item = function(i){\n\t_updateLiveList(this);\n\treturn this[i];\n}\n\n_extends(LiveNodeList,NodeList);\n/**\n * \n * Objects implementing the NamedNodeMap interface are used to represent collections of nodes that can be accessed by name. Note that NamedNodeMap does not inherit from NodeList; NamedNodeMaps are not maintained in any particular order. Objects contained in an object implementing NamedNodeMap may also be accessed by an ordinal index, but this is simply to allow convenient enumeration of the contents of a NamedNodeMap, and does not imply that the DOM specifies an order to these Nodes.\n * NamedNodeMap objects in the DOM are live.\n * used for attributes or DocumentType entities \n */\nfunction NamedNodeMap() {\n};\n\nfunction _findNodeIndex(list,node){\n\tvar i = list.length;\n\twhile(i--){\n\t\tif(list[i] === node){return i}\n\t}\n}\n\nfunction _addNamedNode(el,list,newAttr,oldAttr){\n\tif(oldAttr){\n\t\tlist[_findNodeIndex(list,oldAttr)] = newAttr;\n\t}else{\n\t\tlist[list.length++] = newAttr;\n\t}\n\tif(el){\n\t\tnewAttr.ownerElement = el;\n\t\tvar doc = el.ownerDocument;\n\t\tif(doc){\n\t\t\toldAttr && _onRemoveAttribute(doc,el,oldAttr);\n\t\t\t_onAddAttribute(doc,el,newAttr);\n\t\t}\n\t}\n}\nfunction _removeNamedNode(el,list,attr){\n\t//console.log('remove attr:'+attr)\n\tvar i = _findNodeIndex(list,attr);\n\tif(i>=0){\n\t\tvar lastIndex = list.length-1\n\t\twhile(i<lastIndex){\n\t\t\tlist[i] = list[++i]\n\t\t}\n\t\tlist.length = lastIndex;\n\t\tif(el){\n\t\t\tvar doc = el.ownerDocument;\n\t\t\tif(doc){\n\t\t\t\t_onRemoveAttribute(doc,el,attr);\n\t\t\t\tattr.ownerElement = null;\n\t\t\t}\n\t\t}\n\t}else{\n\t\tthrow DOMException(NOT_FOUND_ERR,new Error(el.tagName+'@'+attr))\n\t}\n}\nNamedNodeMap.prototype = {\n\tlength:0,\n\titem:NodeList.prototype.item,\n\tgetNamedItem: function(key) {\n//\t\tif(key.indexOf(':')>0 || key == 'xmlns'){\n//\t\t\treturn null;\n//\t\t}\n\t\t//console.log()\n\t\tvar i = this.length;\n\t\twhile(i--){\n\t\t\tvar attr = this[i];\n\t\t\t//console.log(attr.nodeName,key)\n\t\t\tif(attr.nodeName == key){\n\t\t\t\treturn attr;\n\t\t\t}\n\t\t}\n\t},\n\tsetNamedItem: function(attr) {\n\t\tvar el = attr.ownerElement;\n\t\tif(el && el!=this._ownerElement){\n\t\t\tthrow new DOMException(INUSE_ATTRIBUTE_ERR);\n\t\t}\n\t\tvar oldAttr = this.getNamedItem(attr.nodeName);\n\t\t_addNamedNode(this._ownerElement,this,attr,oldAttr);\n\t\treturn oldAttr;\n\t},\n\t/* returns Node */\n\tsetNamedItemNS: function(attr) {// raises: WRONG_DOCUMENT_ERR,NO_MODIFICATION_ALLOWED_ERR,INUSE_ATTRIBUTE_ERR\n\t\tvar el = attr.ownerElement, oldAttr;\n\t\tif(el && el!=this._ownerElement){\n\t\t\tthrow new DOMException(INUSE_ATTRIBUTE_ERR);\n\t\t}\n\t\toldAttr = this.getNamedItemNS(attr.namespaceURI,attr.localName);\n\t\t_addNamedNode(this._ownerElement,this,attr,oldAttr);\n\t\treturn oldAttr;\n\t},\n\n\t/* returns Node */\n\tremoveNamedItem: function(key) {\n\t\tvar attr = this.getNamedItem(key);\n\t\t_removeNamedNode(this._ownerElement,this,attr);\n\t\treturn attr;\n\t\t\n\t\t\n\t},// raises: NOT_FOUND_ERR,NO_MODIFICATION_ALLOWED_ERR\n\t\n\t//for level2\n\tremoveNamedItemNS:function(namespaceURI,localName){\n\t\tvar attr = this.getNamedItemNS(namespaceURI,localName);\n\t\t_removeNamedNode(this._ownerElement,this,attr);\n\t\treturn attr;\n\t},\n\tgetNamedItemNS: function(namespaceURI, localName) {\n\t\tvar i = this.length;\n\t\twhile(i--){\n\t\t\tvar node = this[i];\n\t\t\tif(node.localName == localName && node.namespaceURI == namespaceURI){\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n};\n/**\n * @see http://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-102161490\n */\nfunction DOMImplementation(/* Object */ features) {\n\tthis._features = {};\n\tif (features) {\n\t\tfor (var feature in features) {\n\t\t\t this._features = features[feature];\n\t\t}\n\t}\n};\n\nDOMImplementation.prototype = {\n\thasFeature: function(/* string */ feature, /* string */ version) {\n\t\tvar versions = this._features[feature.toLowerCase()];\n\t\tif (versions && (!version || version in versions)) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateDocument:function(namespaceURI,  qualifiedName, doctype){// raises:INVALID_CHARACTER_ERR,NAMESPACE_ERR,WRONG_DOCUMENT_ERR\n\t\tvar doc = new Document();\n\t\tdoc.implementation = this;\n\t\tdoc.childNodes = new NodeList();\n\t\tdoc.doctype = doctype;\n\t\tif(doctype){\n\t\t\tdoc.appendChild(doctype);\n\t\t}\n\t\tif(qualifiedName){\n\t\t\tvar root = doc.createElementNS(namespaceURI,qualifiedName);\n\t\t\tdoc.appendChild(root);\n\t\t}\n\t\treturn doc;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateDocumentType:function(qualifiedName, publicId, systemId){// raises:INVALID_CHARACTER_ERR,NAMESPACE_ERR\n\t\tvar node = new DocumentType();\n\t\tnode.name = qualifiedName;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.publicId = publicId;\n\t\tnode.systemId = systemId;\n\t\t// Introduced in DOM Level 2:\n\t\t//readonly attribute DOMString        internalSubset;\n\t\t\n\t\t//TODO:..\n\t\t//  readonly attribute NamedNodeMap     entities;\n\t\t//  readonly attribute NamedNodeMap     notations;\n\t\treturn node;\n\t}\n};\n\n\n/**\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-1950641247\n */\n\nfunction Node() {\n};\n\nNode.prototype = {\n\tfirstChild : null,\n\tlastChild : null,\n\tpreviousSibling : null,\n\tnextSibling : null,\n\tattributes : null,\n\tparentNode : null,\n\tchildNodes : null,\n\townerDocument : null,\n\tnodeValue : null,\n\tnamespaceURI : null,\n\tprefix : null,\n\tlocalName : null,\n\t// Modified in DOM Level 2:\n\tinsertBefore:function(newChild, refChild){//raises \n\t\treturn _insertBefore(this,newChild,refChild);\n\t},\n\treplaceChild:function(newChild, oldChild){//raises \n\t\tthis.insertBefore(newChild,oldChild);\n\t\tif(oldChild){\n\t\t\tthis.removeChild(oldChild);\n\t\t}\n\t},\n\tremoveChild:function(oldChild){\n\t\treturn _removeChild(this,oldChild);\n\t},\n\tappendChild:function(newChild){\n\t\treturn this.insertBefore(newChild,null);\n\t},\n\thasChildNodes:function(){\n\t\treturn this.firstChild != null;\n\t},\n\tcloneNode:function(deep){\n\t\treturn cloneNode(this.ownerDocument||this,this,deep);\n\t},\n\t// Modified in DOM Level 2:\n\tnormalize:function(){\n\t\tvar child = this.firstChild;\n\t\twhile(child){\n\t\t\tvar next = child.nextSibling;\n\t\t\tif(next && next.nodeType == TEXT_NODE && child.nodeType == TEXT_NODE){\n\t\t\t\tthis.removeChild(next);\n\t\t\t\tchild.appendData(next.data);\n\t\t\t}else{\n\t\t\t\tchild.normalize();\n\t\t\t\tchild = next;\n\t\t\t}\n\t\t}\n\t},\n  \t// Introduced in DOM Level 2:\n\tisSupported:function(feature, version){\n\t\treturn this.ownerDocument.implementation.hasFeature(feature,version);\n\t},\n    // Introduced in DOM Level 2:\n    hasAttributes:function(){\n    \treturn this.attributes.length>0;\n    },\n    lookupPrefix:function(namespaceURI){\n    \tvar el = this;\n    \twhile(el){\n    \t\tvar map = el._nsMap;\n    \t\t//console.dir(map)\n    \t\tif(map){\n    \t\t\tfor(var n in map){\n    \t\t\t\tif(map[n] == namespaceURI){\n    \t\t\t\t\treturn n;\n    \t\t\t\t}\n    \t\t\t}\n    \t\t}\n    \t\tel = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;\n    \t}\n    \treturn null;\n    },\n    // Introduced in DOM Level 3:\n    lookupNamespaceURI:function(prefix){\n    \tvar el = this;\n    \twhile(el){\n    \t\tvar map = el._nsMap;\n    \t\t//console.dir(map)\n    \t\tif(map){\n    \t\t\tif(prefix in map){\n    \t\t\t\treturn map[prefix] ;\n    \t\t\t}\n    \t\t}\n    \t\tel = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;\n    \t}\n    \treturn null;\n    },\n    // Introduced in DOM Level 3:\n    isDefaultNamespace:function(namespaceURI){\n    \tvar prefix = this.lookupPrefix(namespaceURI);\n    \treturn prefix == null;\n    }\n};\n\n\nfunction _xmlEncoder(c){\n\treturn c == '<' && '&lt;' ||\n         c == '>' && '&gt;' ||\n         c == '&' && '&amp;' ||\n         c == '\"' && '&quot;' ||\n         '&#'+c.charCodeAt()+';'\n}\n\n\ncopy(NodeType,Node);\ncopy(NodeType,Node.prototype);\n\n/**\n * @param callback return true for continue,false for break\n * @return boolean true: break visit;\n */\nfunction _visitNode(node,callback){\n\tif(callback(node)){\n\t\treturn true;\n\t}\n\tif(node = node.firstChild){\n\t\tdo{\n\t\t\tif(_visitNode(node,callback)){return true}\n        }while(node=node.nextSibling)\n    }\n}\n\n\n\nfunction Document(){\n}\nfunction _onAddAttribute(doc,el,newAttr){\n\tdoc && doc._inc++;\n\tvar ns = newAttr.namespaceURI ;\n\tif(ns == 'http://www.w3.org/2000/xmlns/'){\n\t\t//update namespace\n\t\tel._nsMap[newAttr.prefix?newAttr.localName:''] = newAttr.value\n\t}\n}\nfunction _onRemoveAttribute(doc,el,newAttr,remove){\n\tdoc && doc._inc++;\n\tvar ns = newAttr.namespaceURI ;\n\tif(ns == 'http://www.w3.org/2000/xmlns/'){\n\t\t//update namespace\n\t\tdelete el._nsMap[newAttr.prefix?newAttr.localName:'']\n\t}\n}\nfunction _onUpdateChild(doc,el,newChild){\n\tif(doc && doc._inc){\n\t\tdoc._inc++;\n\t\t//update childNodes\n\t\tvar cs = el.childNodes;\n\t\tif(newChild){\n\t\t\tcs[cs.length++] = newChild;\n\t\t}else{\n\t\t\t//console.log(1)\n\t\t\tvar child = el.firstChild;\n\t\t\tvar i = 0;\n\t\t\twhile(child){\n\t\t\t\tcs[i++] = child;\n\t\t\t\tchild =child.nextSibling;\n\t\t\t}\n\t\t\tcs.length = i;\n\t\t}\n\t}\n}\n\n/**\n * attributes;\n * children;\n * \n * writeable properties:\n * nodeValue,Attr:value,CharacterData:data\n * prefix\n */\nfunction _removeChild(parentNode,child){\n\tvar previous = child.previousSibling;\n\tvar next = child.nextSibling;\n\tif(previous){\n\t\tprevious.nextSibling = next;\n\t}else{\n\t\tparentNode.firstChild = next\n\t}\n\tif(next){\n\t\tnext.previousSibling = previous;\n\t}else{\n\t\tparentNode.lastChild = previous;\n\t}\n\t_onUpdateChild(parentNode.ownerDocument,parentNode);\n\treturn child;\n}\n/**\n * preformance key(refChild == null)\n */\nfunction _insertBefore(parentNode,newChild,nextChild){\n\tvar cp = newChild.parentNode;\n\tif(cp){\n\t\tcp.removeChild(newChild);//remove and update\n\t}\n\tif(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){\n\t\tvar newFirst = newChild.firstChild;\n\t\tif (newFirst == null) {\n\t\t\treturn newChild;\n\t\t}\n\t\tvar newLast = newChild.lastChild;\n\t}else{\n\t\tnewFirst = newLast = newChild;\n\t}\n\tvar pre = nextChild ? nextChild.previousSibling : parentNode.lastChild;\n\n\tnewFirst.previousSibling = pre;\n\tnewLast.nextSibling = nextChild;\n\t\n\t\n\tif(pre){\n\t\tpre.nextSibling = newFirst;\n\t}else{\n\t\tparentNode.firstChild = newFirst;\n\t}\n\tif(nextChild == null){\n\t\tparentNode.lastChild = newLast;\n\t}else{\n\t\tnextChild.previousSibling = newLast;\n\t}\n\tdo{\n\t\tnewFirst.parentNode = parentNode;\n\t}while(newFirst !== newLast && (newFirst= newFirst.nextSibling))\n\t_onUpdateChild(parentNode.ownerDocument||parentNode,parentNode);\n\t//console.log(parentNode.lastChild.nextSibling == null)\n\tif (newChild.nodeType == DOCUMENT_FRAGMENT_NODE) {\n\t\tnewChild.firstChild = newChild.lastChild = null;\n\t}\n\treturn newChild;\n}\nfunction _appendSingleChild(parentNode,newChild){\n\tvar cp = newChild.parentNode;\n\tif(cp){\n\t\tvar pre = parentNode.lastChild;\n\t\tcp.removeChild(newChild);//remove and update\n\t\tvar pre = parentNode.lastChild;\n\t}\n\tvar pre = parentNode.lastChild;\n\tnewChild.parentNode = parentNode;\n\tnewChild.previousSibling = pre;\n\tnewChild.nextSibling = null;\n\tif(pre){\n\t\tpre.nextSibling = newChild;\n\t}else{\n\t\tparentNode.firstChild = newChild;\n\t}\n\tparentNode.lastChild = newChild;\n\t_onUpdateChild(parentNode.ownerDocument,parentNode,newChild);\n\treturn newChild;\n\t//console.log(\"__aa\",parentNode.lastChild.nextSibling == null)\n}\nDocument.prototype = {\n\t//implementation : null,\n\tnodeName :  '#document',\n\tnodeType :  DOCUMENT_NODE,\n\tdoctype :  null,\n\tdocumentElement :  null,\n\t_inc : 1,\n\t\n\tinsertBefore :  function(newChild, refChild){//raises \n\t\tif(newChild.nodeType == DOCUMENT_FRAGMENT_NODE){\n\t\t\tvar child = newChild.firstChild;\n\t\t\twhile(child){\n\t\t\t\tvar next = child.nextSibling;\n\t\t\t\tthis.insertBefore(child,refChild);\n\t\t\t\tchild = next;\n\t\t\t}\n\t\t\treturn newChild;\n\t\t}\n\t\tif(this.documentElement == null && newChild.nodeType == ELEMENT_NODE){\n\t\t\tthis.documentElement = newChild;\n\t\t}\n\t\t\n\t\treturn _insertBefore(this,newChild,refChild),(newChild.ownerDocument = this),newChild;\n\t},\n\tremoveChild :  function(oldChild){\n\t\tif(this.documentElement == oldChild){\n\t\t\tthis.documentElement = null;\n\t\t}\n\t\treturn _removeChild(this,oldChild);\n\t},\n\t// Introduced in DOM Level 2:\n\timportNode : function(importedNode,deep){\n\t\treturn importNode(this,importedNode,deep);\n\t},\n\t// Introduced in DOM Level 2:\n\tgetElementById :\tfunction(id){\n\t\tvar rtv = null;\n\t\t_visitNode(this.documentElement,function(node){\n\t\t\tif(node.nodeType == ELEMENT_NODE){\n\t\t\t\tif(node.getAttribute('id') == id){\n\t\t\t\t\trtv = node;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\treturn rtv;\n\t},\n\t\n\t//document factory method:\n\tcreateElement :\tfunction(tagName){\n\t\tvar node = new Element();\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = tagName;\n\t\tnode.tagName = tagName;\n\t\tnode.childNodes = new NodeList();\n\t\tvar attrs\t= node.attributes = new NamedNodeMap();\n\t\tattrs._ownerElement = node;\n\t\treturn node;\n\t},\n\tcreateDocumentFragment :\tfunction(){\n\t\tvar node = new DocumentFragment();\n\t\tnode.ownerDocument = this;\n\t\tnode.childNodes = new NodeList();\n\t\treturn node;\n\t},\n\tcreateTextNode :\tfunction(data){\n\t\tvar node = new Text();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateComment :\tfunction(data){\n\t\tvar node = new Comment();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateCDATASection :\tfunction(data){\n\t\tvar node = new CDATASection();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateProcessingInstruction :\tfunction(target,data){\n\t\tvar node = new ProcessingInstruction();\n\t\tnode.ownerDocument = this;\n\t\tnode.tagName = node.target = target;\n\t\tnode.nodeValue= node.data = data;\n\t\treturn node;\n\t},\n\tcreateAttribute :\tfunction(name){\n\t\tvar node = new Attr();\n\t\tnode.ownerDocument\t= this;\n\t\tnode.name = name;\n\t\tnode.nodeName\t= name;\n\t\tnode.localName = name;\n\t\tnode.specified = true;\n\t\treturn node;\n\t},\n\tcreateEntityReference :\tfunction(name){\n\t\tvar node = new EntityReference();\n\t\tnode.ownerDocument\t= this;\n\t\tnode.nodeName\t= name;\n\t\treturn node;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateElementNS :\tfunction(namespaceURI,qualifiedName){\n\t\tvar node = new Element();\n\t\tvar pl = qualifiedName.split(':');\n\t\tvar attrs\t= node.attributes = new NamedNodeMap();\n\t\tnode.childNodes = new NodeList();\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.tagName = qualifiedName;\n\t\tnode.namespaceURI = namespaceURI;\n\t\tif(pl.length == 2){\n\t\t\tnode.prefix = pl[0];\n\t\t\tnode.localName = pl[1];\n\t\t}else{\n\t\t\t//el.prefix = null;\n\t\t\tnode.localName = qualifiedName;\n\t\t}\n\t\tattrs._ownerElement = node;\n\t\treturn node;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateAttributeNS :\tfunction(namespaceURI,qualifiedName){\n\t\tvar node = new Attr();\n\t\tvar pl = qualifiedName.split(':');\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.name = qualifiedName;\n\t\tnode.namespaceURI = namespaceURI;\n\t\tnode.specified = true;\n\t\tif(pl.length == 2){\n\t\t\tnode.prefix = pl[0];\n\t\t\tnode.localName = pl[1];\n\t\t}else{\n\t\t\t//el.prefix = null;\n\t\t\tnode.localName = qualifiedName;\n\t\t}\n\t\treturn node;\n\t}\n};\n_extends(Document,Node);\n\n\nfunction Element() {\n\tthis._nsMap = {};\n};\nElement.prototype = {\n\tnodeType : ELEMENT_NODE,\n\thasAttribute : function(name){\n\t\treturn this.getAttributeNode(name)!=null;\n\t},\n\tgetAttribute : function(name){\n\t\tvar attr = this.getAttributeNode(name);\n\t\treturn attr && attr.value || '';\n\t},\n\tgetAttributeNode : function(name){\n\t\treturn this.attributes.getNamedItem(name);\n\t},\n\tsetAttribute : function(name, value){\n\t\tvar attr = this.ownerDocument.createAttribute(name);\n\t\tattr.value = attr.nodeValue = \"\" + value;\n\t\tthis.setAttributeNode(attr)\n\t},\n\tremoveAttribute : function(name){\n\t\tvar attr = this.getAttributeNode(name)\n\t\tattr && this.removeAttributeNode(attr);\n\t},\n\t\n\t//four real opeartion method\n\tappendChild:function(newChild){\n\t\tif(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){\n\t\t\treturn this.insertBefore(newChild,null);\n\t\t}else{\n\t\t\treturn _appendSingleChild(this,newChild);\n\t\t}\n\t},\n\tsetAttributeNode : function(newAttr){\n\t\treturn this.attributes.setNamedItem(newAttr);\n\t},\n\tsetAttributeNodeNS : function(newAttr){\n\t\treturn this.attributes.setNamedItemNS(newAttr);\n\t},\n\tremoveAttributeNode : function(oldAttr){\n\t\t//console.log(this == oldAttr.ownerElement)\n\t\treturn this.attributes.removeNamedItem(oldAttr.nodeName);\n\t},\n\t//get real attribute name,and remove it by removeAttributeNode\n\tremoveAttributeNS : function(namespaceURI, localName){\n\t\tvar old = this.getAttributeNodeNS(namespaceURI, localName);\n\t\told && this.removeAttributeNode(old);\n\t},\n\t\n\thasAttributeNS : function(namespaceURI, localName){\n\t\treturn this.getAttributeNodeNS(namespaceURI, localName)!=null;\n\t},\n\tgetAttributeNS : function(namespaceURI, localName){\n\t\tvar attr = this.getAttributeNodeNS(namespaceURI, localName);\n\t\treturn attr && attr.value || '';\n\t},\n\tsetAttributeNS : function(namespaceURI, qualifiedName, value){\n\t\tvar attr = this.ownerDocument.createAttributeNS(namespaceURI, qualifiedName);\n\t\tattr.value = attr.nodeValue = \"\" + value;\n\t\tthis.setAttributeNode(attr)\n\t},\n\tgetAttributeNodeNS : function(namespaceURI, localName){\n\t\treturn this.attributes.getNamedItemNS(namespaceURI, localName);\n\t},\n\t\n\tgetElementsByTagName : function(tagName){\n\t\treturn new LiveNodeList(this,function(base){\n\t\t\tvar ls = [];\n\t\t\t_visitNode(base,function(node){\n\t\t\t\tif(node !== base && node.nodeType == ELEMENT_NODE && (tagName === '*' || node.tagName == tagName)){\n\t\t\t\t\tls.push(node);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ls;\n\t\t});\n\t},\n\tgetElementsByTagNameNS : function(namespaceURI, localName){\n\t\treturn new LiveNodeList(this,function(base){\n\t\t\tvar ls = [];\n\t\t\t_visitNode(base,function(node){\n\t\t\t\tif(node !== base && node.nodeType === ELEMENT_NODE && (namespaceURI === '*' || node.namespaceURI === namespaceURI) && (localName === '*' || node.localName == localName)){\n\t\t\t\t\tls.push(node);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ls;\n\t\t\t\n\t\t});\n\t}\n};\nDocument.prototype.getElementsByTagName = Element.prototype.getElementsByTagName;\nDocument.prototype.getElementsByTagNameNS = Element.prototype.getElementsByTagNameNS;\n\n\n_extends(Element,Node);\nfunction Attr() {\n};\nAttr.prototype.nodeType = ATTRIBUTE_NODE;\n_extends(Attr,Node);\n\n\nfunction CharacterData() {\n};\nCharacterData.prototype = {\n\tdata : '',\n\tsubstringData : function(offset, count) {\n\t\treturn this.data.substring(offset, offset+count);\n\t},\n\tappendData: function(text) {\n\t\ttext = this.data+text;\n\t\tthis.nodeValue = this.data = text;\n\t\tthis.length = text.length;\n\t},\n\tinsertData: function(offset,text) {\n\t\tthis.replaceData(offset,0,text);\n\t\n\t},\n\tappendChild:function(newChild){\n\t\tthrow new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])\n\t},\n\tdeleteData: function(offset, count) {\n\t\tthis.replaceData(offset,count,\"\");\n\t},\n\treplaceData: function(offset, count, text) {\n\t\tvar start = this.data.substring(0,offset);\n\t\tvar end = this.data.substring(offset+count);\n\t\ttext = start + text + end;\n\t\tthis.nodeValue = this.data = text;\n\t\tthis.length = text.length;\n\t}\n}\n_extends(CharacterData,Node);\nfunction Text() {\n};\nText.prototype = {\n\tnodeName : \"#text\",\n\tnodeType : TEXT_NODE,\n\tsplitText : function(offset) {\n\t\tvar text = this.data;\n\t\tvar newText = text.substring(offset);\n\t\ttext = text.substring(0, offset);\n\t\tthis.data = this.nodeValue = text;\n\t\tthis.length = text.length;\n\t\tvar newNode = this.ownerDocument.createTextNode(newText);\n\t\tif(this.parentNode){\n\t\t\tthis.parentNode.insertBefore(newNode, this.nextSibling);\n\t\t}\n\t\treturn newNode;\n\t}\n}\n_extends(Text,CharacterData);\nfunction Comment() {\n};\nComment.prototype = {\n\tnodeName : \"#comment\",\n\tnodeType : COMMENT_NODE\n}\n_extends(Comment,CharacterData);\n\nfunction CDATASection() {\n};\nCDATASection.prototype = {\n\tnodeName : \"#cdata-section\",\n\tnodeType : CDATA_SECTION_NODE\n}\n_extends(CDATASection,CharacterData);\n\n\nfunction DocumentType() {\n};\nDocumentType.prototype.nodeType = DOCUMENT_TYPE_NODE;\n_extends(DocumentType,Node);\n\nfunction Notation() {\n};\nNotation.prototype.nodeType = NOTATION_NODE;\n_extends(Notation,Node);\n\nfunction Entity() {\n};\nEntity.prototype.nodeType = ENTITY_NODE;\n_extends(Entity,Node);\n\nfunction EntityReference() {\n};\nEntityReference.prototype.nodeType = ENTITY_REFERENCE_NODE;\n_extends(EntityReference,Node);\n\nfunction DocumentFragment() {\n};\nDocumentFragment.prototype.nodeName =\t\"#document-fragment\";\nDocumentFragment.prototype.nodeType =\tDOCUMENT_FRAGMENT_NODE;\n_extends(DocumentFragment,Node);\n\n\nfunction ProcessingInstruction() {\n}\nProcessingInstruction.prototype.nodeType = PROCESSING_INSTRUCTION_NODE;\n_extends(ProcessingInstruction,Node);\nfunction XMLSerializer(){}\nXMLSerializer.prototype.serializeToString = function(node,isHtml,nodeFilter){\n\treturn nodeSerializeToString.call(node,isHtml,nodeFilter);\n}\nNode.prototype.toString = nodeSerializeToString;\nfunction nodeSerializeToString(isHtml,nodeFilter){\n\tvar buf = [];\n\tvar refNode = this.nodeType == 9?this.documentElement:this;\n\tvar prefix = refNode.prefix;\n\tvar uri = refNode.namespaceURI;\n\t\n\tif(uri && prefix == null){\n\t\t//console.log(prefix)\n\t\tvar prefix = refNode.lookupPrefix(uri);\n\t\tif(prefix == null){\n\t\t\t//isHTML = true;\n\t\t\tvar visibleNamespaces=[\n\t\t\t{namespace:uri,prefix:null}\n\t\t\t//{namespace:uri,prefix:''}\n\t\t\t]\n\t\t}\n\t}\n\tserializeToString(this,buf,isHtml,nodeFilter,visibleNamespaces);\n\t//console.log('###',this.nodeType,uri,prefix,buf.join(''))\n\treturn buf.join('');\n}\nfunction needNamespaceDefine(node,isHTML, visibleNamespaces) {\n\tvar prefix = node.prefix||'';\n\tvar uri = node.namespaceURI;\n\tif (!prefix && !uri){\n\t\treturn false;\n\t}\n\tif (prefix === \"xml\" && uri === \"http://www.w3.org/XML/1998/namespace\" \n\t\t|| uri == 'http://www.w3.org/2000/xmlns/'){\n\t\treturn false;\n\t}\n\t\n\tvar i = visibleNamespaces.length \n\t//console.log('@@@@',node.tagName,prefix,uri,visibleNamespaces)\n\twhile (i--) {\n\t\tvar ns = visibleNamespaces[i];\n\t\t// get namespace prefix\n\t\t//console.log(node.nodeType,node.tagName,ns.prefix,prefix)\n\t\tif (ns.prefix == prefix){\n\t\t\treturn ns.namespace != uri;\n\t\t}\n\t}\n\t//console.log(isHTML,uri,prefix=='')\n\t//if(isHTML && prefix ==null && uri == 'http://www.w3.org/1999/xhtml'){\n\t//\treturn false;\n\t//}\n\t//node.flag = '11111'\n\t//console.error(3,true,node.flag,node.prefix,node.namespaceURI)\n\treturn true;\n}\nfunction serializeToString(node,buf,isHTML,nodeFilter,visibleNamespaces){\n\tif(nodeFilter){\n\t\tnode = nodeFilter(node);\n\t\tif(node){\n\t\t\tif(typeof node == 'string'){\n\t\t\t\tbuf.push(node);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}else{\n\t\t\treturn;\n\t\t}\n\t\t//buf.sort.apply(attrs, attributeSorter);\n\t}\n\tswitch(node.nodeType){\n\tcase ELEMENT_NODE:\n\t\tif (!visibleNamespaces) visibleNamespaces = [];\n\t\tvar startVisibleNamespaces = visibleNamespaces.length;\n\t\tvar attrs = node.attributes;\n\t\tvar len = attrs.length;\n\t\tvar child = node.firstChild;\n\t\tvar nodeName = node.tagName;\n\t\t\n\t\tisHTML =  (htmlns === node.namespaceURI) ||isHTML \n\t\tbuf.push('<',nodeName);\n\t\t\n\t\t\n\t\t\n\t\tfor(var i=0;i<len;i++){\n\t\t\t// add namespaces for attributes\n\t\t\tvar attr = attrs.item(i);\n\t\t\tif (attr.prefix == 'xmlns') {\n\t\t\t\tvisibleNamespaces.push({ prefix: attr.localName, namespace: attr.value });\n\t\t\t}else if(attr.nodeName == 'xmlns'){\n\t\t\t\tvisibleNamespaces.push({ prefix: '', namespace: attr.value });\n\t\t\t}\n\t\t}\n\t\tfor(var i=0;i<len;i++){\n\t\t\tvar attr = attrs.item(i);\n\t\t\tif (needNamespaceDefine(attr,isHTML, visibleNamespaces)) {\n\t\t\t\tvar prefix = attr.prefix||'';\n\t\t\t\tvar uri = attr.namespaceURI;\n\t\t\t\tvar ns = prefix ? ' xmlns:' + prefix : \" xmlns\";\n\t\t\t\tbuf.push(ns, '=\"' , uri , '\"');\n\t\t\t\tvisibleNamespaces.push({ prefix: prefix, namespace:uri });\n\t\t\t}\n\t\t\tserializeToString(attr,buf,isHTML,nodeFilter,visibleNamespaces);\n\t\t}\n\t\t// add namespace for current node\t\t\n\t\tif (needNamespaceDefine(node,isHTML, visibleNamespaces)) {\n\t\t\tvar prefix = node.prefix||'';\n\t\t\tvar uri = node.namespaceURI;\n\t\t\tvar ns = prefix ? ' xmlns:' + prefix : \" xmlns\";\n\t\t\tbuf.push(ns, '=\"' , uri , '\"');\n\t\t\tvisibleNamespaces.push({ prefix: prefix, namespace:uri });\n\t\t}\n\t\t\n\t\tif(child || isHTML && !/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){\n\t\t\tbuf.push('>');\n\t\t\t//if is cdata child node\n\t\t\tif(isHTML && /^script$/i.test(nodeName)){\n\t\t\t\twhile(child){\n\t\t\t\t\tif(child.data){\n\t\t\t\t\t\tbuf.push(child.data);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tserializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces);\n\t\t\t\t\t}\n\t\t\t\t\tchild = child.nextSibling;\n\t\t\t\t}\n\t\t\t}else\n\t\t\t{\n\t\t\t\twhile(child){\n\t\t\t\t\tserializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces);\n\t\t\t\t\tchild = child.nextSibling;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuf.push('</',nodeName,'>');\n\t\t}else{\n\t\t\tbuf.push('/>');\n\t\t}\n\t\t// remove added visible namespaces\n\t\t//visibleNamespaces.length = startVisibleNamespaces;\n\t\treturn;\n\tcase DOCUMENT_NODE:\n\tcase DOCUMENT_FRAGMENT_NODE:\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tserializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces);\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t\treturn;\n\tcase ATTRIBUTE_NODE:\n\t\treturn buf.push(' ',node.name,'=\"',node.value.replace(/[<&\"]/g,_xmlEncoder),'\"');\n\tcase TEXT_NODE:\n\t\treturn buf.push(node.data.replace(/[<&]/g,_xmlEncoder));\n\tcase CDATA_SECTION_NODE:\n\t\treturn buf.push( '<![CDATA[',node.data,']]>');\n\tcase COMMENT_NODE:\n\t\treturn buf.push( \"<!--\",node.data,\"-->\");\n\tcase DOCUMENT_TYPE_NODE:\n\t\tvar pubid = node.publicId;\n\t\tvar sysid = node.systemId;\n\t\tbuf.push('<!DOCTYPE ',node.name);\n\t\tif(pubid){\n\t\t\tbuf.push(' PUBLIC \"',pubid);\n\t\t\tif (sysid && sysid!='.') {\n\t\t\t\tbuf.push( '\" \"',sysid);\n\t\t\t}\n\t\t\tbuf.push('\">');\n\t\t}else if(sysid && sysid!='.'){\n\t\t\tbuf.push(' SYSTEM \"',sysid,'\">');\n\t\t}else{\n\t\t\tvar sub = node.internalSubset;\n\t\t\tif(sub){\n\t\t\t\tbuf.push(\" [\",sub,\"]\");\n\t\t\t}\n\t\t\tbuf.push(\">\");\n\t\t}\n\t\treturn;\n\tcase PROCESSING_INSTRUCTION_NODE:\n\t\treturn buf.push( \"<?\",node.target,\" \",node.data,\"?>\");\n\tcase ENTITY_REFERENCE_NODE:\n\t\treturn buf.push( '&',node.nodeName,';');\n\t//case ENTITY_NODE:\n\t//case NOTATION_NODE:\n\tdefault:\n\t\tbuf.push('??',node.nodeName);\n\t}\n}\nfunction importNode(doc,node,deep){\n\tvar node2;\n\tswitch (node.nodeType) {\n\tcase ELEMENT_NODE:\n\t\tnode2 = node.cloneNode(false);\n\t\tnode2.ownerDocument = doc;\n\t\t//var attrs = node2.attributes;\n\t\t//var len = attrs.length;\n\t\t//for(var i=0;i<len;i++){\n\t\t\t//node2.setAttributeNodeNS(importNode(doc,attrs.item(i),deep));\n\t\t//}\n\tcase DOCUMENT_FRAGMENT_NODE:\n\t\tbreak;\n\tcase ATTRIBUTE_NODE:\n\t\tdeep = true;\n\t\tbreak;\n\t//case ENTITY_REFERENCE_NODE:\n\t//case PROCESSING_INSTRUCTION_NODE:\n\t////case TEXT_NODE:\n\t//case CDATA_SECTION_NODE:\n\t//case COMMENT_NODE:\n\t//\tdeep = false;\n\t//\tbreak;\n\t//case DOCUMENT_NODE:\n\t//case DOCUMENT_TYPE_NODE:\n\t//cannot be imported.\n\t//case ENTITY_NODE:\n\t//case NOTATION_NODE：\n\t//can not hit in level3\n\t//default:throw e;\n\t}\n\tif(!node2){\n\t\tnode2 = node.cloneNode(false);//false\n\t}\n\tnode2.ownerDocument = doc;\n\tnode2.parentNode = null;\n\tif(deep){\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tnode2.appendChild(importNode(doc,child,deep));\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t}\n\treturn node2;\n}\n//\n//var _relationMap = {firstChild:1,lastChild:1,previousSibling:1,nextSibling:1,\n//\t\t\t\t\tattributes:1,childNodes:1,parentNode:1,documentElement:1,doctype,};\nfunction cloneNode(doc,node,deep){\n\tvar node2 = new node.constructor();\n\tfor(var n in node){\n\t\tvar v = node[n];\n\t\tif(typeof v != 'object' ){\n\t\t\tif(v != node2[n]){\n\t\t\t\tnode2[n] = v;\n\t\t\t}\n\t\t}\n\t}\n\tif(node.childNodes){\n\t\tnode2.childNodes = new NodeList();\n\t}\n\tnode2.ownerDocument = doc;\n\tswitch (node2.nodeType) {\n\tcase ELEMENT_NODE:\n\t\tvar attrs\t= node.attributes;\n\t\tvar attrs2\t= node2.attributes = new NamedNodeMap();\n\t\tvar len = attrs.length\n\t\tattrs2._ownerElement = node2;\n\t\tfor(var i=0;i<len;i++){\n\t\t\tnode2.setAttributeNode(cloneNode(doc,attrs.item(i),true));\n\t\t}\n\t\tbreak;;\n\tcase ATTRIBUTE_NODE:\n\t\tdeep = true;\n\t}\n\tif(deep){\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tnode2.appendChild(cloneNode(doc,child,deep));\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t}\n\treturn node2;\n}\n\nfunction __set__(object,key,value){\n\tobject[key] = value\n}\n//do dynamic\ntry{\n\tif(Object.defineProperty){\n\t\tObject.defineProperty(LiveNodeList.prototype,'length',{\n\t\t\tget:function(){\n\t\t\t\t_updateLiveList(this);\n\t\t\t\treturn this.$$length;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(Node.prototype,'textContent',{\n\t\t\tget:function(){\n\t\t\t\treturn getTextContent(this);\n\t\t\t},\n\t\t\tset:function(data){\n\t\t\t\tswitch(this.nodeType){\n\t\t\t\tcase ELEMENT_NODE:\n\t\t\t\tcase DOCUMENT_FRAGMENT_NODE:\n\t\t\t\t\twhile(this.firstChild){\n\t\t\t\t\t\tthis.removeChild(this.firstChild);\n\t\t\t\t\t}\n\t\t\t\t\tif(data || String(data)){\n\t\t\t\t\t\tthis.appendChild(this.ownerDocument.createTextNode(data));\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t//TODO:\n\t\t\t\t\tthis.data = data;\n\t\t\t\t\tthis.value = data;\n\t\t\t\t\tthis.nodeValue = data;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t\n\t\tfunction getTextContent(node){\n\t\t\tswitch(node.nodeType){\n\t\t\tcase ELEMENT_NODE:\n\t\t\tcase DOCUMENT_FRAGMENT_NODE:\n\t\t\t\tvar buf = [];\n\t\t\t\tnode = node.firstChild;\n\t\t\t\twhile(node){\n\t\t\t\t\tif(node.nodeType!==7 && node.nodeType !==8){\n\t\t\t\t\t\tbuf.push(getTextContent(node));\n\t\t\t\t\t}\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t}\n\t\t\t\treturn buf.join('');\n\t\t\tdefault:\n\t\t\t\treturn node.nodeValue;\n\t\t\t}\n\t\t}\n\t\t__set__ = function(object,key,value){\n\t\t\t//console.log(value)\n\t\t\tobject['$$'+key] = value\n\t\t}\n\t}\n}catch(e){//ie8\n}\n\n//if(typeof require == 'function'){\n\texports.DOMImplementation = DOMImplementation;\n\texports.XMLSerializer = XMLSerializer;\n//}\n","/*\n\tBased on rgbcolor.js by Stoyan Stefanov <sstoo@gmail.com>\n\thttp://www.phpied.com/rgb-color-parser-in-javascript/\n*/\n\nmodule.exports = function(color_string) {\n    this.ok = false;\n    this.alpha = 1.0;\n\n    // strip any leading #\n    if (color_string.charAt(0) == '#') { // remove # if any\n        color_string = color_string.substr(1,6);\n    }\n\n    color_string = color_string.replace(/ /g,'');\n    color_string = color_string.toLowerCase();\n\n    // before getting into regexps, try simple matches\n    // and overwrite the input\n    var simple_colors = {\n        aliceblue: 'f0f8ff',\n        antiquewhite: 'faebd7',\n        aqua: '00ffff',\n        aquamarine: '7fffd4',\n        azure: 'f0ffff',\n        beige: 'f5f5dc',\n        bisque: 'ffe4c4',\n        black: '000000',\n        blanchedalmond: 'ffebcd',\n        blue: '0000ff',\n        blueviolet: '8a2be2',\n        brown: 'a52a2a',\n        burlywood: 'deb887',\n        cadetblue: '5f9ea0',\n        chartreuse: '7fff00',\n        chocolate: 'd2691e',\n        coral: 'ff7f50',\n        cornflowerblue: '6495ed',\n        cornsilk: 'fff8dc',\n        crimson: 'dc143c',\n        cyan: '00ffff',\n        darkblue: '00008b',\n        darkcyan: '008b8b',\n        darkgoldenrod: 'b8860b',\n        darkgray: 'a9a9a9',\n        darkgreen: '006400',\n        darkkhaki: 'bdb76b',\n        darkmagenta: '8b008b',\n        darkolivegreen: '556b2f',\n        darkorange: 'ff8c00',\n        darkorchid: '9932cc',\n        darkred: '8b0000',\n        darksalmon: 'e9967a',\n        darkseagreen: '8fbc8f',\n        darkslateblue: '483d8b',\n        darkslategray: '2f4f4f',\n        darkturquoise: '00ced1',\n        darkviolet: '9400d3',\n        deeppink: 'ff1493',\n        deepskyblue: '00bfff',\n        dimgray: '696969',\n        dodgerblue: '1e90ff',\n        feldspar: 'd19275',\n        firebrick: 'b22222',\n        floralwhite: 'fffaf0',\n        forestgreen: '228b22',\n        fuchsia: 'ff00ff',\n        gainsboro: 'dcdcdc',\n        ghostwhite: 'f8f8ff',\n        gold: 'ffd700',\n        goldenrod: 'daa520',\n        gray: '808080',\n        green: '008000',\n        greenyellow: 'adff2f',\n        honeydew: 'f0fff0',\n        hotpink: 'ff69b4',\n        indianred : 'cd5c5c',\n        indigo : '4b0082',\n        ivory: 'fffff0',\n        khaki: 'f0e68c',\n        lavender: 'e6e6fa',\n        lavenderblush: 'fff0f5',\n        lawngreen: '7cfc00',\n        lemonchiffon: 'fffacd',\n        lightblue: 'add8e6',\n        lightcoral: 'f08080',\n        lightcyan: 'e0ffff',\n        lightgoldenrodyellow: 'fafad2',\n        lightgrey: 'd3d3d3',\n        lightgreen: '90ee90',\n        lightpink: 'ffb6c1',\n        lightsalmon: 'ffa07a',\n        lightseagreen: '20b2aa',\n        lightskyblue: '87cefa',\n        lightslateblue: '8470ff',\n        lightslategray: '778899',\n        lightsteelblue: 'b0c4de',\n        lightyellow: 'ffffe0',\n        lime: '00ff00',\n        limegreen: '32cd32',\n        linen: 'faf0e6',\n        magenta: 'ff00ff',\n        maroon: '800000',\n        mediumaquamarine: '66cdaa',\n        mediumblue: '0000cd',\n        mediumorchid: 'ba55d3',\n        mediumpurple: '9370d8',\n        mediumseagreen: '3cb371',\n        mediumslateblue: '7b68ee',\n        mediumspringgreen: '00fa9a',\n        mediumturquoise: '48d1cc',\n        mediumvioletred: 'c71585',\n        midnightblue: '191970',\n        mintcream: 'f5fffa',\n        mistyrose: 'ffe4e1',\n        moccasin: 'ffe4b5',\n        navajowhite: 'ffdead',\n        navy: '000080',\n        oldlace: 'fdf5e6',\n        olive: '808000',\n        olivedrab: '6b8e23',\n        orange: 'ffa500',\n        orangered: 'ff4500',\n        orchid: 'da70d6',\n        palegoldenrod: 'eee8aa',\n        palegreen: '98fb98',\n        paleturquoise: 'afeeee',\n        palevioletred: 'd87093',\n        papayawhip: 'ffefd5',\n        peachpuff: 'ffdab9',\n        peru: 'cd853f',\n        pink: 'ffc0cb',\n        plum: 'dda0dd',\n        powderblue: 'b0e0e6',\n        purple: '800080',\n        red: 'ff0000',\n        rosybrown: 'bc8f8f',\n        royalblue: '4169e1',\n        saddlebrown: '8b4513',\n        salmon: 'fa8072',\n        sandybrown: 'f4a460',\n        seagreen: '2e8b57',\n        seashell: 'fff5ee',\n        sienna: 'a0522d',\n        silver: 'c0c0c0',\n        skyblue: '87ceeb',\n        slateblue: '6a5acd',\n        slategray: '708090',\n        snow: 'fffafa',\n        springgreen: '00ff7f',\n        steelblue: '4682b4',\n        tan: 'd2b48c',\n        teal: '008080',\n        thistle: 'd8bfd8',\n        tomato: 'ff6347',\n        turquoise: '40e0d0',\n        violet: 'ee82ee',\n        violetred: 'd02090',\n        wheat: 'f5deb3',\n        white: 'ffffff',\n        whitesmoke: 'f5f5f5',\n        yellow: 'ffff00',\n        yellowgreen: '9acd32'\n    };\n    color_string = simple_colors[color_string] || color_string;\n    // emd of simple type-in colors\n\n    // array of color definition objects\n    var color_defs = [\n        {\n            re: /^rgba\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3}),\\s*((?:\\d?\\.)?\\d)\\)$/,\n            example: ['rgba(123, 234, 45, 0.8)', 'rgba(255,234,245,1.0)'],\n            process: function (bits){\n                return [\n                    parseInt(bits[1]),\n                    parseInt(bits[2]),\n                    parseInt(bits[3]),\n                    parseFloat(bits[4])\n                ];\n            }\n        },\n        {\n            re: /^rgb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)$/,\n            example: ['rgb(123, 234, 45)', 'rgb(255,234,245)'],\n            process: function (bits){\n                return [\n                    parseInt(bits[1]),\n                    parseInt(bits[2]),\n                    parseInt(bits[3])\n                ];\n            }\n        },\n        {\n            re: /^(\\w{2})(\\w{2})(\\w{2})$/,\n            example: ['#00ff00', '336699'],\n            process: function (bits){\n                return [\n                    parseInt(bits[1], 16),\n                    parseInt(bits[2], 16),\n                    parseInt(bits[3], 16)\n                ];\n            }\n        },\n        {\n            re: /^(\\w{1})(\\w{1})(\\w{1})$/,\n            example: ['#fb0', 'f0f'],\n            process: function (bits){\n                return [\n                    parseInt(bits[1] + bits[1], 16),\n                    parseInt(bits[2] + bits[2], 16),\n                    parseInt(bits[3] + bits[3], 16)\n                ];\n            }\n        }\n    ];\n\n    // search through the definitions to find a match\n    for (var i = 0; i < color_defs.length; i++) {\n        var re = color_defs[i].re;\n        var processor = color_defs[i].process;\n        var bits = re.exec(color_string);\n        if (bits) {\n            var channels = processor(bits);\n            this.r = channels[0];\n            this.g = channels[1];\n            this.b = channels[2];\n            if (channels.length > 3) {\n                this.alpha = channels[3];\n            }\n            this.ok = true;\n        }\n\n    }\n\n    // validate/cleanup values\n    this.r = (this.r < 0 || isNaN(this.r)) ? 0 : ((this.r > 255) ? 255 : this.r);\n    this.g = (this.g < 0 || isNaN(this.g)) ? 0 : ((this.g > 255) ? 255 : this.g);\n    this.b = (this.b < 0 || isNaN(this.b)) ? 0 : ((this.b > 255) ? 255 : this.b);\n    this.alpha = (this.alpha < 0) ? 0 : ((this.alpha > 1.0 || isNaN(this.alpha)) ? 1.0 : this.alpha);\n\n    // some getters\n    this.toRGB = function () {\n        return 'rgb(' + this.r + ', ' + this.g + ', ' + this.b + ')';\n    }\n    this.toRGBA = function () {\n        return 'rgba(' + this.r + ', ' + this.g + ', ' + this.b + ', ' + this.alpha + ')';\n    }\n    this.toHex = function () {\n        var r = this.r.toString(16);\n        var g = this.g.toString(16);\n        var b = this.b.toString(16);\n        if (r.length == 1) r = '0' + r;\n        if (g.length == 1) g = '0' + g;\n        if (b.length == 1) b = '0' + b;\n        return '#' + r + g + b;\n    }\n\n    // help\n    this.getHelpXML = function () {\n\n        var examples = new Array();\n        // add regexps\n        for (var i = 0; i < color_defs.length; i++) {\n            var example = color_defs[i].example;\n            for (var j = 0; j < example.length; j++) {\n                examples[examples.length] = example[j];\n            }\n        }\n        // add type-in colors\n        for (var sc in simple_colors) {\n            examples[examples.length] = sc;\n        }\n\n        var xml = document.createElement('ul');\n        xml.setAttribute('id', 'rgbcolor-examples');\n        for (var i = 0; i < examples.length; i++) {\n            try {\n                var list_item = document.createElement('li');\n                var list_color = new RGBColor(examples[i]);\n                var example_div = document.createElement('div');\n                example_div.style.cssText =\n                        'margin: 3px; '\n                        + 'border: 1px solid black; '\n                        + 'background:' + list_color.toHex() + '; '\n                        + 'color:' + list_color.toHex()\n                ;\n                example_div.appendChild(document.createTextNode('test'));\n                var list_item_value = document.createTextNode(\n                    ' ' + examples[i] + ' -> ' + list_color.toRGB() + ' -> ' + list_color.toHex()\n                );\n                list_item.appendChild(example_div);\n                list_item.appendChild(list_item_value);\n                xml.appendChild(list_item);\n\n            } catch(e){}\n        }\n        return xml;\n\n    }\n\n}\n","/*\n\nStackBlur - a fast almost Gaussian Blur For Canvas\n\nVersion: \t0.5\nAuthor:\t\tMario Klingemann\nContact: \tmario@quasimondo.com\nWebsite:\thttp://www.quasimondo.com/StackBlurForCanvas\nTwitter:\t@quasimondo\n\nIn case you find this class useful - especially in commercial projects -\nI am not totally unhappy for a small donation to my PayPal account\nmario@quasimondo.de\n\nOr support me on flattr: \nhttps://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript\n\nCopyright (c) 2010 Mario Klingemann\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n\nvar mul_table = [\n        512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,\n        454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,\n        482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,\n        437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,\n        497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,\n        320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,\n        446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,\n        329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,\n        505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,\n        399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,\n        324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,\n        268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,\n        451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,\n        385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,\n        332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,\n        289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];\n        \n   \nvar shg_table = [\n\t     9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17, \n\t\t17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, \n\t\t19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20,\n\t\t20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,\n\t\t21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,\n\t\t21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, \n\t\t22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,\n\t\t22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, \n\t\t23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n\t\t23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n\t\t23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, \n\t\t23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, \n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24 ];\n\nfunction blur( pixels, width, height, radius )\n{\n\tif ( isNaN(radius) || radius < 1 ) return;\n\tradius |= 0;\n\n\tvar x, y, i, p, yp, yi, yw, r_sum, g_sum, b_sum, a_sum, \n\tr_out_sum, g_out_sum, b_out_sum, a_out_sum,\n\tr_in_sum, g_in_sum, b_in_sum, a_in_sum, \n\tpr, pg, pb, pa, rbs;\n\t\t\t\n\tvar div = radius + radius + 1;\n\tvar w4 = width << 2;\n\tvar widthMinus1  = width - 1;\n\tvar heightMinus1 = height - 1;\n\tvar radiusPlus1  = radius + 1;\n\tvar sumFactor = radiusPlus1 * ( radiusPlus1 + 1 ) / 2;\n\t\n\tvar stackStart = new BlurStack();\n\tvar stack = stackStart;\n\tfor ( i = 1; i < div; i++ )\n\t{\n\t\tstack = stack.next = new BlurStack();\n\t\tif ( i == radiusPlus1 ) var stackEnd = stack;\n\t}\n\tstack.next = stackStart;\n\tvar stackIn = null;\n\tvar stackOut = null;\n\t\n\tyw = yi = 0;\n\t\n\tvar mul_sum = mul_table[radius];\n\tvar shg_sum = shg_table[radius];\n\t\n\tfor ( y = 0; y < height; y++ )\n\t{\n\t\tr_in_sum = g_in_sum = b_in_sum = a_in_sum = r_sum = g_sum = b_sum = a_sum = 0;\n\t\t\n\t\tr_out_sum = radiusPlus1 * ( pr = pixels[yi] );\n\t\tg_out_sum = radiusPlus1 * ( pg = pixels[yi+1] );\n\t\tb_out_sum = radiusPlus1 * ( pb = pixels[yi+2] );\n\t\ta_out_sum = radiusPlus1 * ( pa = pixels[yi+3] );\n\t\t\n\t\tr_sum += sumFactor * pr;\n\t\tg_sum += sumFactor * pg;\n\t\tb_sum += sumFactor * pb;\n\t\ta_sum += sumFactor * pa;\n\t\t\n\t\tstack = stackStart;\n\t\t\n\t\tfor( i = 0; i < radiusPlus1; i++ )\n\t\t{\n\t\t\tstack.r = pr;\n\t\t\tstack.g = pg;\n\t\t\tstack.b = pb;\n\t\t\tstack.a = pa;\n\t\t\tstack = stack.next;\n\t\t}\n\t\t\n\t\tfor( i = 1; i < radiusPlus1; i++ )\n\t\t{\n\t\t\tp = yi + (( widthMinus1 < i ? widthMinus1 : i ) << 2 );\n\t\t\tr_sum += ( stack.r = ( pr = pixels[p])) * ( rbs = radiusPlus1 - i );\n\t\t\tg_sum += ( stack.g = ( pg = pixels[p+1])) * rbs;\n\t\t\tb_sum += ( stack.b = ( pb = pixels[p+2])) * rbs;\n\t\t\ta_sum += ( stack.a = ( pa = pixels[p+3])) * rbs;\n\t\t\t\n\t\t\tr_in_sum += pr;\n\t\t\tg_in_sum += pg;\n\t\t\tb_in_sum += pb;\n\t\t\ta_in_sum += pa;\n\t\t\t\n\t\t\tstack = stack.next;\n\t\t}\n\t\t\n\t\t\n\t\tstackIn = stackStart;\n\t\tstackOut = stackEnd;\n\t\tfor ( x = 0; x < width; x++ )\n\t\t{\n\t\t\tpixels[yi+3] = pa = (a_sum * mul_sum) >> shg_sum;\n\t\t\tif ( pa != 0 )\n\t\t\t{\n\t\t\t\tpa = 255 / pa;\n\t\t\t\tpixels[yi]   = ((r_sum * mul_sum) >> shg_sum) * pa;\n\t\t\t\tpixels[yi+1] = ((g_sum * mul_sum) >> shg_sum) * pa;\n\t\t\t\tpixels[yi+2] = ((b_sum * mul_sum) >> shg_sum) * pa;\n\t\t\t} else {\n\t\t\t\tpixels[yi] = pixels[yi+1] = pixels[yi+2] = 0;\n\t\t\t}\n\t\t\t\n\t\t\tr_sum -= r_out_sum;\n\t\t\tg_sum -= g_out_sum;\n\t\t\tb_sum -= b_out_sum;\n\t\t\ta_sum -= a_out_sum;\n\t\t\t\n\t\t\tr_out_sum -= stackIn.r;\n\t\t\tg_out_sum -= stackIn.g;\n\t\t\tb_out_sum -= stackIn.b;\n\t\t\ta_out_sum -= stackIn.a;\n\t\t\t\n\t\t\tp =  ( yw + ( ( p = x + radius + 1 ) < widthMinus1 ? p : widthMinus1 ) ) << 2;\n\t\t\t\n\t\t\tr_in_sum += ( stackIn.r = pixels[p]);\n\t\t\tg_in_sum += ( stackIn.g = pixels[p+1]);\n\t\t\tb_in_sum += ( stackIn.b = pixels[p+2]);\n\t\t\ta_in_sum += ( stackIn.a = pixels[p+3]);\n\t\t\t\n\t\t\tr_sum += r_in_sum;\n\t\t\tg_sum += g_in_sum;\n\t\t\tb_sum += b_in_sum;\n\t\t\ta_sum += a_in_sum;\n\t\t\t\n\t\t\tstackIn = stackIn.next;\n\t\t\t\n\t\t\tr_out_sum += ( pr = stackOut.r );\n\t\t\tg_out_sum += ( pg = stackOut.g );\n\t\t\tb_out_sum += ( pb = stackOut.b );\n\t\t\ta_out_sum += ( pa = stackOut.a );\n\t\t\t\n\t\t\tr_in_sum -= pr;\n\t\t\tg_in_sum -= pg;\n\t\t\tb_in_sum -= pb;\n\t\t\ta_in_sum -= pa;\n\t\t\t\n\t\t\tstackOut = stackOut.next;\n\n\t\t\tyi += 4;\n\t\t}\n\t\tyw += width;\n\t}\n\n\t\n\tfor ( x = 0; x < width; x++ )\n\t{\n\t\tg_in_sum = b_in_sum = a_in_sum = r_in_sum = g_sum = b_sum = a_sum = r_sum = 0;\n\t\t\n\t\tyi = x << 2;\n\t\tr_out_sum = radiusPlus1 * ( pr = pixels[yi]);\n\t\tg_out_sum = radiusPlus1 * ( pg = pixels[yi+1]);\n\t\tb_out_sum = radiusPlus1 * ( pb = pixels[yi+2]);\n\t\ta_out_sum = radiusPlus1 * ( pa = pixels[yi+3]);\n\t\t\n\t\tr_sum += sumFactor * pr;\n\t\tg_sum += sumFactor * pg;\n\t\tb_sum += sumFactor * pb;\n\t\ta_sum += sumFactor * pa;\n\t\t\n\t\tstack = stackStart;\n\t\t\n\t\tfor( i = 0; i < radiusPlus1; i++ )\n\t\t{\n\t\t\tstack.r = pr;\n\t\t\tstack.g = pg;\n\t\t\tstack.b = pb;\n\t\t\tstack.a = pa;\n\t\t\tstack = stack.next;\n\t\t}\n\t\t\n\t\typ = width;\n\t\t\n\t\tfor( i = 1; i <= radius; i++ )\n\t\t{\n\t\t\tyi = ( yp + x ) << 2;\n\t\t\t\n\t\t\tr_sum += ( stack.r = ( pr = pixels[yi])) * ( rbs = radiusPlus1 - i );\n\t\t\tg_sum += ( stack.g = ( pg = pixels[yi+1])) * rbs;\n\t\t\tb_sum += ( stack.b = ( pb = pixels[yi+2])) * rbs;\n\t\t\ta_sum += ( stack.a = ( pa = pixels[yi+3])) * rbs;\n\t\t   \n\t\t\tr_in_sum += pr;\n\t\t\tg_in_sum += pg;\n\t\t\tb_in_sum += pb;\n\t\t\ta_in_sum += pa;\n\t\t\t\n\t\t\tstack = stack.next;\n\t\t\n\t\t\tif( i < heightMinus1 )\n\t\t\t{\n\t\t\t\typ += width;\n\t\t\t}\n\t\t}\n\t\t\n\t\tyi = x;\n\t\tstackIn = stackStart;\n\t\tstackOut = stackEnd;\n\t\tfor ( y = 0; y < height; y++ )\n\t\t{\n\t\t\tp = yi << 2;\n\t\t\tpixels[p+3] = pa = (a_sum * mul_sum) >> shg_sum;\n\t\t\tif ( pa > 0 )\n\t\t\t{\n\t\t\t\tpa = 255 / pa;\n\t\t\t\tpixels[p]   = ((r_sum * mul_sum) >> shg_sum ) * pa;\n\t\t\t\tpixels[p+1] = ((g_sum * mul_sum) >> shg_sum ) * pa;\n\t\t\t\tpixels[p+2] = ((b_sum * mul_sum) >> shg_sum ) * pa;\n\t\t\t} else {\n\t\t\t\tpixels[p] = pixels[p+1] = pixels[p+2] = 0;\n\t\t\t}\n\t\t\t\n\t\t\tr_sum -= r_out_sum;\n\t\t\tg_sum -= g_out_sum;\n\t\t\tb_sum -= b_out_sum;\n\t\t\ta_sum -= a_out_sum;\n\t\t   \n\t\t\tr_out_sum -= stackIn.r;\n\t\t\tg_out_sum -= stackIn.g;\n\t\t\tb_out_sum -= stackIn.b;\n\t\t\ta_out_sum -= stackIn.a;\n\t\t\t\n\t\t\tp = ( x + (( ( p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1 ) * width )) << 2;\n\t\t\t\n\t\t\tr_sum += ( r_in_sum += ( stackIn.r = pixels[p]));\n\t\t\tg_sum += ( g_in_sum += ( stackIn.g = pixels[p+1]));\n\t\t\tb_sum += ( b_in_sum += ( stackIn.b = pixels[p+2]));\n\t\t\ta_sum += ( a_in_sum += ( stackIn.a = pixels[p+3]));\n\t\t   \n\t\t\tstackIn = stackIn.next;\n\t\t\t\n\t\t\tr_out_sum += ( pr = stackOut.r );\n\t\t\tg_out_sum += ( pg = stackOut.g );\n\t\t\tb_out_sum += ( pb = stackOut.b );\n\t\t\ta_out_sum += ( pa = stackOut.a );\n\t\t\t\n\t\t\tr_in_sum -= pr;\n\t\t\tg_in_sum -= pg;\n\t\t\tb_in_sum -= pb;\n\t\t\ta_in_sum -= pa;\n\t\t\t\n\t\t\tstackOut = stackOut.next;\n\t\t\t\n\t\t\tyi += width;\n\t\t}\n\t}\n}\n\nfunction BlurStack()\n{\n\tthis.r = 0;\n\tthis.g = 0;\n\tthis.b = 0;\n\tthis.a = 0;\n\tthis.next = null;\n}\n\nmodule.exports = blur;","function DOMParser(options){\r\n\tthis.options = options ||{locator:{}};\r\n\t\r\n}\r\nDOMParser.prototype.parseFromString = function(source,mimeType){\r\n\tvar options = this.options;\r\n\tvar sax =  new XMLReader();\r\n\tvar domBuilder = options.domBuilder || new DOMHandler();//contentHandler and LexicalHandler\r\n\tvar errorHandler = options.errorHandler;\r\n\tvar locator = options.locator;\r\n\tvar defaultNSMap = options.xmlns||{};\r\n\tvar entityMap = {'lt':'<','gt':'>','amp':'&','quot':'\"','apos':\"'\"}\r\n\tif(locator){\r\n\t\tdomBuilder.setDocumentLocator(locator)\r\n\t}\r\n\t\r\n\tsax.errorHandler = buildErrorHandler(errorHandler,domBuilder,locator);\r\n\tsax.domBuilder = options.domBuilder || domBuilder;\r\n\tif(/\\/x?html?$/.test(mimeType)){\r\n\t\tentityMap.nbsp = '\\xa0';\r\n\t\tentityMap.copy = '\\xa9';\r\n\t\tdefaultNSMap['']= 'http://www.w3.org/1999/xhtml';\r\n\t}\r\n\tdefaultNSMap.xml = defaultNSMap.xml || 'http://www.w3.org/XML/1998/namespace';\r\n\tif(source){\r\n\t\tsax.parse(source,defaultNSMap,entityMap);\r\n\t}else{\r\n\t\tsax.errorHandler.error(\"invalid doc source\");\r\n\t}\r\n\treturn domBuilder.doc;\r\n}\r\nfunction buildErrorHandler(errorImpl,domBuilder,locator){\r\n\tif(!errorImpl){\r\n\t\tif(domBuilder instanceof DOMHandler){\r\n\t\t\treturn domBuilder;\r\n\t\t}\r\n\t\terrorImpl = domBuilder ;\r\n\t}\r\n\tvar errorHandler = {}\r\n\tvar isCallback = errorImpl instanceof Function;\r\n\tlocator = locator||{}\r\n\tfunction build(key){\r\n\t\tvar fn = errorImpl[key];\r\n\t\tif(!fn && isCallback){\r\n\t\t\tfn = errorImpl.length == 2?function(msg){errorImpl(key,msg)}:errorImpl;\r\n\t\t}\r\n\t\terrorHandler[key] = fn && function(msg){\r\n\t\t\tfn('[xmldom '+key+']\\t'+msg+_locator(locator));\r\n\t\t}||function(){};\r\n\t}\r\n\tbuild('warning');\r\n\tbuild('error');\r\n\tbuild('fatalError');\r\n\treturn errorHandler;\r\n}\r\n\r\n//console.log('#\\n\\n\\n\\n\\n\\n\\n####')\r\n/**\r\n * +ContentHandler+ErrorHandler\r\n * +LexicalHandler+EntityResolver2\r\n * -DeclHandler-DTDHandler \r\n * \r\n * DefaultHandler:EntityResolver, DTDHandler, ContentHandler, ErrorHandler\r\n * DefaultHandler2:DefaultHandler,LexicalHandler, DeclHandler, EntityResolver2\r\n * @link http://www.saxproject.org/apidoc/org/xml/sax/helpers/DefaultHandler.html\r\n */\r\nfunction DOMHandler() {\r\n    this.cdata = false;\r\n}\r\nfunction position(locator,node){\r\n\tnode.lineNumber = locator.lineNumber;\r\n\tnode.columnNumber = locator.columnNumber;\r\n}\r\n/**\r\n * @see org.xml.sax.ContentHandler#startDocument\r\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ContentHandler.html\r\n */ \r\nDOMHandler.prototype = {\r\n\tstartDocument : function() {\r\n    \tthis.doc = new DOMImplementation().createDocument(null, null, null);\r\n    \tif (this.locator) {\r\n        \tthis.doc.documentURI = this.locator.systemId;\r\n    \t}\r\n\t},\r\n\tstartElement:function(namespaceURI, localName, qName, attrs) {\r\n\t\tvar doc = this.doc;\r\n\t    var el = doc.createElementNS(namespaceURI, qName||localName);\r\n\t    var len = attrs.length;\r\n\t    appendElement(this, el);\r\n\t    this.currentElement = el;\r\n\t    \r\n\t\tthis.locator && position(this.locator,el)\r\n\t    for (var i = 0 ; i < len; i++) {\r\n\t        var namespaceURI = attrs.getURI(i);\r\n\t        var value = attrs.getValue(i);\r\n\t        var qName = attrs.getQName(i);\r\n\t\t\tvar attr = doc.createAttributeNS(namespaceURI, qName);\r\n\t\t\tthis.locator &&position(attrs.getLocator(i),attr);\r\n\t\t\tattr.value = attr.nodeValue = value;\r\n\t\t\tel.setAttributeNode(attr)\r\n\t    }\r\n\t},\r\n\tendElement:function(namespaceURI, localName, qName) {\r\n\t\tvar current = this.currentElement\r\n\t\tvar tagName = current.tagName;\r\n\t\tthis.currentElement = current.parentNode;\r\n\t},\r\n\tstartPrefixMapping:function(prefix, uri) {\r\n\t},\r\n\tendPrefixMapping:function(prefix) {\r\n\t},\r\n\tprocessingInstruction:function(target, data) {\r\n\t    var ins = this.doc.createProcessingInstruction(target, data);\r\n\t    this.locator && position(this.locator,ins)\r\n\t    appendElement(this, ins);\r\n\t},\r\n\tignorableWhitespace:function(ch, start, length) {\r\n\t},\r\n\tcharacters:function(chars, start, length) {\r\n\t\tchars = _toString.apply(this,arguments)\r\n\t\t//console.log(chars)\r\n\t\tif(chars){\r\n\t\t\tif (this.cdata) {\r\n\t\t\t\tvar charNode = this.doc.createCDATASection(chars);\r\n\t\t\t} else {\r\n\t\t\t\tvar charNode = this.doc.createTextNode(chars);\r\n\t\t\t}\r\n\t\t\tif(this.currentElement){\r\n\t\t\t\tthis.currentElement.appendChild(charNode);\r\n\t\t\t}else if(/^\\s*$/.test(chars)){\r\n\t\t\t\tthis.doc.appendChild(charNode);\r\n\t\t\t\t//process xml\r\n\t\t\t}\r\n\t\t\tthis.locator && position(this.locator,charNode)\r\n\t\t}\r\n\t},\r\n\tskippedEntity:function(name) {\r\n\t},\r\n\tendDocument:function() {\r\n\t\tthis.doc.normalize();\r\n\t},\r\n\tsetDocumentLocator:function (locator) {\r\n\t    if(this.locator = locator){// && !('lineNumber' in locator)){\r\n\t    \tlocator.lineNumber = 0;\r\n\t    }\r\n\t},\r\n\t//LexicalHandler\r\n\tcomment:function(chars, start, length) {\r\n\t\tchars = _toString.apply(this,arguments)\r\n\t    var comm = this.doc.createComment(chars);\r\n\t    this.locator && position(this.locator,comm)\r\n\t    appendElement(this, comm);\r\n\t},\r\n\t\r\n\tstartCDATA:function() {\r\n\t    //used in characters() methods\r\n\t    this.cdata = true;\r\n\t},\r\n\tendCDATA:function() {\r\n\t    this.cdata = false;\r\n\t},\r\n\t\r\n\tstartDTD:function(name, publicId, systemId) {\r\n\t\tvar impl = this.doc.implementation;\r\n\t    if (impl && impl.createDocumentType) {\r\n\t        var dt = impl.createDocumentType(name, publicId, systemId);\r\n\t        this.locator && position(this.locator,dt)\r\n\t        appendElement(this, dt);\r\n\t    }\r\n\t},\r\n\t/**\r\n\t * @see org.xml.sax.ErrorHandler\r\n\t * @link http://www.saxproject.org/apidoc/org/xml/sax/ErrorHandler.html\r\n\t */\r\n\twarning:function(error) {\r\n\t\tconsole.warn('[xmldom warning]\\t'+error,_locator(this.locator));\r\n\t},\r\n\terror:function(error) {\r\n\t\tconsole.error('[xmldom error]\\t'+error,_locator(this.locator));\r\n\t},\r\n\tfatalError:function(error) {\r\n\t\tconsole.error('[xmldom fatalError]\\t'+error,_locator(this.locator));\r\n\t    throw error;\r\n\t}\r\n}\r\nfunction _locator(l){\r\n\tif(l){\r\n\t\treturn '\\n@'+(l.systemId ||'')+'#[line:'+l.lineNumber+',col:'+l.columnNumber+']'\r\n\t}\r\n}\r\nfunction _toString(chars,start,length){\r\n\tif(typeof chars == 'string'){\r\n\t\treturn chars.substr(start,length)\r\n\t}else{//java sax connect width xmldom on rhino(what about: \"? && !(chars instanceof String)\")\r\n\t\tif(chars.length >= start+length || start){\r\n\t\t\treturn new java.lang.String(chars,start,length)+'';\r\n\t\t}\r\n\t\treturn chars;\r\n\t}\r\n}\r\n\r\n/*\r\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/LexicalHandler.html\r\n * used method of org.xml.sax.ext.LexicalHandler:\r\n *  #comment(chars, start, length)\r\n *  #startCDATA()\r\n *  #endCDATA()\r\n *  #startDTD(name, publicId, systemId)\r\n *\r\n *\r\n * IGNORED method of org.xml.sax.ext.LexicalHandler:\r\n *  #endDTD()\r\n *  #startEntity(name)\r\n *  #endEntity(name)\r\n *\r\n *\r\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/DeclHandler.html\r\n * IGNORED method of org.xml.sax.ext.DeclHandler\r\n * \t#attributeDecl(eName, aName, type, mode, value)\r\n *  #elementDecl(name, model)\r\n *  #externalEntityDecl(name, publicId, systemId)\r\n *  #internalEntityDecl(name, value)\r\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/EntityResolver2.html\r\n * IGNORED method of org.xml.sax.EntityResolver2\r\n *  #resolveEntity(String name,String publicId,String baseURI,String systemId)\r\n *  #resolveEntity(publicId, systemId)\r\n *  #getExternalSubset(name, baseURI)\r\n * @link http://www.saxproject.org/apidoc/org/xml/sax/DTDHandler.html\r\n * IGNORED method of org.xml.sax.DTDHandler\r\n *  #notationDecl(name, publicId, systemId) {};\r\n *  #unparsedEntityDecl(name, publicId, systemId, notationName) {};\r\n */\r\n\"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl\".replace(/\\w+/g,function(key){\r\n\tDOMHandler.prototype[key] = function(){return null}\r\n})\r\n\r\n/* Private static helpers treated below as private instance methods, so don't need to add these to the public API; we might use a Relator to also get rid of non-standard public properties */\r\nfunction appendElement (hander,node) {\r\n    if (!hander.currentElement) {\r\n        hander.doc.appendChild(node);\r\n    } else {\r\n        hander.currentElement.appendChild(node);\r\n    }\r\n}//appendChild and setAttributeNS are preformance key\r\n\r\n//if(typeof require == 'function'){\r\n\tvar XMLReader = require('./sax').XMLReader;\r\n\tvar DOMImplementation = exports.DOMImplementation = require('./dom').DOMImplementation;\r\n\texports.XMLSerializer = require('./dom').XMLSerializer ;\r\n\texports.DOMParser = DOMParser;\r\n//}\r\n","//[4]   \tNameStartChar\t   ::=   \t\":\" | [A-Z] | \"_\" | [a-z] | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x2FF] | [#x370-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]\r\n//[4a]   \tNameChar\t   ::=   \tNameStartChar | \"-\" | \".\" | [0-9] | #xB7 | [#x0300-#x036F] | [#x203F-#x2040]\r\n//[5]   \tName\t   ::=   \tNameStartChar (NameChar)*\r\nvar nameStartChar = /[A-Z_a-z\\xC0-\\xD6\\xD8-\\xF6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]///\\u10000-\\uEFFFF\r\nvar nameChar = new RegExp(\"[\\\\-\\\\.0-9\"+nameStartChar.source.slice(1,-1)+\"\\\\u00B7\\\\u0300-\\\\u036F\\\\u203F-\\\\u2040]\");\r\nvar tagNamePattern = new RegExp('^'+nameStartChar.source+nameChar.source+'*(?:\\:'+nameStartChar.source+nameChar.source+'*)?$');\r\n//var tagNamePattern = /^[a-zA-Z_][\\w\\-\\.]*(?:\\:[a-zA-Z_][\\w\\-\\.]*)?$/\r\n//var handlers = 'resolveEntity,getExternalSubset,characters,endDocument,endElement,endPrefixMapping,ignorableWhitespace,processingInstruction,setDocumentLocator,skippedEntity,startDocument,startElement,startPrefixMapping,notationDecl,unparsedEntityDecl,error,fatalError,warning,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,comment,endCDATA,endDTD,endEntity,startCDATA,startDTD,startEntity'.split(',')\r\n\r\n//S_TAG,\tS_ATTR,\tS_EQ,\tS_ATTR_NOQUOT_VALUE\r\n//S_ATTR_SPACE,\tS_ATTR_END,\tS_TAG_SPACE, S_TAG_CLOSE\r\nvar S_TAG = 0;//tag name offerring\r\nvar S_ATTR = 1;//attr name offerring \r\nvar S_ATTR_SPACE=2;//attr name end and space offer\r\nvar S_EQ = 3;//=space?\r\nvar S_ATTR_NOQUOT_VALUE = 4;//attr value(no quot value only)\r\nvar S_ATTR_END = 5;//attr value end and no space(quot end)\r\nvar S_TAG_SPACE = 6;//(attr value end || tag end ) && (space offer)\r\nvar S_TAG_CLOSE = 7;//closed el<el />\r\n\r\nfunction XMLReader(){\r\n\t\r\n}\r\n\r\nXMLReader.prototype = {\r\n\tparse:function(source,defaultNSMap,entityMap){\r\n\t\tvar domBuilder = this.domBuilder;\r\n\t\tdomBuilder.startDocument();\r\n\t\t_copy(defaultNSMap ,defaultNSMap = {})\r\n\t\tparse(source,defaultNSMap,entityMap,\r\n\t\t\t\tdomBuilder,this.errorHandler);\r\n\t\tdomBuilder.endDocument();\r\n\t}\r\n}\r\nfunction parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){\r\n\tfunction fixedFromCharCode(code) {\r\n\t\t// String.prototype.fromCharCode does not supports\r\n\t\t// > 2 bytes unicode chars directly\r\n\t\tif (code > 0xffff) {\r\n\t\t\tcode -= 0x10000;\r\n\t\t\tvar surrogate1 = 0xd800 + (code >> 10)\r\n\t\t\t\t, surrogate2 = 0xdc00 + (code & 0x3ff);\r\n\r\n\t\t\treturn String.fromCharCode(surrogate1, surrogate2);\r\n\t\t} else {\r\n\t\t\treturn String.fromCharCode(code);\r\n\t\t}\r\n\t}\r\n\tfunction entityReplacer(a){\r\n\t\tvar k = a.slice(1,-1);\r\n\t\tif(k in entityMap){\r\n\t\t\treturn entityMap[k]; \r\n\t\t}else if(k.charAt(0) === '#'){\r\n\t\t\treturn fixedFromCharCode(parseInt(k.substr(1).replace('x','0x')))\r\n\t\t}else{\r\n\t\t\terrorHandler.error('entity not found:'+a);\r\n\t\t\treturn a;\r\n\t\t}\r\n\t}\r\n\tfunction appendText(end){//has some bugs\r\n\t\tif(end>start){\r\n\t\t\tvar xt = source.substring(start,end).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\tlocator&&position(start);\r\n\t\t\tdomBuilder.characters(xt,0,end-start);\r\n\t\t\tstart = end\r\n\t\t}\r\n\t}\r\n\tfunction position(p,m){\r\n\t\twhile(p>=lineEnd && (m = linePattern.exec(source))){\r\n\t\t\tlineStart = m.index;\r\n\t\t\tlineEnd = lineStart + m[0].length;\r\n\t\t\tlocator.lineNumber++;\r\n\t\t\t//console.log('line++:',locator,startPos,endPos)\r\n\t\t}\r\n\t\tlocator.columnNumber = p-lineStart+1;\r\n\t}\r\n\tvar lineStart = 0;\r\n\tvar lineEnd = 0;\r\n\tvar linePattern = /.*(?:\\r\\n?|\\n)|.*$/g\r\n\tvar locator = domBuilder.locator;\r\n\t\r\n\tvar parseStack = [{currentNSMap:defaultNSMapCopy}]\r\n\tvar closeMap = {};\r\n\tvar start = 0;\r\n\twhile(true){\r\n\t\ttry{\r\n\t\t\tvar tagStart = source.indexOf('<',start);\r\n\t\t\tif(tagStart<0){\r\n\t\t\t\tif(!source.substr(start).match(/^\\s*$/)){\r\n\t\t\t\t\tvar doc = domBuilder.doc;\r\n\t    \t\t\tvar text = doc.createTextNode(source.substr(start));\r\n\t    \t\t\tdoc.appendChild(text);\r\n\t    \t\t\tdomBuilder.currentElement = text;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(tagStart>start){\r\n\t\t\t\tappendText(tagStart);\r\n\t\t\t}\r\n\t\t\tswitch(source.charAt(tagStart+1)){\r\n\t\t\tcase '/':\r\n\t\t\t\tvar end = source.indexOf('>',tagStart+3);\r\n\t\t\t\tvar tagName = source.substring(tagStart+2,end);\r\n\t\t\t\tvar config = parseStack.pop();\r\n\t\t\t\tif(end<0){\r\n\t\t\t\t\t\r\n\t        \t\ttagName = source.substring(tagStart+2).replace(/[\\s<].*/,'');\r\n\t        \t\t//console.error('#@@@@@@'+tagName)\r\n\t        \t\terrorHandler.error(\"end tag name: \"+tagName+' is not complete:'+config.tagName);\r\n\t        \t\tend = tagStart+1+tagName.length;\r\n\t        \t}else if(tagName.match(/\\s</)){\r\n\t        \t\ttagName = tagName.replace(/[\\s<].*/,'');\r\n\t        \t\terrorHandler.error(\"end tag name: \"+tagName+' maybe not complete');\r\n\t        \t\tend = tagStart+1+tagName.length;\r\n\t\t\t\t}\r\n\t\t\t\t//console.error(parseStack.length,parseStack)\r\n\t\t\t\t//console.error(config);\r\n\t\t\t\tvar localNSMap = config.localNSMap;\r\n\t\t\t\tvar endMatch = config.tagName == tagName;\r\n\t\t\t\tvar endIgnoreCaseMach = endMatch || config.tagName&&config.tagName.toLowerCase() == tagName.toLowerCase()\r\n\t\t        if(endIgnoreCaseMach){\r\n\t\t        \tdomBuilder.endElement(config.uri,config.localName,tagName);\r\n\t\t\t\t\tif(localNSMap){\r\n\t\t\t\t\t\tfor(var prefix in localNSMap){\r\n\t\t\t\t\t\t\tdomBuilder.endPrefixMapping(prefix) ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!endMatch){\r\n\t\t            \terrorHandler.fatalError(\"end tag name: \"+tagName+' is not match the current start tagName:'+config.tagName );\r\n\t\t\t\t\t}\r\n\t\t        }else{\r\n\t\t        \tparseStack.push(config)\r\n\t\t        }\r\n\t\t\t\t\r\n\t\t\t\tend++;\r\n\t\t\t\tbreak;\r\n\t\t\t\t// end elment\r\n\t\t\tcase '?':// <?...?>\r\n\t\t\t\tlocator&&position(tagStart);\r\n\t\t\t\tend = parseInstruction(source,tagStart,domBuilder);\r\n\t\t\t\tbreak;\r\n\t\t\tcase '!':// <!doctype,<![CDATA,<!--\r\n\t\t\t\tlocator&&position(tagStart);\r\n\t\t\t\tend = parseDCC(source,tagStart,domBuilder,errorHandler);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tlocator&&position(tagStart);\r\n\t\t\t\tvar el = new ElementAttributes();\r\n\t\t\t\tvar currentNSMap = parseStack[parseStack.length-1].currentNSMap;\r\n\t\t\t\t//elStartEnd\r\n\t\t\t\tvar end = parseElementStartPart(source,tagStart,el,currentNSMap,entityReplacer,errorHandler);\r\n\t\t\t\tvar len = el.length;\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif(!el.closed && fixSelfClosed(source,end,el.tagName,closeMap)){\r\n\t\t\t\t\tel.closed = true;\r\n\t\t\t\t\tif(!entityMap.nbsp){\r\n\t\t\t\t\t\terrorHandler.warning('unclosed xml attribute');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(locator && len){\r\n\t\t\t\t\tvar locator2 = copyLocator(locator,{});\r\n\t\t\t\t\t//try{//attribute position fixed\r\n\t\t\t\t\tfor(var i = 0;i<len;i++){\r\n\t\t\t\t\t\tvar a = el[i];\r\n\t\t\t\t\t\tposition(a.offset);\r\n\t\t\t\t\t\ta.locator = copyLocator(locator,{});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//}catch(e){console.error('@@@@@'+e)}\r\n\t\t\t\t\tdomBuilder.locator = locator2\r\n\t\t\t\t\tif(appendElement(el,domBuilder,currentNSMap)){\r\n\t\t\t\t\t\tparseStack.push(el)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdomBuilder.locator = locator;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(appendElement(el,domBuilder,currentNSMap)){\r\n\t\t\t\t\t\tparseStack.push(el)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif(el.uri === 'http://www.w3.org/1999/xhtml' && !el.closed){\r\n\t\t\t\t\tend = parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)\r\n\t\t\t\t}else{\r\n\t\t\t\t\tend++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}catch(e){\r\n\t\t\terrorHandler.error('element parse error: '+e)\r\n\t\t\t//errorHandler.error('element parse error: '+e);\r\n\t\t\tend = -1;\r\n\t\t\t//throw e;\r\n\t\t}\r\n\t\tif(end>start){\r\n\t\t\tstart = end;\r\n\t\t}else{\r\n\t\t\t//TODO: 这里有可能sax回退，有位置错误风险\r\n\t\t\tappendText(Math.max(tagStart,start)+1);\r\n\t\t}\r\n\t}\r\n}\r\nfunction copyLocator(f,t){\r\n\tt.lineNumber = f.lineNumber;\r\n\tt.columnNumber = f.columnNumber;\r\n\treturn t;\r\n}\r\n\r\n/**\r\n * @see #appendElement(source,elStartEnd,el,selfClosed,entityReplacer,domBuilder,parseStack);\r\n * @return end of the elementStartPart(end of elementEndPart for selfClosed el)\r\n */\r\nfunction parseElementStartPart(source,start,el,currentNSMap,entityReplacer,errorHandler){\r\n\tvar attrName;\r\n\tvar value;\r\n\tvar p = ++start;\r\n\tvar s = S_TAG;//status\r\n\twhile(true){\r\n\t\tvar c = source.charAt(p);\r\n\t\tswitch(c){\r\n\t\tcase '=':\r\n\t\t\tif(s === S_ATTR){//attrName\r\n\t\t\t\tattrName = source.slice(start,p);\r\n\t\t\t\ts = S_EQ;\r\n\t\t\t}else if(s === S_ATTR_SPACE){\r\n\t\t\t\ts = S_EQ;\r\n\t\t\t}else{\r\n\t\t\t\t//fatalError: equal must after attrName or space after attrName\r\n\t\t\t\tthrow new Error('attribute equal must after attrName');\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase '\\'':\r\n\t\tcase '\"':\r\n\t\t\tif(s === S_EQ || s === S_ATTR //|| s == S_ATTR_SPACE\r\n\t\t\t\t){//equal\r\n\t\t\t\tif(s === S_ATTR){\r\n\t\t\t\t\terrorHandler.warning('attribute value must after \"=\"')\r\n\t\t\t\t\tattrName = source.slice(start,p)\r\n\t\t\t\t}\r\n\t\t\t\tstart = p+1;\r\n\t\t\t\tp = source.indexOf(c,start)\r\n\t\t\t\tif(p>0){\r\n\t\t\t\t\tvalue = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\t\tel.add(attrName,value,start-1);\r\n\t\t\t\t\ts = S_ATTR_END;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t//fatalError: no end quot match\r\n\t\t\t\t\tthrow new Error('attribute value no end \\''+c+'\\' match');\r\n\t\t\t\t}\r\n\t\t\t}else if(s == S_ATTR_NOQUOT_VALUE){\r\n\t\t\t\tvalue = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\t//console.log(attrName,value,start,p)\r\n\t\t\t\tel.add(attrName,value,start);\r\n\t\t\t\t//console.dir(el)\r\n\t\t\t\terrorHandler.warning('attribute \"'+attrName+'\" missed start quot('+c+')!!');\r\n\t\t\t\tstart = p+1;\r\n\t\t\t\ts = S_ATTR_END\r\n\t\t\t}else{\r\n\t\t\t\t//fatalError: no equal before\r\n\t\t\t\tthrow new Error('attribute value must after \"=\"');\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase '/':\r\n\t\t\tswitch(s){\r\n\t\t\tcase S_TAG:\r\n\t\t\t\tel.setTagName(source.slice(start,p));\r\n\t\t\tcase S_ATTR_END:\r\n\t\t\tcase S_TAG_SPACE:\r\n\t\t\tcase S_TAG_CLOSE:\r\n\t\t\t\ts =S_TAG_CLOSE;\r\n\t\t\t\tel.closed = true;\r\n\t\t\tcase S_ATTR_NOQUOT_VALUE:\r\n\t\t\tcase S_ATTR:\r\n\t\t\tcase S_ATTR_SPACE:\r\n\t\t\t\tbreak;\r\n\t\t\t//case S_EQ:\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"attribute invalid close char('/')\")\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase ''://end document\r\n\t\t\t//throw new Error('unexpected end of input')\r\n\t\t\terrorHandler.error('unexpected end of input');\r\n\t\t\tif(s == S_TAG){\r\n\t\t\t\tel.setTagName(source.slice(start,p));\r\n\t\t\t}\r\n\t\t\treturn p;\r\n\t\tcase '>':\r\n\t\t\tswitch(s){\r\n\t\t\tcase S_TAG:\r\n\t\t\t\tel.setTagName(source.slice(start,p));\r\n\t\t\tcase S_ATTR_END:\r\n\t\t\tcase S_TAG_SPACE:\r\n\t\t\tcase S_TAG_CLOSE:\r\n\t\t\t\tbreak;//normal\r\n\t\t\tcase S_ATTR_NOQUOT_VALUE://Compatible state\r\n\t\t\tcase S_ATTR:\r\n\t\t\t\tvalue = source.slice(start,p);\r\n\t\t\t\tif(value.slice(-1) === '/'){\r\n\t\t\t\t\tel.closed  = true;\r\n\t\t\t\t\tvalue = value.slice(0,-1)\r\n\t\t\t\t}\r\n\t\t\tcase S_ATTR_SPACE:\r\n\t\t\t\tif(s === S_ATTR_SPACE){\r\n\t\t\t\t\tvalue = attrName;\r\n\t\t\t\t}\r\n\t\t\t\tif(s == S_ATTR_NOQUOT_VALUE){\r\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed quot(\")!!');\r\n\t\t\t\t\tel.add(attrName,value.replace(/&#?\\w+;/g,entityReplacer),start)\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(currentNSMap[''] !== 'http://www.w3.org/1999/xhtml' || !value.match(/^(?:disabled|checked|selected)$/i)){\r\n\t\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed value!! \"'+value+'\" instead!!')\r\n\t\t\t\t\t}\r\n\t\t\t\t\tel.add(value,value,start)\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase S_EQ:\r\n\t\t\t\tthrow new Error('attribute value missed!!');\r\n\t\t\t}\r\n//\t\t\tconsole.log(tagName,tagNamePattern,tagNamePattern.test(tagName))\r\n\t\t\treturn p;\r\n\t\t/*xml space '\\x20' | #x9 | #xD | #xA; */\r\n\t\tcase '\\u0080':\r\n\t\t\tc = ' ';\r\n\t\tdefault:\r\n\t\t\tif(c<= ' '){//space\r\n\t\t\t\tswitch(s){\r\n\t\t\t\tcase S_TAG:\r\n\t\t\t\t\tel.setTagName(source.slice(start,p));//tagName\r\n\t\t\t\t\ts = S_TAG_SPACE;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_ATTR:\r\n\t\t\t\t\tattrName = source.slice(start,p)\r\n\t\t\t\t\ts = S_ATTR_SPACE;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_ATTR_NOQUOT_VALUE:\r\n\t\t\t\t\tvar value = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed quot(\")!!');\r\n\t\t\t\t\tel.add(attrName,value,start)\r\n\t\t\t\tcase S_ATTR_END:\r\n\t\t\t\t\ts = S_TAG_SPACE;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//case S_TAG_SPACE:\r\n\t\t\t\t//case S_EQ:\r\n\t\t\t\t//case S_ATTR_SPACE:\r\n\t\t\t\t//\tvoid();break;\r\n\t\t\t\t//case S_TAG_CLOSE:\r\n\t\t\t\t\t//ignore warning\r\n\t\t\t\t}\r\n\t\t\t}else{//not space\r\n//S_TAG,\tS_ATTR,\tS_EQ,\tS_ATTR_NOQUOT_VALUE\r\n//S_ATTR_SPACE,\tS_ATTR_END,\tS_TAG_SPACE, S_TAG_CLOSE\r\n\t\t\t\tswitch(s){\r\n\t\t\t\t//case S_TAG:void();break;\r\n\t\t\t\t//case S_ATTR:void();break;\r\n\t\t\t\t//case S_ATTR_NOQUOT_VALUE:void();break;\r\n\t\t\t\tcase S_ATTR_SPACE:\r\n\t\t\t\t\tvar tagName =  el.tagName;\r\n\t\t\t\t\tif(currentNSMap[''] !== 'http://www.w3.org/1999/xhtml' || !attrName.match(/^(?:disabled|checked|selected)$/i)){\r\n\t\t\t\t\t\terrorHandler.warning('attribute \"'+attrName+'\" missed value!! \"'+attrName+'\" instead2!!')\r\n\t\t\t\t\t}\r\n\t\t\t\t\tel.add(attrName,attrName,start);\r\n\t\t\t\t\tstart = p;\r\n\t\t\t\t\ts = S_ATTR;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_ATTR_END:\r\n\t\t\t\t\terrorHandler.warning('attribute space is required\"'+attrName+'\"!!')\r\n\t\t\t\tcase S_TAG_SPACE:\r\n\t\t\t\t\ts = S_ATTR;\r\n\t\t\t\t\tstart = p;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_EQ:\r\n\t\t\t\t\ts = S_ATTR_NOQUOT_VALUE;\r\n\t\t\t\t\tstart = p;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_TAG_CLOSE:\r\n\t\t\t\t\tthrow new Error(\"elements closed character '/' and '>' must be connected to\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}//end outer switch\r\n\t\t//console.log('p++',p)\r\n\t\tp++;\r\n\t}\r\n}\r\n/**\r\n * @return true if has new namespace define\r\n */\r\nfunction appendElement(el,domBuilder,currentNSMap){\r\n\tvar tagName = el.tagName;\r\n\tvar localNSMap = null;\r\n\t//var currentNSMap = parseStack[parseStack.length-1].currentNSMap;\r\n\tvar i = el.length;\r\n\twhile(i--){\r\n\t\tvar a = el[i];\r\n\t\tvar qName = a.qName;\r\n\t\tvar value = a.value;\r\n\t\tvar nsp = qName.indexOf(':');\r\n\t\tif(nsp>0){\r\n\t\t\tvar prefix = a.prefix = qName.slice(0,nsp);\r\n\t\t\tvar localName = qName.slice(nsp+1);\r\n\t\t\tvar nsPrefix = prefix === 'xmlns' && localName\r\n\t\t}else{\r\n\t\t\tlocalName = qName;\r\n\t\t\tprefix = null\r\n\t\t\tnsPrefix = qName === 'xmlns' && ''\r\n\t\t}\r\n\t\t//can not set prefix,because prefix !== ''\r\n\t\ta.localName = localName ;\r\n\t\t//prefix == null for no ns prefix attribute \r\n\t\tif(nsPrefix !== false){//hack!!\r\n\t\t\tif(localNSMap == null){\r\n\t\t\t\tlocalNSMap = {}\r\n\t\t\t\t//console.log(currentNSMap,0)\r\n\t\t\t\t_copy(currentNSMap,currentNSMap={})\r\n\t\t\t\t//console.log(currentNSMap,1)\r\n\t\t\t}\r\n\t\t\tcurrentNSMap[nsPrefix] = localNSMap[nsPrefix] = value;\r\n\t\t\ta.uri = 'http://www.w3.org/2000/xmlns/'\r\n\t\t\tdomBuilder.startPrefixMapping(nsPrefix, value) \r\n\t\t}\r\n\t}\r\n\tvar i = el.length;\r\n\twhile(i--){\r\n\t\ta = el[i];\r\n\t\tvar prefix = a.prefix;\r\n\t\tif(prefix){//no prefix attribute has no namespace\r\n\t\t\tif(prefix === 'xml'){\r\n\t\t\t\ta.uri = 'http://www.w3.org/XML/1998/namespace';\r\n\t\t\t}if(prefix !== 'xmlns'){\r\n\t\t\t\ta.uri = currentNSMap[prefix || '']\r\n\t\t\t\t\r\n\t\t\t\t//{console.log('###'+a.qName,domBuilder.locator.systemId+'',currentNSMap,a.uri)}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tvar nsp = tagName.indexOf(':');\r\n\tif(nsp>0){\r\n\t\tprefix = el.prefix = tagName.slice(0,nsp);\r\n\t\tlocalName = el.localName = tagName.slice(nsp+1);\r\n\t}else{\r\n\t\tprefix = null;//important!!\r\n\t\tlocalName = el.localName = tagName;\r\n\t}\r\n\t//no prefix element has default namespace\r\n\tvar ns = el.uri = currentNSMap[prefix || ''];\r\n\tdomBuilder.startElement(ns,localName,tagName,el);\r\n\t//endPrefixMapping and startPrefixMapping have not any help for dom builder\r\n\t//localNSMap = null\r\n\tif(el.closed){\r\n\t\tdomBuilder.endElement(ns,localName,tagName);\r\n\t\tif(localNSMap){\r\n\t\t\tfor(prefix in localNSMap){\r\n\t\t\t\tdomBuilder.endPrefixMapping(prefix) \r\n\t\t\t}\r\n\t\t}\r\n\t}else{\r\n\t\tel.currentNSMap = currentNSMap;\r\n\t\tel.localNSMap = localNSMap;\r\n\t\t//parseStack.push(el);\r\n\t\treturn true;\r\n\t}\r\n}\r\nfunction parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){\r\n\tif(/^(?:script|textarea)$/i.test(tagName)){\r\n\t\tvar elEndStart =  source.indexOf('</'+tagName+'>',elStartEnd);\r\n\t\tvar text = source.substring(elStartEnd+1,elEndStart);\r\n\t\tif(/[&<]/.test(text)){\r\n\t\t\tif(/^script$/i.test(tagName)){\r\n\t\t\t\t//if(!/\\]\\]>/.test(text)){\r\n\t\t\t\t\t//lexHandler.startCDATA();\r\n\t\t\t\t\tdomBuilder.characters(text,0,text.length);\r\n\t\t\t\t\t//lexHandler.endCDATA();\r\n\t\t\t\t\treturn elEndStart;\r\n\t\t\t\t//}\r\n\t\t\t}//}else{//text area\r\n\t\t\t\ttext = text.replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\tdomBuilder.characters(text,0,text.length);\r\n\t\t\t\treturn elEndStart;\r\n\t\t\t//}\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\treturn elStartEnd+1;\r\n}\r\nfunction fixSelfClosed(source,elStartEnd,tagName,closeMap){\r\n\t//if(tagName in closeMap){\r\n\tvar pos = closeMap[tagName];\r\n\tif(pos == null){\r\n\t\t//console.log(tagName)\r\n\t\tpos =  source.lastIndexOf('</'+tagName+'>')\r\n\t\tif(pos<elStartEnd){//忘记闭合\r\n\t\t\tpos = source.lastIndexOf('</'+tagName)\r\n\t\t}\r\n\t\tcloseMap[tagName] =pos\r\n\t}\r\n\treturn pos<elStartEnd;\r\n\t//} \r\n}\r\nfunction _copy(source,target){\r\n\tfor(var n in source){target[n] = source[n]}\r\n}\r\nfunction parseDCC(source,start,domBuilder,errorHandler){//sure start with '<!'\r\n\tvar next= source.charAt(start+2)\r\n\tswitch(next){\r\n\tcase '-':\r\n\t\tif(source.charAt(start + 3) === '-'){\r\n\t\t\tvar end = source.indexOf('-->',start+4);\r\n\t\t\t//append comment source.substring(4,end)//<!--\r\n\t\t\tif(end>start){\r\n\t\t\t\tdomBuilder.comment(source,start+4,end-start-4);\r\n\t\t\t\treturn end+3;\r\n\t\t\t}else{\r\n\t\t\t\terrorHandler.error(\"Unclosed comment\");\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\t//error\r\n\t\t\treturn -1;\r\n\t\t}\r\n\tdefault:\r\n\t\tif(source.substr(start+3,6) == 'CDATA['){\r\n\t\t\tvar end = source.indexOf(']]>',start+9);\r\n\t\t\tdomBuilder.startCDATA();\r\n\t\t\tdomBuilder.characters(source,start+9,end-start-9);\r\n\t\t\tdomBuilder.endCDATA() \r\n\t\t\treturn end+3;\r\n\t\t}\r\n\t\t//<!DOCTYPE\r\n\t\t//startDTD(java.lang.String name, java.lang.String publicId, java.lang.String systemId) \r\n\t\tvar matchs = split(source,start);\r\n\t\tvar len = matchs.length;\r\n\t\tif(len>1 && /!doctype/i.test(matchs[0][0])){\r\n\t\t\tvar name = matchs[1][0];\r\n\t\t\tvar pubid = len>3 && /^public$/i.test(matchs[2][0]) && matchs[3][0]\r\n\t\t\tvar sysid = len>4 && matchs[4][0];\r\n\t\t\tvar lastMatch = matchs[len-1]\r\n\t\t\tdomBuilder.startDTD(name,pubid && pubid.replace(/^(['\"])(.*?)\\1$/,'$2'),\r\n\t\t\t\t\tsysid && sysid.replace(/^(['\"])(.*?)\\1$/,'$2'));\r\n\t\t\tdomBuilder.endDTD();\r\n\t\t\t\r\n\t\t\treturn lastMatch.index+lastMatch[0].length\r\n\t\t}\r\n\t}\r\n\treturn -1;\r\n}\r\n\r\n\r\n\r\nfunction parseInstruction(source,start,domBuilder){\r\n\tvar end = source.indexOf('?>',start);\r\n\tif(end){\r\n\t\tvar match = source.substring(start,end).match(/^<\\?(\\S*)\\s*([\\s\\S]*?)\\s*$/);\r\n\t\tif(match){\r\n\t\t\tvar len = match[0].length;\r\n\t\t\tdomBuilder.processingInstruction(match[1], match[2]) ;\r\n\t\t\treturn end+2;\r\n\t\t}else{//error\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\treturn -1;\r\n}\r\n\r\n/**\r\n * @param source\r\n */\r\nfunction ElementAttributes(source){\r\n\t\r\n}\r\nElementAttributes.prototype = {\r\n\tsetTagName:function(tagName){\r\n\t\tif(!tagNamePattern.test(tagName)){\r\n\t\t\tthrow new Error('invalid tagName:'+tagName)\r\n\t\t}\r\n\t\tthis.tagName = tagName\r\n\t},\r\n\tadd:function(qName,value,offset){\r\n\t\tif(!tagNamePattern.test(qName)){\r\n\t\t\tthrow new Error('invalid attribute:'+qName)\r\n\t\t}\r\n\t\tthis[this.length++] = {qName:qName,value:value,offset:offset}\r\n\t},\r\n\tlength:0,\r\n\tgetLocalName:function(i){return this[i].localName},\r\n\tgetLocator:function(i){return this[i].locator},\r\n\tgetQName:function(i){return this[i].qName},\r\n\tgetURI:function(i){return this[i].uri},\r\n\tgetValue:function(i){return this[i].value}\r\n//\t,getIndex:function(uri, localName)){\r\n//\t\tif(localName){\r\n//\t\t\t\r\n//\t\t}else{\r\n//\t\t\tvar qName = uri\r\n//\t\t}\r\n//\t},\r\n//\tgetValue:function(){return this.getValue(this.getIndex.apply(this,arguments))},\r\n//\tgetType:function(uri,localName){}\r\n//\tgetType:function(i){},\r\n}\r\n\r\n\r\n\r\n\r\nfunction _set_proto_(thiz,parent){\r\n\tthiz.__proto__ = parent;\r\n\treturn thiz;\r\n}\r\nif(!(_set_proto_({},_set_proto_.prototype) instanceof _set_proto_)){\r\n\t_set_proto_ = function(thiz,parent){\r\n\t\tfunction p(){};\r\n\t\tp.prototype = parent;\r\n\t\tp = new p();\r\n\t\tfor(parent in thiz){\r\n\t\t\tp[parent] = thiz[parent];\r\n\t\t}\r\n\t\treturn p;\r\n\t}\r\n}\r\n\r\nfunction split(source,start){\r\n\tvar match;\r\n\tvar buf = [];\r\n\tvar reg = /'[^']+'|\"[^\"]+\"|[^\\s<>\\/=]+=?|(\\/?\\s*>|<)/g;\r\n\treg.lastIndex = start;\r\n\treg.exec(source);//skip <\r\n\twhile(match = reg.exec(source)){\r\n\t\tbuf.push(match);\r\n\t\tif(match[1])return buf;\r\n\t}\r\n}\r\n\r\nexports.XMLReader = XMLReader;\r\n\r\n"],"sourceRoot":""}